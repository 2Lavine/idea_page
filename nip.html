<h1>01</h1><h1>NIP-01</h1>
<h2>Basic protocol flow description</h2>
<p><code>draft</code> <code>mandatory</code> <code>author:fiatjaf</code> <code>author:distbit</code> <code>author:scsibug</code> <code>author:kukks</code> <code>author:jb55</code> <code>author:semisol</code> <code>author:cameri</code> <code>author:Giszmo</code></p>
<p>This NIP defines the basic protocol that should be implemented by everybody. New NIPs may add new optional (or mandatory) fields and messages and features to the structures and flows described here.</p>
<h2>Events and signatures</h2>
<p>Each user has a keypair. Signatures, public key, and encodings are done according to the <a href="https://bips.xyz/340">Schnorr signatures standard for the curve <code>secp256k1</code></a>.</p>
<p>The only object type that exists is the <code>event</code>, which has the following format on the wire:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &lt;32-bytes lowercase hex-encoded sha256 of the serialized event data&gt;,
  &quot;pubkey&quot;: &lt;32-bytes lowercase hex-encoded public key of the event creator&gt;,
  &quot;created_at&quot;: &lt;unix timestamp in seconds&gt;,
  &quot;kind&quot;: &lt;integer between 0 and 65535&gt;,
  &quot;tags&quot;: [
    [&lt;arbitrary string&gt;...],
    ...
  ],
  &quot;content&quot;: &lt;arbitrary string&gt;,
  &quot;sig&quot;: &lt;64-bytes lowercase hex of the signature of the sha256 hash of the serialized event data, which is the same as the &quot;id&quot; field&gt;
}
</code></pre>
<p>To obtain the <code>event.id</code>, we <code>sha256</code> the serialized event. The serialization is done over the UTF-8 JSON-serialized string (with no white space or line breaks) of the following structure:</p>
<pre><code class="language-json">[
  0,
  &lt;pubkey, as a lowercase hex string&gt;,
  &lt;created_at, as a number&gt;,
  &lt;kind, as a number&gt;,
  &lt;tags, as an array of arrays of non-null strings&gt;,
  &lt;content, as a string&gt;
]
</code></pre>
<h3>Tags</h3>
<p>Each tag is an array of strings of arbitrary size, with some conventions around them. Take a look at the example below:</p>
<pre><code class="language-json">{
  ...,
  &quot;tags&quot;: [
    [&quot;e&quot;, &quot;5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36&quot;, &quot;wss://nostr.example.com&quot;],
    [&quot;p&quot;, &quot;f7234bd4c1394dda46d09f35bd384dd30cc552ad5541990f98844fb06676e9ca&quot;],
    [&quot;a&quot;, &quot;30023:f7234bd4c1394dda46d09f35bd384dd30cc552ad5541990f98844fb06676e9ca:abcd&quot;, &quot;wss://nostr.example.com&quot;],
    [&quot;alt&quot;, &quot;reply&quot;],
    ...
  ],
  ...
}
</code></pre>
<p>The first element of the tag array is referred to as the tag <em>name</em> or <em>key</em> and the second as the tag <em>value</em>. So we can safely say that the event above has an <code>e</code> tag set to <code>&quot;5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36&quot;</code>, an <code>alt</code> tag set to <code>&quot;reply&quot;</code> and so on. All elements after the second do not have a conventional name.</p>
<p>This NIP defines 3 standard tags that can be used across all event kinds with the same meaning. They are as follows:</p>
<ul>
<li>The <code>e</code> tag, used to refer to an event: <code>[&quot;e&quot;, &lt;32-bytes lowercase hex of the id of another event&gt;, &lt;recommended relay URL, optional&gt;]</code></li>
<li>The <code>p</code> tag, used to refer to another user: <code>[&quot;p&quot;, &lt;32-bytes lowercase hex of a pubkey&gt;, &lt;recommended relay URL, optional&gt;]</code></li>
<li>The <code>a</code> tag, used to refer to a (maybe parameterized) replaceable event
<ul>
<li>for a parameterized replaceable event: <code>[&quot;a&quot;, &lt;kind integer&gt;:&lt;32-bytes lowercase hex of a pubkey&gt;:&lt;d tag value&gt;, &lt;recommended relay URL, optional&gt;]</code></li>
<li>for a non-parameterized replaceable event: <code>[&quot;a&quot;, &lt;kind integer&gt;:&lt;32-bytes lowercase hex of a pubkey&gt;:, &lt;recommended relay URL, optional&gt;]</code></li>
</ul>
</li>
</ul>
<p>As a convention, all single-letter (only english alphabet letters: a-z, A-Z) key tags are expected to be indexed by relays, such that it is possible, for example, to query or subscribe to events that reference the event <code>&quot;5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36&quot;</code> by using the <code>{&quot;#e&quot;: &quot;5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36&quot;}</code> filter.</p>
<h3>Kinds</h3>
<p>Kinds specify how clients should interpret the meaning of each event and the other fields of each event (e.g. an <code>&quot;r&quot;</code> tag may have a meaning in an event of kind 1 and an entirely different meaning in an event of kind 10002). Each NIP may define the meaning of a set of kinds that weren't defined elsewhere. This NIP defines two basic kinds:</p>
<ul>
<li><code>0</code>: <strong>metadata</strong>: the <code>content</code> is set to a stringified JSON object <code>{name: &lt;username&gt;, about: &lt;string&gt;, picture: &lt;url, string&gt;}</code> describing the user who created the event. A relay may delete older events once it gets a new one for the same pubkey.</li>
<li><code>1</code>: <strong>text note</strong>: the <code>content</code> is set to the <strong>plaintext</strong> content of a note (anything the user wants to say). Content that must be parsed, such as Markdown and HTML, should not be used. Clients should also not parse content as those.</li>
</ul>
<p>And also a convention for kind ranges that allow for easier experimentation and flexibility of relay implementation:</p>
<ul>
<li>for kind <code>n</code> such that <code>1000 &lt;= n &lt; 10000</code>, events are <strong>regular</strong>, which means they're all expected to be stored by relays.</li>
<li>for kind <code>n</code> such that <code>10000 &lt;= n &lt; 20000 || n == 0 || n == 3</code>, events are <strong>replaceable</strong>, which means that, for each combination of <code>pubkey</code> and <code>kind</code>, only the latest event MUST be stored by relays, older versions MAY be discarded.</li>
<li>for kind <code>n</code> such that <code>20000 &lt;= n &lt; 30000</code>, events are <strong>ephemeral</strong>, which means they are not expected to be stored by relays.</li>
<li>for kind <code>n</code> such that <code>30000 &lt;= n &lt; 40000</code>, events are <strong>parameterized replaceable</strong>, which means that, for each combination of <code>pubkey</code>, <code>kind</code> and the <code>d</code> tag's first value, only the latest event MUST be stored by relays, older versions MAY be discarded.</li>
</ul>
<p>In case of replaceable events with the same timestamp, the event with the lowest id (first in lexical order) should be retained, and the other discarded.</p>
<p>When answering to <code>REQ</code> messages for replaceable events such as <code>{&quot;kinds&quot;:[0],&quot;authors&quot;:[&lt;hex-key&gt;]}</code>, even if the relay has more than one version stored, it SHOULD return just the latest one.</p>
<p>These are just conventions and relay implementations may differ.</p>
<h2>Communication between clients and relays</h2>
<p>Relays expose a websocket endpoint to which clients can connect. Clients SHOULD open a single websocket connection to each relay and use it for all their subscriptions. Relays MAY limit number of connections from specific IP/client/etc.</p>
<h3>Meaning of WebSocket status codes</h3>
<ul>
<li>When a websocket is closed by the relay with a status code <code>4000</code> that means the client shouldn't try to connect again.</li>
</ul>
<h3>From client to relay: sending events and creating subscriptions</h3>
<p>Clients can send 3 types of messages, which must be JSON arrays, according to the following patterns:</p>
<ul>
<li><code>[&quot;EVENT&quot;, &lt;event JSON as defined above&gt;]</code>, used to publish events.</li>
<li><code>[&quot;REQ&quot;, &lt;subscription_id&gt;, &lt;filters JSON&gt;...]</code>, used to request events and subscribe to new updates.</li>
<li><code>[&quot;CLOSE&quot;, &lt;subscription_id&gt;]</code>, used to stop previous subscriptions.</li>
</ul>
<p><code>&lt;subscription_id&gt;</code> is an arbitrary, non-empty string of max length 64 chars, that should be used to represent a subscription. Relays should manage <code>&lt;subscription_id&gt;</code>s independently for each WebSocket connection; even if <code>&lt;subscription_id&gt;</code>s are the same string, they should be treated as different subscriptions for different connections.</p>
<p><code>&lt;filters&gt;</code> is a JSON object that determines what events will be sent in that subscription, it can have the following attributes:</p>
<pre><code class="language-json">{
  &quot;ids&quot;: &lt;a list of event ids&gt;,
  &quot;authors&quot;: &lt;a list of lowercase pubkeys, the pubkey of an event must be one of these&gt;,
  &quot;kinds&quot;: &lt;a list of a kind numbers&gt;,
  &quot;#&lt;single-letter (a-zA-Z)&gt;&quot;: &lt;a list of tag values, for #e — a list of event ids, for #p — a list of event pubkeys etc&gt;,
  &quot;since&quot;: &lt;an integer unix timestamp in seconds, events must be newer than this to pass&gt;,
  &quot;until&quot;: &lt;an integer unix timestamp in seconds, events must be older than this to pass&gt;,
  &quot;limit&quot;: &lt;maximum number of events relays SHOULD return in the initial query&gt;
}
</code></pre>
<p>Upon receiving a <code>REQ</code> message, the relay SHOULD query its internal database and return events that match the filter, then store that filter and send again all future events it receives to that same websocket until the websocket is closed. The <code>CLOSE</code> event is received with the same <code>&lt;subscription_id&gt;</code> or a new <code>REQ</code> is sent using the same <code>&lt;subscription_id&gt;</code>, in which case relay MUST overwrite the previous subscription.</p>
<p>Filter attributes containing lists (<code>ids</code>, <code>authors</code>, <code>kinds</code> and tag filters like <code>#e</code>) are JSON arrays with one or more values. At least one of the arrays' values must match the relevant field in an event for the condition to be considered a match. For scalar event attributes such as <code>authors</code> and <code>kind</code>, the attribute from the event must be contained in the filter list. In the case of tag attributes such as <code>#e</code>, for which an event may have multiple values, the event and filter condition values must have at least one item in common.</p>
<p>The <code>ids</code>, <code>authors</code>, <code>#e</code> and <code>#p</code> filter lists MUST contain exact 64-character lowercase hex values.</p>
<p>The <code>since</code> and <code>until</code> properties can be used to specify the time range of events returned in the subscription. If a filter includes the <code>since</code> property, events with <code>created_at</code> greater than or equal to <code>since</code> are considered to match the filter. The <code>until</code> property is similar except that <code>created_at</code> must be less than or equal to <code>until</code>. In short, an event matches a filter if <code>since &lt;= created_at &lt;= until</code> holds.</p>
<p>All conditions of a filter that are specified must match for an event for it to pass the filter, i.e., multiple conditions are interpreted as <code>&amp;&amp;</code> conditions.</p>
<p>A <code>REQ</code> message may contain multiple filters. In this case, events that match any of the filters are to be returned, i.e., multiple filters are to be interpreted as <code>||</code> conditions.</p>
<p>The <code>limit</code> property of a filter is only valid for the initial query and MUST be ignored afterwards. When <code>limit: n</code> is present it is assumed that the events returned in the initial query will be the last <code>n</code> events ordered by the <code>created_at</code>. It is safe to return less events than <code>limit</code> specifies, but it is expected that relays do not return (much) more events than requested so clients don't get unnecessarily overwhelmed by data.</p>
<h3>From relay to client: sending events and notices</h3>
<p>Relays can send 4 types of messages, which must also be JSON arrays, according to the following patterns:</p>
<ul>
<li><code>[&quot;EVENT&quot;, &lt;subscription_id&gt;, &lt;event JSON as defined above&gt;]</code>, used to send events requested by clients.</li>
<li><code>[&quot;OK&quot;, &lt;event_id&gt;, &lt;true|false&gt;, &lt;message&gt;]</code>, used to indicate acceptance or denial of an <code>EVENT</code> message.</li>
<li><code>[&quot;EOSE&quot;, &lt;subscription_id&gt;]</code>, used to indicate the <em>end of stored events</em> and the beginning of events newly received in real-time.</li>
<li><code>[&quot;NOTICE&quot;, &lt;message&gt;]</code>, used to send human-readable error messages or other things to clients.</li>
</ul>
<p>This NIP defines no rules for how <code>NOTICE</code> messages should be sent or treated.</p>
<ul>
<li>
<p><code>EVENT</code> messages MUST be sent only with a subscription ID related to a subscription previously initiated by the client (using the <code>REQ</code> message above).</p>
</li>
<li>
<p><code>OK</code> messages MUST be sent in response to <code>EVENT</code> messages received from clients, they must have the 3rd parameter set to <code>true</code> when an event has been accepted by the relay, <code>false</code> otherwise. The 4th parameter MAY be empty when the 3rd is <code>true</code>, otherwise it MUST be a string containing a machine-readable single-word prefix followed by a <code>:</code> and then a human-readable message. The standardized machine-readable prefixes are: <code>duplicate</code>, <code>pow</code>, <code>blocked</code>, <code>rate-limited</code>, <code>invalid</code>, and <code>error</code> for when none of that fits. Some examples:</p>
<ul>
<li><code>[&quot;OK&quot;, &quot;b1a649ebe8...&quot;, true, &quot;&quot;]</code></li>
<li><code>[&quot;OK&quot;, &quot;b1a649ebe8...&quot;, true, &quot;pow: difficulty 25&gt;=24&quot;]</code></li>
<li><code>[&quot;OK&quot;, &quot;b1a649ebe8...&quot;, true, &quot;duplicate: already have this event&quot;]</code></li>
<li><code>[&quot;OK&quot;, &quot;b1a649ebe8...&quot;, false, &quot;blocked: you are banned from posting here&quot;]</code></li>
<li><code>[&quot;OK&quot;, &quot;b1a649ebe8...&quot;, false, &quot;blocked: please register your pubkey at https://my-expensive-relay.example.com&quot;]</code></li>
<li><code>[&quot;OK&quot;, &quot;b1a649ebe8...&quot;, false, &quot;rate-limited: slow down there chief&quot;]</code></li>
<li><code>[&quot;OK&quot;, &quot;b1a649ebe8...&quot;, false, &quot;invalid: event creation date is too far off from the current time. Is your system clock in sync?&quot;]</code></li>
<li><code>[&quot;OK&quot;, &quot;b1a649ebe8...&quot;, false, &quot;pow: difficulty 26 is less than 30&quot;]</code></li>
<li><code>[&quot;OK&quot;, &quot;b1a649ebe8...&quot;, false, &quot;error: could not connect to the database&quot;]</code></li>
</ul>
</li>
</ul>

<h1>02</h1><h1>NIP-02</h1>
<h2>Contact List and Petnames</h2>
<p><code>final</code> <code>optional</code> <code>author:fiatjaf</code> <code>author:arcbtc</code></p>
<p>A special event with kind <code>3</code>, meaning &quot;contact list&quot; is defined as having a list of <code>p</code> tags, one for each of the followed/known profiles one is following.</p>
<p>Each tag entry should contain the key for the profile, a relay URL where events from that key can be found (can be set to an empty string if not needed), and a local name (or &quot;petname&quot;) for that profile (can also be set to an empty string or not provided), i.e., <code>[&quot;p&quot;, &lt;32-bytes hex key&gt;, &lt;main relay URL&gt;, &lt;petname&gt;]</code>. The <code>content</code> can be anything and should be ignored.</p>
<p>For example:</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 3,
  &quot;tags&quot;: [
    [&quot;p&quot;, &quot;91cf9..4e5ca&quot;, &quot;wss://alicerelay.com/&quot;, &quot;alice&quot;],
    [&quot;p&quot;, &quot;14aeb..8dad4&quot;, &quot;wss://bobrelay.com/nostr&quot;, &quot;bob&quot;],
    [&quot;p&quot;, &quot;612ae..e610f&quot;, &quot;ws://carolrelay.com/ws&quot;, &quot;carol&quot;]
  ],
  &quot;content&quot;: &quot;&quot;,
  ...other fields
}
</code></pre>
<p>Every new contact list that gets published overwrites the past ones, so it should contain all entries. Relays and clients SHOULD delete past contact lists as soon as they receive a new one.</p>
<h2>Uses</h2>
<h3>Contact list backup</h3>
<p>If one believes a relay will store their events for sufficient time, they can use this kind-3 event to backup their following list and recover on a different device.</p>
<h3>Profile discovery and context augmentation</h3>
<p>A client may rely on the kind-3 event to display a list of followed people by profiles one is browsing; make lists of suggestions on who to follow based on the contact lists of other people one might be following or browsing; or show the data in other contexts.</p>
<h3>Relay sharing</h3>
<p>A client may publish a full list of contacts with good relays for each of their contacts so other clients may use these to update their internal relay lists if needed, increasing censorship-resistance.</p>
<h3>Petname scheme</h3>
<p>The data from these contact lists can be used by clients to construct local <a href="http://www.skyhunter.com/marcs/petnames/IntroPetNames.html">&quot;petname&quot;</a> tables derived from other people's contact lists. This alleviates the need for global human-readable names. For example:</p>
<p>A user has an internal contact list that says</p>
<pre><code class="language-json">[
  [&quot;p&quot;, &quot;21df6d143fb96c2ec9d63726bf9edc71&quot;, &quot;&quot;, &quot;erin&quot;]
]
</code></pre>
<p>And receives two contact lists, one from <code>21df6d143fb96c2ec9d63726bf9edc71</code> that says</p>
<pre><code class="language-json">[
  [&quot;p&quot;, &quot;a8bb3d884d5d90b413d9891fe4c4e46d&quot;, &quot;&quot;, &quot;david&quot;]
]
</code></pre>
<p>and another from <code>a8bb3d884d5d90b413d9891fe4c4e46d</code> that says</p>
<pre><code class="language-json">[
  [&quot;p&quot;, &quot;f57f54057d2a7af0efecc8b0b66f5708&quot;, &quot;&quot;, &quot;frank&quot;]
]
</code></pre>
<p>When the user sees <code>21df6d143fb96c2ec9d63726bf9edc71</code> the client can show <em>erin</em> instead;
When the user sees <code>a8bb3d884d5d90b413d9891fe4c4e46d</code> the client can show <em>david.erin</em> instead;
When the user sees <code>f57f54057d2a7af0efecc8b0b66f5708</code> the client can show <em>frank.david.erin</em> instead.</p>

<h1>03</h1><h1>NIP-03</h1>
<h2>OpenTimestamps Attestations for Events</h2>
<p><code>draft</code> <code>optional</code> <code>author:fiatjaf</code> <code>author:constant</code></p>
<p>This NIP defines an event with <code>kind:1040</code> that can contain an <a href="https://opentimestamps.org/">OpenTimestamps</a> proof for any other event:</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 1040
  &quot;tags&quot;: [
    [&quot;e&quot;, &lt;event-id&gt;, &lt;relay-url&gt;],
    [&quot;alt&quot;, &quot;opentimestamps attestation&quot;]
  ],
  &quot;content&quot;: &lt;base64-encoded OTS file data&gt;
}
</code></pre>
<ul>
<li>The OpenTimestamps proof MUST prove the referenced <code>e</code> event id as its digest.</li>
<li>The <code>content</code> MUST be the full content of an <code>.ots</code> file containing at least one Bitcoin attestation. This file SHOULD contain a <strong>single</strong> Bitcoin attestation and no reference to &quot;pending&quot; attestations since they are useless in this context.</li>
</ul>
<h3>Example OpenTimestamps proof verification flow</h3>
<p>Using <a href="https://github.com/fiatjaf/nak"><code>nak</code></a>, <a href="https://jqlang.github.io/jq/"><code>jq</code></a> and <a href="https://github.com/fiatjaf/ots"><code>ots</code></a>:</p>
<pre><code class="language-bash">~&gt; nak req -i e71c6ea722987debdb60f81f9ea4f604b5ac0664120dd64fb9d23abc4ec7c323 wss://nostr-pub.wellorder.net | jq -r .content | ots verify
&gt; using an esplora server at https://blockstream.info/api
- sequence ending on block 810391 is valid
timestamp validated at block [810391]
</code></pre>

<h1>04</h1><h1>NIP-04</h1>
<h2>Encrypted Direct Message</h2>
<p><code>final</code> <code>optional</code> <code>author:arcbtc</code></p>
<p>A special event with kind <code>4</code>, meaning &quot;encrypted direct message&quot;. It is supposed to have the following attributes:</p>
<p><strong><code>content</code></strong> MUST be equal to the base64-encoded, aes-256-cbc encrypted string of anything a user wants to write, encrypted using a shared cipher generated by combining the recipient's public-key with the sender's private-key; this appended by the base64-encoded initialization vector as if it was a querystring parameter named &quot;iv&quot;. The format is the following: <code>&quot;content&quot;: &quot;&lt;encrypted_text&gt;?iv=&lt;initialization_vector&gt;&quot;</code>.</p>
<p><strong><code>tags</code></strong> MUST contain an entry identifying the receiver of the message (such that relays may naturally forward this event to them), in the form <code>[&quot;p&quot;, &quot;&lt;pubkey, as a hex string&gt;&quot;]</code>.</p>
<p><strong><code>tags</code></strong> MAY contain an entry identifying the previous message in a conversation or a message we are explicitly replying to (such that contextual, more organized conversations may happen), in the form <code>[&quot;e&quot;, &quot;&lt;event_id&gt;&quot;]</code>.</p>
<p><strong>Note</strong>: By default in the <a href="https://github.com/bitcoin-core/secp256k1">libsecp256k1</a> ECDH implementation, the secret is the SHA256 hash of the shared point (both X and Y coordinates). In Nostr, only the X coordinate of the shared point is used as the secret and it is NOT hashed. If using libsecp256k1, a custom function that copies the X coordinate must be passed as the <code>hashfp</code> argument in <code>secp256k1_ecdh</code>. See <a href="https://github.com/bitcoin-core/secp256k1/blob/master/src/modules/ecdh/main_impl.h#L29">here</a>.</p>
<p>Code sample for generating such an event in JavaScript:</p>
<pre><code class="language-js">import crypto from 'crypto'
import * as secp from '@noble/secp256k1'

let sharedPoint = secp.getSharedSecret(ourPrivateKey, '02' + theirPublicKey)
let sharedX = sharedPoint.slice(1, 33)

let iv = crypto.randomFillSync(new Uint8Array(16))
var cipher = crypto.createCipheriv(
  'aes-256-cbc',
  Buffer.from(sharedX),
  iv
)
let encryptedMessage = cipher.update(text, 'utf8', 'base64')
encryptedMessage += cipher.final('base64')
let ivBase64 = Buffer.from(iv.buffer).toString('base64')

let event = {
  pubkey: ourPubKey,
  created_at: Math.floor(Date.now() / 1000),
  kind: 4,
  tags: [['p', theirPublicKey]],
  content: encryptedMessage + '?iv=' + ivBase64
}
</code></pre>
<h2>Security Warning</h2>
<p>This standard does not go anywhere near what is considered the state-of-the-art in encrypted communication between peers, and it leaks metadata in the events, therefore it must not be used for anything you really need to keep secret, and only with relays that use <code>AUTH</code> to restrict who can fetch your <code>kind:4</code> events.</p>
<h2>Client Implementation Warning</h2>
<p>Clients <em>should not</em> search and replace public key or note references from the <code>.content</code>. If processed like a regular text note (where <code>@npub...</code> is replaced with <code>#[0]</code> with a <code>[&quot;p&quot;, &quot;...&quot;]</code> tag) the tags are leaked and the mentioned user will receive the message in their inbox.</p>

<h1>05</h1><h1>NIP-05</h1>
<h2>Mapping Nostr keys to DNS-based internet identifiers</h2>
<p><code>final</code> <code>optional</code> <code>author:fiatjaf</code> <code>author:mikedilger</code></p>
<p>On events of kind <code>0</code> (<code>metadata</code>) one can specify the key <code>&quot;nip05&quot;</code> with an <a href="https://datatracker.ietf.org/doc/html/rfc5322#section-3.4.1">internet identifier</a> (an email-like address) as the value. Although there is a link to a very liberal &quot;internet identifier&quot; specification above, NIP-05 assumes the <code>&lt;local-part&gt;</code> part will be restricted to the characters <code>a-z0-9-_.</code>, case-insensitive.</p>
<p>Upon seeing that, the client splits the identifier into <code>&lt;local-part&gt;</code> and <code>&lt;domain&gt;</code> and use these values to make a GET request to <code>https://&lt;domain&gt;/.well-known/nostr.json?name=&lt;local-part&gt;</code>.</p>
<p>The result should be a JSON document object with a key <code>&quot;names&quot;</code> that should then be a mapping of names to hex formatted public keys. If the public key for the given <code>&lt;name&gt;</code> matches the <code>pubkey</code> from the <code>metadata</code> event, the client then concludes that the given pubkey can indeed be referenced by its identifier.</p>
<h3>Example</h3>
<p>If a client sees an event like this:</p>
<pre><code class="language-json">{
  &quot;pubkey&quot;: &quot;b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9&quot;,
  &quot;kind&quot;: 0,
  &quot;content&quot;: &quot;{\&quot;name\&quot;: \&quot;bob\&quot;, \&quot;nip05\&quot;: \&quot;bob@example.com\&quot;}&quot;
  ...
}
</code></pre>
<p>It will make a GET request to <code>https://example.com/.well-known/nostr.json?name=bob</code> and get back a response that will look like</p>
<pre><code class="language-json">{
  &quot;names&quot;: {
    &quot;bob&quot;: &quot;b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9&quot;
  }
}
</code></pre>
<p>or with the <strong>optional</strong> <code>&quot;relays&quot;</code> attribute:</p>
<pre><code class="language-json">{
  &quot;names&quot;: {
    &quot;bob&quot;: &quot;b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9&quot;
  },
  &quot;relays&quot;: {
    &quot;b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9&quot;: [ &quot;wss://relay.example.com&quot;, &quot;wss://relay2.example.com&quot; ]
  }
}
</code></pre>
<p>If the pubkey matches the one given in <code>&quot;names&quot;</code> (as in the example above) that means the association is right and the <code>&quot;nip05&quot;</code> identifier is valid and can be displayed.</p>
<p>The optional <code>&quot;relays&quot;</code> attribute may contain an object with public keys as properties and arrays of relay URLs as values. When present, that can be used to help clients learn in which relays the specific user may be found. Web servers which serve <code>/.well-known/nostr.json</code> files dynamically based on the query string SHOULD also serve the relays data for any name they serve in the same reply when that is available.</p>
<h2>Finding users from their NIP-05 identifier</h2>
<p>A client may implement support for finding users' public keys from <em>internet identifiers</em>, the flow is the same as above, but reversed: first the client fetches the <em>well-known</em> URL and from there it gets the public key of the user, then it tries to fetch the kind <code>0</code> event for that user and check if it has a matching <code>&quot;nip05&quot;</code>.</p>
<h2>Notes</h2>
<h3>Clients must always follow public keys, not NIP-05 addresses</h3>
<p>For example, if after finding that <code>bob@bob.com</code> has the public key <code>abc...def</code>, the user clicks a button to follow that profile, the client must keep a primary reference to <code>abc...def</code>, not <code>bob@bob.com</code>. If, for any reason, the address <code>https://bob.com/.well-known/nostr.json?name=bob</code> starts returning the public key <code>1d2...e3f</code> at any time in the future, the client must not replace <code>abc...def</code> in his list of followed profiles for the user (but it should stop displaying &quot;bob@bob.com&quot; for that user, as that will have become an invalid <code>&quot;nip05&quot;</code> property).</p>
<h3>Public keys must be in hex format</h3>
<p>Keys must be returned in hex format. Keys in NIP-19 <code>npub</code> format are only meant to be used for display in client UIs, not in this NIP.</p>
<h3>User Discovery implementation suggestion</h3>
<p>A client can also use this to allow users to search other profiles. If a client has a search box or something like that, a user may be able to type &quot;bob@example.com&quot; there and the client would recognize that and do the proper queries to obtain a pubkey and suggest that to the user.</p>
<h3>Showing just the domain as an identifier</h3>
<p>Clients may treat the identifier <code>_@domain</code> as the &quot;root&quot; identifier, and choose to display it as just the <code>&lt;domain&gt;</code>. For example, if Bob owns <code>bob.com</code>, he may not want an identifier like <code>bob@bob.com</code> as that is redundant. Instead, Bob can use the identifier <code>_@bob.com</code> and expect Nostr clients to show and treat that as just <code>bob.com</code> for all purposes.</p>
<h3>Reasoning for the <code>/.well-known/nostr.json?name=&lt;local-part&gt;</code> format</h3>
<p>By adding the <code>&lt;local-part&gt;</code> as a query string instead of as part of the path, the protocol can support both dynamic servers that can generate JSON on-demand and static servers with a JSON file in it that may contain multiple names.</p>
<h3>Allowing access from JavaScript apps</h3>
<p>JavaScript Nostr apps may be restricted by browser <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a> policies that prevent them from accessing <code>/.well-known/nostr.json</code> on the user's domain. When CORS prevents JS from loading a resource, the JS program sees it as a network failure identical to the resource not existing, so it is not possible for a pure-JS app to tell the user for certain that the failure was caused by a CORS issue. JS Nostr apps that see network failures requesting <code>/.well-known/nostr.json</code> files may want to recommend to users that they check the CORS policy of their servers, e.g.:</p>
<pre><code class="language-bash">$ curl -sI https://example.com/.well-known/nostr.json?name=bob | grep -i ^Access-Control
Access-Control-Allow-Origin: *
</code></pre>
<p>Users should ensure that their <code>/.well-known/nostr.json</code> is served with the HTTP header <code>Access-Control-Allow-Origin: *</code> to ensure it can be validated by pure JS apps running in modern browsers.</p>
<h3>Security Constraints</h3>
<p>The <code>/.well-known/nostr.json</code> endpoint MUST NOT return any HTTP redirects.</p>
<p>Fetchers MUST ignore any HTTP redirects given by the <code>/.well-known/nostr.json</code> endpoint.</p>

<h1>06</h1><h1>NIP-06</h1>
<h2>Basic key derivation from mnemonic seed phrase</h2>
<p><code>draft</code> <code>optional</code> <code>author:fiatjaf</code></p>
<p><a href="https://bips.xyz/39">BIP39</a> is used to generate mnemonic seed words and derive a binary seed from them.</p>
<p><a href="https://bips.xyz/32">BIP32</a> is used to derive the path <code>m/44'/1237'/&lt;account&gt;'/0/0</code> (according to the Nostr entry on <a href="https://github.com/satoshilabs/slips/blob/master/slip-0044.md">SLIP44</a>).</p>
<p>A basic client can simply use an <code>account</code> of <code>0</code> to derive a single key. For more advanced use-cases you can increment <code>account</code>, allowing generation of practically infinite keys from the 5-level path with hardened derivation.</p>
<p>Other types of clients can still get fancy and use other derivation paths for their own other purposes.</p>
<h3>Test vectors</h3>
<p>mnemonic: leader monkey parrot ring guide accident before fence cannon height naive bean<br>
private key (hex): 7f7ff03d123792d6ac594bfa67bf6d0c0ab55b6b1fdb6249303fe861f1ccba9a<br>
nsec: nsec10allq0gjx7fddtzef0ax00mdps9t2kmtrldkyjfs8l5xruwvh2dq0lhhkp<br>
public key (hex): 17162c921dc4d2518f9a101db33695df1afb56ab82f5ff3e5da6eec3ca5cd917<br>
npub: npub1zutzeysacnf9rru6zqwmxd54mud0k44tst6l70ja5mhv8jjumytsd2x7nu</p>
<hr>
<p>mnemonic: what bleak badge arrange retreat wolf trade produce cricket blur garlic valid proud rude strong choose busy staff weather area salt hollow arm fade<br>
private key (hex): c15d739894c81a2fcfd3a2df85a0d2c0dbc47a280d092799f144d73d7ae78add<br>
nsec: nsec1c9wh8xy5eqdzln7n5t0ctgxjcrdug73gp5yj0x03gntn67h83twssdfhel<br>
public key (hex): d41b22899549e1f3d335a31002cfd382174006e166d3e658e3a5eecdb6463573<br>
npub: npub16sdj9zv4f8sl85e45vgq9n7nsgt5qphpvmf7vk8r5hhvmdjxx4es8rq74h</p>

<h1>07</h1><h1>NIP-07</h1>
<h2><code>window.nostr</code> capability for web browsers</h2>
<p><code>draft</code> <code>optional</code> <code>author:fiatjaf</code></p>
<p>The <code>window.nostr</code> object may be made available by web browsers or extensions and websites or web-apps may make use of it after checking its availability.</p>
<p>That object must define the following methods:</p>
<pre><code>async window.nostr.getPublicKey(): string // returns a public key as hex
async window.nostr.signEvent(event: { created_at: number, kind: number, tags: string[][], content: string }): Event // takes an event object, adds `id`, `pubkey` and `sig` and returns it
</code></pre>
<p>Aside from these two basic above, the following functions can also be implemented optionally:</p>
<pre><code>async window.nostr.getRelays(): { [url: string]: {read: boolean, write: boolean} } // returns a basic map of relay urls to relay policies
async window.nostr.nip04.encrypt(pubkey, plaintext): string // returns ciphertext and iv as specified in nip-04
async window.nostr.nip04.decrypt(pubkey, ciphertext): string // takes ciphertext and iv as specified in nip-04
</code></pre>
<h3>Implementation</h3>
<ul>
<li><a href="https://github.com/fiatjaf/horse">horse</a> (Chrome and derivatives)</li>
<li><a href="https://github.com/fiatjaf/nos2x">nos2x</a> (Chrome and derivatives)</li>
<li><a href="https://getalby.com">Alby</a> (Chrome and derivatives, Firefox)</li>
<li><a href="https://www.blockcore.net/wallet">Blockcore</a> (Chrome and derivatives)</li>
<li><a href="https://diegogurpegui.com/nos2x-fox/">nos2x-fox</a> (Firefox)</li>
<li><a href="https://www.getflamingo.org/">Flamingo</a> (Chrome and derivatives)</li>
<li><a href="https://github.com/neilck/aka-extension">AKA Profiles</a> (Chrome, stores multiple keys)</li>
<li><a href="https://www.tokenpocket.pro/">TokenPocket</a> (Android, IOS, Chrome and derivatives)</li>
<li><a href="https://github.com/haorendashu/nostrmo_faq#download">Nostrmo</a> (Android, IOS)</li>
<li><a href="https://spring.site">Spring Browser</a> (Android)</li>
<li><a href="https://github.com/lightning-digital-entertainment/nodestr">nodestr</a> (NodeJS polyfill)</li>
</ul>

<h1>08</h1><blockquote>
<p><strong>Warning</strong>  <code>unrecommended</code>: deprecated in favor of <a href="27.md">NIP-27</a></p>
</blockquote>
<h1>NIP-08</h1>
<h2>Handling Mentions</h2>
<p><code>final</code> <code>unrecommended</code> <code>optional</code> <code>author:fiatjaf</code> <code>author:scsibug</code></p>
<p>This document standardizes the treatment given by clients of inline mentions of other events and pubkeys inside the content of <code>text_note</code>s.</p>
<p>Clients that want to allow tagged mentions they MUST show an autocomplete component or something analogous to that whenever the user starts typing a special key (for example, &quot;@&quot;) or presses some button to include a mention etc -- or these clients can come up with other ways to unambiguously differentiate between mentions and normal text.</p>
<p>Once a mention is identified, for example, the pubkey <code>27866e9d854c78ae625b867eefdfa9580434bc3e675be08d2acb526610d96fbe</code>, the client MUST add that pubkey to the <code>.tags</code> with the tag <code>p</code>, then replace its textual reference (inside <code>.content</code>) with the notation <code>#[index]</code> in which &quot;index&quot; is equal to the 0-based index of the related tag in the tags array.</p>
<p>The same process applies for mentioning event IDs.</p>
<p>A client that receives a <code>text_note</code> event with such <code>#[index]</code> mentions in its <code>.content</code> CAN do a search-and-replace using the actual contents from the <code>.tags</code> array with the actual pubkey or event ID that is mentioned, doing any desired context augmentation (for example, linking to the pubkey or showing a preview of the mentioned event contents) it wants in the process.</p>
<p>Where <code>#[index]</code> has an <code>index</code> that is outside the range of the tags array or points to a tag that is not an <code>e</code> or <code>p</code> tag or a tag otherwise declared to support this notation, the client MUST NOT perform such replacement or augmentation, but instead display it as normal text.</p>

<h1>09</h1><h1>NIP-09</h1>
<h2>Event Deletion</h2>
<p><code>draft</code> <code>optional</code> <code>author:scsibug</code></p>
<p>A special event with kind <code>5</code>, meaning &quot;deletion&quot; is defined as having a list of one or more <code>e</code> tags, each referencing an event the author is requesting to be deleted.</p>
<p>Each tag entry must contain an &quot;e&quot; event id and/or NIP-33 <code>a</code> tags intended for deletion.</p>
<p>The event's <code>content</code> field MAY contain a text note describing the reason for the deletion.</p>
<p>For example:</p>
<pre><code>{
  &quot;kind&quot;: 5,
  &quot;pubkey&quot;: &lt;32-bytes hex-encoded public key of the event creator&gt;,
  &quot;tags&quot;: [
    [&quot;e&quot;, &quot;dcd59..464a2&quot;],
    [&quot;e&quot;, &quot;968c5..ad7a4&quot;],
    [&quot;a&quot;, &quot;&lt;kind&gt;:&lt;pubkey&gt;:&lt;d-identifier&gt;&quot;]
  ],
  &quot;content&quot;: &quot;these posts were published by accident&quot;,
  ...other fields
}
</code></pre>
<p>Relays SHOULD delete or stop publishing any referenced events that have an identical <code>pubkey</code> as the deletion request.  Clients SHOULD hide or otherwise indicate a deletion status for referenced events.</p>
<p>Relays SHOULD continue to publish/share the deletion events indefinitely, as clients may already have the event that's intended to be deleted. Additionally, clients SHOULD broadcast deletion events to other relays which don't have it.</p>
<h2>Client Usage</h2>
<p>Clients MAY choose to fully hide any events that are referenced by valid deletion events.  This includes text notes, direct messages, or other yet-to-be defined event kinds.  Alternatively, they MAY show the event along with an icon or other indication that the author has &quot;disowned&quot; the event.  The <code>content</code> field MAY also be used to replace the deleted events' own content, although a user interface should clearly indicate that this is a deletion reason, not the original content.</p>
<p>A client MUST validate that each event <code>pubkey</code> referenced in the <code>e</code> tag of the deletion request is identical to the deletion request <code>pubkey</code>, before hiding or deleting any event.  Relays can not, in general, perform this validation and should not be treated as authoritative.</p>
<p>Clients display the deletion event itself in any way they choose, e.g., not at all, or with a prominent notice.</p>
<h2>Relay Usage</h2>
<p>Relays MAY validate that a deletion event only references events that have the same <code>pubkey</code> as the deletion itself, however this is not required since relays may not have knowledge of all referenced events.</p>
<h2>Deleting a Deletion</h2>
<p>Publishing a deletion event against a deletion has no effect.  Clients and relays are not obliged to support &quot;undelete&quot; functionality.</p>

<h1>10</h1><h1>NIP-10</h1>
<h2>On &quot;e&quot; and &quot;p&quot; tags in Text Events (kind 1).</h2>
<p><code>draft</code> <code>optional</code> <code>author:unclebobmartin</code></p>
<h2>Abstract</h2>
<p>This NIP describes how to use &quot;e&quot; and &quot;p&quot; tags in text events, especially those that are replies to other text events.  It helps clients thread the replies into a tree rooted at the original event.</p>
<h2>Positional &quot;e&quot; tags (DEPRECATED)</h2>
<blockquote>
<p>This scheme is in common use; but should be considered deprecated.</p>
</blockquote>
<p><code>[&quot;e&quot;, &lt;event-id&gt;, &lt;relay-url&gt;]</code>  as per NIP-01.</p>
<p>Where:</p>
<ul>
<li><code>&lt;event-id&gt;</code> is the id of the event being referenced.</li>
<li><code>&lt;relay-url&gt;</code> is the URL of a recommended relay associated with the reference.  Many clients treat this field as optional.</li>
</ul>
<p><strong>The positions of the &quot;e&quot; tags within the event denote specific meanings as follows</strong>:</p>
<ul>
<li>
<p>No &quot;e&quot; tag: <br>
This event is not a reply to, nor does it refer to, any other event.</p>
</li>
<li>
<p>One &quot;e&quot; tag: <br>
<code>[&quot;e&quot;, &lt;id&gt;]</code>: The id of the event to which this event is a reply.</p>
</li>
<li>
<p>Two &quot;e&quot; tags:  <code>[&quot;e&quot;, &lt;root-id&gt;]</code>, <code>[&quot;e&quot;, &lt;reply-id&gt;]</code> <br>
<code>&lt;root-id&gt;</code> is the id of the event at the root of the reply chain.  <code>&lt;reply-id&gt;</code> is the id of the article to which this event is a reply.</p>
</li>
<li>
<p>Many &quot;e&quot; tags: <code>[&quot;e&quot;, &lt;root-id&gt;]</code> <code>[&quot;e&quot;, &lt;mention-id&gt;]</code>, ..., <code>[&quot;e&quot;, &lt;reply-id&gt;]</code><br>
There may be any number of <code>&lt;mention-ids&gt;</code>.  These are the ids of events which may, or may not be in the reply chain.
They are citings from this event.  <code>root-id</code> and <code>reply-id</code> are as above.</p>
</li>
</ul>
<blockquote>
<p>This scheme is deprecated because it creates ambiguities that are difficult, or impossible to resolve when an event references another but is not a reply.</p>
</blockquote>
<h2>Marked &quot;e&quot; tags (PREFERRED)</h2>
<p><code>[&quot;e&quot;, &lt;event-id&gt;, &lt;relay-url&gt;, &lt;marker&gt;]</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;event-id&gt;</code> is the id of the event being referenced.</li>
<li><code>&lt;relay-url&gt;</code> is the URL of a recommended relay associated with the reference. Clients SHOULD add a valid <code>&lt;relay-URL&gt;</code> field, but may instead leave it as <code>&quot;&quot;</code>.</li>
<li><code>&lt;marker&gt;</code> is optional and if present is one of <code>&quot;reply&quot;</code>, <code>&quot;root&quot;</code>, or <code>&quot;mention&quot;</code>.</li>
</ul>
<p>Those marked with <code>&quot;reply&quot;</code> denote the id of the reply event being responded to.  Those marked with <code>&quot;root&quot;</code> denote the root id of the reply thread being responded to. For top level replies (those replying directly to the root event), only the <code>&quot;root&quot;</code> marker should be used. Those marked with <code>&quot;mention&quot;</code> denote a quoted or reposted event id.</p>
<p>A direct reply to the root of a thread should have a single marked &quot;e&quot; tag of type &quot;root&quot;.</p>
<blockquote>
<p>This scheme is preferred because it allows events to mention others without confusing them with <code>&lt;reply-id&gt;</code> or <code>&lt;root-id&gt;</code>.</p>
</blockquote>
<h2>The &quot;p&quot; tag</h2>
<p>Used in a text event contains a list of pubkeys used to record who is involved in a reply thread.</p>
<p>When replying to a text event E the reply event's &quot;p&quot; tags should contain all of E's &quot;p&quot; tags as well as the <code>&quot;pubkey&quot;</code> of the event being replied to.</p>
<p>Example:  Given a text event authored by <code>a1</code> with &quot;p&quot; tags [<code>p1</code>, <code>p2</code>, <code>p3</code>] then the &quot;p&quot; tags of the reply should be [<code>a1</code>, <code>p1</code>, <code>p2</code>, <code>p3</code>]
in no particular order.</p>

<h1>11</h1><h1>NIP-11</h1>
<h2>Relay Information Document</h2>
<p><code>draft</code> <code>optional</code> <code>author:scsibug</code> <code>author:doc-hex</code> <code>author:cameri</code></p>
<p>Relays may provide server metadata to clients to inform them of capabilities, administrative contacts, and various server attributes.  This is made available as a JSON document over HTTP, on the same URI as the relay's websocket.</p>
<p>When a relay receives an HTTP(s) request with an <code>Accept</code> header of <code>application/nostr+json</code> to a URI supporting WebSocket upgrades, they SHOULD return a document with the following structure.</p>
<pre><code class="language-json">{
  &quot;name&quot;: &lt;string identifying relay&gt;,
  &quot;description&quot;: &lt;string with detailed information&gt;,
  &quot;pubkey&quot;: &lt;administrative contact pubkey&gt;,
  &quot;contact&quot;: &lt;administrative alternate contact&gt;,
  &quot;supported_nips&quot;: &lt;a list of NIP numbers supported by the relay&gt;,
  &quot;software&quot;: &lt;string identifying relay software URL&gt;,
  &quot;version&quot;: &lt;string version identifier&gt;
}
</code></pre>
<p>Any field may be omitted, and clients MUST ignore any additional fields they do not understand. Relays MUST accept CORS requests by sending <code>Access-Control-Allow-Origin</code>, <code>Access-Control-Allow-Headers</code>, and <code>Access-Control-Allow-Methods</code> headers.</p>
<h2>Field Descriptions</h2>
<h3>Name</h3>
<p>A relay may select a <code>name</code> for use in client software.  This is a string, and SHOULD be less than 30 characters to avoid client truncation.</p>
<h3>Description</h3>
<p>Detailed plain-text information about the relay may be contained in the <code>description</code> string.  It is recommended that this contain no markup, formatting or line breaks for word wrapping, and simply use double newline characters to separate paragraphs.  There are no limitations on length.</p>
<h3>Pubkey</h3>
<p>An administrative contact may be listed with a <code>pubkey</code>, in the same format as Nostr events (32-byte hex for a <code>secp256k1</code> public key).  If a contact is listed, this provides clients with a recommended address to send encrypted direct messages (See <code>NIP-04</code>) to a system administrator.  Expected uses of this address are to report abuse or illegal content, file bug reports, or request other technical assistance.</p>
<p>Relay operators have no obligation to respond to direct messages.</p>
<h3>Contact</h3>
<p>An alternative contact may be listed under the <code>contact</code> field as well, with the same purpose as <code>pubkey</code>.  Use of a Nostr public key and direct message SHOULD be preferred over this.  Contents of this field SHOULD be a URI, using schemes such as <code>mailto</code> or <code>https</code> to provide users with a means of contact.</p>
<h3>Supported NIPs</h3>
<p>As the Nostr protocol evolves, some functionality may only be available by relays that implement a specific <code>NIP</code>.  This field is an array of the integer identifiers of <code>NIP</code>s that are implemented in the relay.  Examples would include <code>1</code>, for <code>&quot;NIP-01&quot;</code> and <code>9</code>, for <code>&quot;NIP-09&quot;</code>.  Client-side <code>NIPs</code> SHOULD NOT be advertised, and can be ignored by clients.</p>
<h3>Software</h3>
<p>The relay server implementation MAY be provided in the <code>software</code> attribute.  If present, this MUST be a URL to the project's homepage.</p>
<h3>Version</h3>
<p>The relay MAY choose to publish its software version as a string attribute.  The string format is defined by the relay implementation.  It is recommended this be a version number or commit identifier.</p>
<h2>Extra Fields</h2>
<h3>Server Limitations</h3>
<p>These are limitations imposed by the relay on clients. Your client
should expect that requests which exceed these <em>practical</em> limitations
are rejected or fail immediately.</p>
<pre><code class="language-json">{
...
  &quot;limitation&quot;: {
        &quot;max_message_length&quot;: 16384,
        &quot;max_subscriptions&quot;: 20,
        &quot;max_filters&quot;: 100,
        &quot;max_limit&quot;: 5000,
        &quot;max_subid_length&quot;: 100,
        &quot;max_event_tags&quot;: 100,
        &quot;max_content_length&quot;: 8196,
        &quot;min_pow_difficulty&quot;: 30,
        &quot;auth_required&quot;: true,
        &quot;payment_required&quot;: true,
        &quot;created_at_lower_limit&quot;:31536000,
        &quot;created_at_upper_limit&quot;:3,
  }
...
}
</code></pre>
<ul>
<li>
<p><code>max_message_length</code>: this is the maximum number of bytes for incoming JSON that the relay
will attempt to decode and act upon. When you send large subscriptions, you will be
limited by this value. It also effectively limits the maximum size of any event. Value is
calculated from <code>[</code> to <code>]</code> and is after UTF-8 serialization (so some unicode characters
will cost 2-3 bytes). It is equal to the maximum size of the WebSocket message frame.</p>
</li>
<li>
<p><code>max_subscriptions</code>: total number of subscriptions that may be
active on a single websocket connection to this relay. It's possible
that authenticated clients with a (paid) relationship to the relay
may have higher limits.</p>
</li>
<li>
<p><code>max_filters</code>: maximum number of filter values in each subscription.
Must be one or higher.</p>
</li>
<li>
<p><code>max_subid_length</code>: maximum length of subscription id as a string.</p>
</li>
<li>
<p><code>max_limit</code>: the relay server will clamp each filter's <code>limit</code> value to this number.
This means the client won't be able to get more than this number
of events from a single subscription filter. This clamping is typically done silently
by the relay, but with this number, you can know that there are additional results
if you narrowed your filter's time range or other parameters.</p>
</li>
<li>
<p><code>max_event_tags</code>: in any event, this is the maximum number of elements in the <code>tags</code> list.</p>
</li>
<li>
<p><code>max_content_length</code>: maximum number of characters in the <code>content</code>
field of any event. This is a count of unicode characters. After
serializing into JSON it may be larger (in bytes), and is still
subject to the <code>max_message_length</code>, if defined.</p>
</li>
<li>
<p><code>min_pow_difficulty</code>: new events will require at least this difficulty of PoW,
based on <a href="13.md">NIP-13</a>, or they will be rejected by this server.</p>
</li>
<li>
<p><code>auth_required</code>: this relay requires <a href="42.md">NIP-42</a> authentication
to happen before a new connection may perform any other action.
Even if set to False, authentication may be required for specific actions.</p>
</li>
<li>
<p><code>payment_required</code>: this relay requires payment before a new connection may perform any action.</p>
</li>
<li>
<p><code>created_at_lower_limit</code>: 'created_at' lower limit as defined in <a href="22.md">NIP-22</a></p>
</li>
<li>
<p><code>created_at_upper_limit</code>: 'created_at' upper limit as defined in <a href="22.md">NIP-22</a></p>
</li>
</ul>
<h3>Event Retention</h3>
<p>There may be a cost associated with storing data forever, so relays
may wish to state retention times. The values stated here are defaults
for unauthenticated users and visitors. Paid users would likely have
other policies.</p>
<p>Retention times are given in seconds, with <code>null</code> indicating infinity.
If zero is provided, this means the event will not be stored at
all, and preferably an error will be provided when those are received.</p>
<pre><code class="language-json">{
...
  &quot;retention&quot;: [
    { &quot;kinds&quot;: [0, 1, [5, 7], [40, 49]], &quot;time&quot;: 3600 },
    { &quot;kinds&quot;: [[40000, 49999]], &quot;time&quot;: 100 },
    { &quot;kinds&quot;: [[30000, 39999]], &quot;count&quot;: 1000 },
    { &quot;time&quot;: 3600, &quot;count&quot;: 10000 }
  ]
...
}
</code></pre>
<p><code>retention</code> is a list of specifications: each will apply to either all kinds, or
a subset of kinds. Ranges may be specified for the kind field as a tuple of inclusive
start and end values. Events of indicated kind (or all) are then limited to a <code>count</code>
and/or time period.</p>
<p>It is possible to effectively blacklist Nostr-based protocols that rely on
a specific <code>kind</code> number, by giving a retention time of zero for those <code>kind</code> values.
While that is unfortunate, it does allow clients to discover servers that will
support their protocol quickly via a single HTTP fetch.</p>
<p>There is no need to specify retention times for <em>ephemeral events</em> since they are not retained.</p>
<h3>Content Limitations</h3>
<p>Some relays may be governed by the arbitrary laws of a nation state. This
may limit what content can be stored in cleartext on those relays. All
clients are encouraged to use encryption to work around this limitation.</p>
<p>It is not possible to describe the limitations of each country's laws
and policies which themselves are typically vague and constantly shifting.</p>
<p>Therefore, this field allows the relay operator to indicate which
countries' laws might end up being enforced on them, and then
indirectly on their users' content.</p>
<p>Users should be able to avoid relays in countries they don't like,
and/or select relays in more favourable zones. Exposing this
flexibility is up to the client software.</p>
<pre><code class="language-json">{
...
  &quot;relay_countries&quot;: [ &quot;CA&quot;, &quot;US&quot; ],
...
}
</code></pre>
<ul>
<li><code>relay_countries</code>: a list of two-level ISO country codes (ISO 3166-1 alpha-2)  whose
laws and policies may affect this relay. <code>EU</code> may be used for European Union countries.</li>
</ul>
<p>Remember that a relay may be hosted in a country which is not the
country of the legal entities who own the relay, so it's very
likely a number of countries are involved.</p>
<h3>Community Preferences</h3>
<p>For public text notes at least, a relay may try to foster a
local community. This would encourage users to follow the global
feed on that relay, in addition to their usual individual follows.
To support this goal, relays MAY specify some of the following values.</p>
<pre><code class="language-json">{
...
  &quot;language_tags&quot;: [ &quot;en&quot;, &quot;en-419&quot; ],
  &quot;tags&quot;: [ &quot;sfw-only&quot;, &quot;bitcoin-only&quot;, &quot;anime&quot; ],
  &quot;posting_policy&quot;: &quot;https://example.com/posting-policy.html&quot;,
...
}
</code></pre>
<ul>
<li>
<p><code>language_tags</code> is an ordered list
of <a href="https://en.wikipedia.org/wiki/IETF_language_tag">IETF language tags</a> indicating
the major languages spoken on the relay.</p>
</li>
<li>
<p><code>tags</code> is a list of limitations on the topics to be discussed.
For example <code>sfw-only</code> indicates that only &quot;Safe For Work&quot; content
is encouraged on this relay. This relies on assumptions of what the
&quot;work&quot; &quot;community&quot; feels &quot;safe&quot; talking about. In time, a common
set of tags may emerge that allow users to find relays that suit
their needs, and client software will be able to parse these tags easily.
The <code>bitcoin-only</code> tag indicates that any <em>altcoin</em>, <em>&quot;crypto&quot;</em> or <em>blockchain</em>
comments will be ridiculed without mercy.</p>
</li>
<li>
<p><code>posting_policy</code> is a link to a human-readable page which specifies the
community policies for the relay. In cases where <code>sfw-only</code> is True, it's
important to link to a page which gets into the specifics of your posting policy.</p>
</li>
</ul>
<p>The <code>description</code> field should be used to describe your community
goals and values, in brief. The <code>posting_policy</code> is for additional
detail and legal terms. Use the <code>tags</code> field to signify limitations
on content, or topics to be discussed, which could be machine
processed by appropriate client software.</p>
<h3>Pay-To-Relay</h3>
<p>Relays that require payments may want to expose their fee schedules.</p>
<pre><code class="language-json">{
...
  &quot;payments_url&quot;: &quot;https://my-relay/payments&quot;,
  &quot;fees&quot;: {
    &quot;admission&quot;: [{ &quot;amount&quot;: 1000000, &quot;unit&quot;: &quot;msats&quot; }],
    &quot;subscription&quot;: [{ &quot;amount&quot;: 5000000, &quot;unit&quot;: &quot;msats&quot;, &quot;period&quot;: 2592000 }],
    &quot;publication&quot;: [{ &quot;kinds&quot;: [4], &quot;amount&quot;: 100, &quot;unit&quot;: &quot;msats&quot; }],
  },
...
}
</code></pre>
<h3>Icon</h3>
<p>A URL pointing to an image to be used as an icon for the relay. Recommended to be squared in shape.</p>
<pre><code class="language-json">{
...
  &quot;icon&quot;: &quot;https://nostr.build/i/53866b44135a27d624e99c6165cabd76ac8f72797209700acb189fce75021f47.jpg&quot;,
...
}
</code></pre>
<h3>Examples</h3>
<p>As of 2 May 2023 the following <code>curl</code> command provided these results.</p>
<pre><code>&gt;curl -H &quot;Accept: application/nostr+json&quot; https://eden.nostr.land

{&quot;name&quot;:&quot;eden.nostr.land&quot;,
&quot;description&quot;:&quot;Eden Nostr Land - Toronto 1-01&quot;,
&quot;pubkey&quot;:&quot;00000000827ffaa94bfea288c3dfce4422c794fbb96625b6b31e9049f729d700&quot;,
&quot;contact&quot;:&quot;me@ricardocabral.io&quot;,
&quot;supported_nips&quot;:[1,2,4,9,11,12,15,16,20,22,26,28,33,40],
&quot;supported_nip_extensions&quot;:[&quot;11a&quot;],
&quot;software&quot;:&quot;git+https://github.com/Cameri/nostream.git&quot;,
&quot;version&quot;:&quot;1.22.6&quot;,
&quot;limitation&quot;:{&quot;max_message_length&quot;:1048576,
			  &quot;max_subscriptions&quot;:10,
			  &quot;max_filters&quot;:2500,
			  &quot;max_limit&quot;:5000,
			  &quot;max_subid_length&quot;:256,
			  &quot;max_event_tags&quot;:2500,
			  &quot;max_content_length&quot;:65536,
			  &quot;min_pow_difficulty&quot;:0,
			  &quot;auth_required&quot;:false,
			  &quot;payment_required&quot;:true},
&quot;payments_url&quot;:&quot;https://eden.nostr.land/invoices&quot;,
&quot;fees&quot;:{&quot;admission&quot;:[{&quot;amount&quot;:5000000,&quot;unit&quot;:&quot;msats&quot;}],
        &quot;publication&quot;:[]}},
&quot;icon&quot;: &quot;https://nostr.build/i/53866b44135a27d624e99c6165cabd76ac8f72797209700acb189fce75021f47.jpg&quot;
</code></pre>

<h1>12</h1><h1>NIP-12</h1>
<h2>Generic Tag Queries</h2>
<p><code>final</code> <code>mandatory</code> <code>author:scsibug</code> <code>author:fiatjaf</code></p>
<p>Moved to <a href="01.md">NIP-01</a>.</p>

<h1>13</h1><h1>NIP-13</h1>
<h2>Proof of Work</h2>
<p><code>draft</code> <code>optional</code> <code>author:jb55</code> <code>author:cameri</code></p>
<p>This NIP defines a way to generate and interpret Proof of Work for nostr notes. Proof of Work (PoW) is a way to add a proof of computational work to a note. This is a bearer proof that all relays and clients can universally validate with a small amount of code. This proof can be used as a means of spam deterrence.</p>
<p><code>difficulty</code> is defined to be the number of leading zero bits in the <code>NIP-01</code> id. For example, an id of <code>000000000e9d97a1ab09fc381030b346cdd7a142ad57e6df0b46dc9bef6c7e2d</code> has a difficulty of <code>36</code> with <code>36</code> leading 0 bits.</p>
<p><code>002f...</code> is <code>0000 0000 0010 1111...</code> in binary, which has 10 leading zeroes. Do not forget to count leading zeroes for hex digits &lt;= <code>7</code>.</p>
<h2>Mining</h2>
<p>To generate PoW for a <code>NIP-01</code> note, a <code>nonce</code> tag is used:</p>
<pre><code class="language-json">{&quot;content&quot;: &quot;It's just me mining my own business&quot;, &quot;tags&quot;: [[&quot;nonce&quot;, &quot;1&quot;, &quot;21&quot;]]}
</code></pre>
<p>When mining, the second entry to the nonce tag is updated, and then the id is recalculated (see <a href="./01.md">NIP-01</a>). If the id has the desired number of leading zero bits, the note has been mined. It is recommended to update the <code>created_at</code> as well during this process.</p>
<p>The third entry to the nonce tag <code>SHOULD</code> contain the target difficulty. This allows clients to protect against situations where bulk spammers targeting a lower difficulty get lucky and match a higher difficulty. For example, if you require 40 bits to reply to your thread and see a committed target of 30, you can safely reject it even if the note has 40 bits difficulty. Without a committed target difficulty you could not reject it. Committing to a target difficulty is something all honest miners should be ok with, and clients <code>MAY</code> reject a note matching a target difficulty if it is missing a difficulty commitment.</p>
<h2>Example mined note</h2>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;000006d8c378af1779d2feebc7603a125d99eca0ccf1085959b307f64e5dd358&quot;,
  &quot;pubkey&quot;: &quot;a48380f4cfcc1ad5378294fcac36439770f9c878dd880ffa94bb74ea54a6f243&quot;,
  &quot;created_at&quot;: 1651794653,
  &quot;kind&quot;: 1,
  &quot;tags&quot;: [
    [
      &quot;nonce&quot;,
      &quot;776797&quot;,
      &quot;21&quot;
    ]
  ],
  &quot;content&quot;: &quot;It's just me mining my own business&quot;,
  &quot;sig&quot;: &quot;284622fc0a3f4f1303455d5175f7ba962a3300d136085b9566801bc2e0699de0c7e31e44c81fb40ad9049173742e904713c3594a1da0fc5d2382a25c11aba977&quot;
}
</code></pre>
<h2>Validating</h2>
<p>Here is some reference C code for calculating the difficulty (aka number of leading zero bits) in a nostr event id:</p>
<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

int countLeadingZeroes(const char *hex) {
    int count = 0;

    for (int i = 0; i &lt; strlen(hex); i++) {
        int nibble = (int)strtol((char[]){hex[i], '\0'}, NULL, 16);
        if (nibble == 0) {
            count += 4;
        } else {
            count += __builtin_clz(nibble) - 28;
            break;
        }
    }

    return count;
}

int main(int argc, char *argv[]) {
    if (argc != 2) {
        fprintf(stderr, &quot;Usage: %s &lt;hex_string&gt;\n&quot;, argv[0]);
        return 1;
    }

    const char *hex_string = argv[1];
    int result = countLeadingZeroes(hex_string);
    printf(&quot;Leading zeroes in hex string %s: %d\n&quot;, hex_string, result);

    return 0;
}
</code></pre>
<p>Here is some JavaScript code for doing the same thing:</p>
<pre><code class="language-javascript">// hex should be a hexadecimal string (with no 0x prefix)
function countLeadingZeroes(hex) {
  let count = 0;

  for (let i = 0; i &lt; hex.length; i++) {
    const nibble = parseInt(hex[i], 16);
    if (nibble === 0) {
      count += 4;
    } else {
      count += Math.clz32(nibble) - 28;
      break;
    }
  }

  return count;
}
</code></pre>
<h2>Querying relays for PoW notes</h2>
<p>If relays allow searching on prefixes, you can use this as a way to filter notes of a certain difficulty:</p>
<pre><code>$ echo '[&quot;REQ&quot;, &quot;subid&quot;, {&quot;ids&quot;: [&quot;000000000&quot;]}]'  | websocat wss://some-relay.com | jq -c '.[2]'
{&quot;id&quot;:&quot;000000000121637feeb68a06c8fa7abd25774bdedfa9b6ef648386fb3b70c387&quot;, ...}
</code></pre>
<h2>Delegated Proof of Work</h2>
<p>Since the <code>NIP-01</code> note id does not commit to any signature, PoW can be outsourced to PoW providers, perhaps for a fee. This provides a way for clients to get their messages out to PoW-restricted relays without having to do any work themselves, which is useful for energy-constrained devices like mobile phones.</p>

<h1>14</h1><h1>NIP-14</h1>
<h2>Subject tag in Text events</h2>
<p><code>draft</code> <code>optional</code> <code>author:unclebobmartin</code></p>
<p>This NIP defines the use of the &quot;subject&quot; tag in text (kind: 1) events.<br>
(implemented in more-speech)</p>
<p><code>[&quot;subject&quot;: &lt;string&gt;]</code></p>
<p>Browsers often display threaded lists of messages.  The contents of the subject tag can be used in such lists, instead of the more ad hoc approach of using the first few words of the message.  This is very similar to the way email browsers display lists of incoming emails by subject rather than by contents.</p>
<p>When replying to a message with a subject, clients SHOULD replicate the subject tag.  Clients MAY adorn the subject to denote
that it is a reply.  e.g. by prepending &quot;Re:&quot;.</p>
<p>Subjects should generally be shorter than 80 chars.  Long subjects will likely be trimmed by clients.</p>

<h1>15</h1><h1>NIP-15</h1>
<h2>Nostr Marketplace (for resilient marketplaces)</h2>
<p><code>draft</code> <code>optional</code> <code>author:fiatjaf</code> <code>author:benarc</code>  <code>author:motorina0</code> <code>author:talvasconcelos</code></p>
<blockquote>
<p>Based on https://github.com/lnbits/Diagon-Alley</p>
</blockquote>
<blockquote>
<p>Implemented in <a href="https://github.com/lnbits/nostrmarket">NostrMarket</a> and <a href="https://github.com/PlebeianTech/plebeian-market">Plebeian Market</a></p>
</blockquote>
<h2>Terms</h2>
<ul>
<li><code>merchant</code> - seller of products with NOSTR key-pair</li>
<li><code>customer</code> - buyer of products with NOSTR key-pair</li>
<li><code>product</code> - item for sale by the <code>merchant</code></li>
<li><code>stall</code> - list of products controlled by <code>merchant</code> (a <code>merchant</code> can have multiple stalls)</li>
<li><code>marketplace</code> - clientside software for searching <code>stalls</code> and purchasing <code>products</code></li>
</ul>
<h2>Nostr Marketplace Clients</h2>
<h3>Merchant admin</h3>
<p>Where the <code>merchant</code> creates, updates and deletes <code>stalls</code> and <code>products</code>, as well as where they manage sales, payments and communication with <code>customers</code>.</p>
<p>The <code>merchant</code> admin software can be purely clientside, but for <code>convenience</code> and uptime, implementations will likely have a server client listening for NOSTR events.</p>
<h3>Marketplace</h3>
<p><code>Marketplace</code> software should be entirely clientside, either as a stand-alone app, or as a purely frontend.jpgage. A <code>customer</code> subscribes to different merchant NOSTR public keys, and those <code>merchants</code> <code>stalls</code> and <code>products</code> become listed and searchable. The marketplace client is like any other ecommerce site, with basket and checkout. <code>Marketplaces</code> may also wish to include a <code>customer</code> support area for direct message communication with <code>merchants</code>.</p>
<h2><code>Merchant</code> publishing/updating products (event)</h2>
<p>A merchant can publish these events:</p>
<table>
<thead>
<tr>
<th>Kind</th>
<th></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0    </code></td>
<td><code>set_meta</code></td>
<td>The merchant description (similar with any <code>nostr</code> public key).</td>
</tr>
<tr>
<td><code>30017</code></td>
<td><code>set_stall</code></td>
<td>Create or update a stall.</td>
</tr>
<tr>
<td><code>30018</code></td>
<td><code>set_product</code></td>
<td>Create or update a product.</td>
</tr>
<tr>
<td><code>4    </code></td>
<td><code>direct_message</code></td>
<td>Communicate with the customer. The messages can be plain-text or JSON.</td>
</tr>
<tr>
<td><code>5    </code></td>
<td><code>delete</code></td>
<td>Delete a product or a stall.</td>
</tr>
</tbody>
</table>
<h3>Event <code>30017</code>: Create or update a stall.</h3>
<p><strong>Event Content</strong>:</p>
<pre><code class="language-json">{
    &quot;id&quot;: &lt;String, UUID generated by the merchant. Sequential IDs (`0`, `1`, `2`...) are discouraged&gt;,
    &quot;name&quot;: &lt;String, stall name&gt;,
    &quot;description&quot;: &lt;String (optional), stall description&gt;,
    &quot;currency&quot;: &lt;String, currency used&gt;,
    &quot;shipping&quot;: [
        {
            &quot;id&quot;: &lt;String, UUID of the shipping zone, generated by the merchant&gt;,
            &quot;name&quot;: &lt;String (optional), zone name&gt;,
            &quot;cost&quot;: &lt;float, base cost for shipping. The currency is defined at the stall level&gt;,
            &quot;regions&quot;: [&lt;String, regions included in this zone&gt;],
        }
    ]
}
</code></pre>
<p>Fields that are not self-explanatory:</p>
<ul>
<li><code>shipping</code>:
<ul>
<li>an array with possible shipping zones for this stall.</li>
<li>the customer MUST choose exactly one of those shipping zones.</li>
<li>shipping to different zones can have different costs. For some goods (digital for example) the cost can be zero.</li>
<li>the <code>id</code> is an internal value used by the merchant. This value must be sent back as the customer selection.</li>
<li>each shipping zone contains the base cost for orders made to that shipping zone, but a specific shipping cost per
product can also be specified if the shipping cost for that product is higher than what's specified by the base cost.</li>
</ul>
</li>
</ul>
<p><strong>Event Tags</strong>:</p>
<pre><code class="language-json">  &quot;tags&quot;: [[&quot;d&quot;, &lt;String, id of stall]]
</code></pre>
<ul>
<li>the <code>d</code> tag is required, its value MUST be the same as the stall <code>id</code>.</li>
</ul>
<h3>Event <code>30018</code>: Create or update a product</h3>
<p><strong>Event Content</strong>:</p>
<pre><code class="language-json">{
    &quot;id&quot;: &lt;String, UUID generated by the merchant.Sequential IDs (`0`, `1`, `2`...) are discouraged&gt;,
    &quot;stall_id&quot;: &lt;String, UUID of the stall to which this product belong to&gt;,
    &quot;name&quot;: &lt;String, product name&gt;,
    &quot;description&quot;: &lt;String (optional), product description&gt;,
    &quot;images&quot;: &lt;[String], array of image URLs, optional&gt;,
    &quot;currency&quot;: &lt;String, currency used&gt;,
    &quot;price&quot;: &lt;float, cost of product&gt;,
    &quot;quantity&quot;: &lt;int, available items&gt;,
    &quot;specs&quot;: [
        [&lt;String, spec key&gt;, &lt;String, spec value&gt;]
    ],
    &quot;shipping&quot;: [
        {
            &quot;id&quot;: &lt;String, UUID of the shipping zone. Must match one of the zones defined for the stall&gt;,
            &quot;cost&quot;: &lt;float, extra cost for shipping. The currency is defined at the stall level&gt;,
        }
    ]
}
</code></pre>
<p>Fields that are not self-explanatory:</p>
<ul>
<li>
<p><code>specs</code>:</p>
<ul>
<li>an optional array of key pair values. It allows for the Customer UI to present product specifications in a structure mode. It also allows comparison between products</li>
<li>eg: <code>[[&quot;operating_system&quot;, &quot;Android 12.0&quot;], [&quot;screen_size&quot;, &quot;6.4 inches&quot;], [&quot;connector_type&quot;, &quot;USB Type C&quot;]]</code></li>
</ul>
<p><em>Open</em>: better to move <code>spec</code> in the <code>tags</code> section of the event?</p>
</li>
<li>
<p><code>shipping</code>:</p>
<ul>
<li>an <em>optional</em> array of extra costs to be used per shipping zone, only for products that require special shipping costs to be added to the base shipping cost defined in the stall</li>
<li>the <code>id</code> should match the id of the shipping zone, as defined in the <code>shipping</code> field of the stall</li>
<li>to calculate the total cost of shipping for an order, the user will choose a shipping option during checkout, and then the client must consider this costs:
<ul>
<li>the <code>base cost from the stall</code> for the chosen shipping option</li>
<li>the result of multiplying the product units by the <code>shipping costs specified in the product</code>, if any.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Event Tags</strong>:</p>
<pre><code class="language-json">  &quot;tags&quot;: [
       [&quot;d&quot;, &lt;String, id of product],
       [&quot;t&quot;, &lt;String (optional), product category],
       [&quot;t&quot;, &lt;String (optional), product category],
       ...
    ]
</code></pre>
<ul>
<li>the <code>d</code> tag is required, its value MUST be the same as the product <code>id</code>.</li>
<li>the <code>t</code> tag is as searchable tag, it represents different categories that the product can be part of (<code>food</code>, <code>fruits</code>). Multiple <code>t</code> tags can be present.</li>
</ul>
<h2>Checkout events</h2>
<p>All checkout events are sent as JSON strings using (<a href="https://github.com/nostr-protocol/nips/blob/master/04.md">NIP04</a>).</p>
<p>The <code>merchant</code> and the <code>customer</code> can exchange JSON messages that represent different actions. Each <code>JSON</code> message <code>MUST</code> have a <code>type</code> field indicating the what the JSON represents. Possible types:</p>
<table>
<thead>
<tr>
<th>Message Type</th>
<th>Sent By</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Customer</td>
<td>New Order</td>
</tr>
<tr>
<td>1</td>
<td>Merchant</td>
<td>Payment Request</td>
</tr>
<tr>
<td>2</td>
<td>Merchant</td>
<td>Order Status Update</td>
</tr>
</tbody>
</table>
<h3>Step 1: <code>customer</code> order (event)</h3>
<p>The below json goes in content of <a href="https://github.com/nostr-protocol/nips/blob/master/04.md">NIP04</a>.</p>
<pre><code class="language-json">{
    &quot;id&quot;: &lt;String, UUID generated by the customer&gt;,
    &quot;type&quot;: 0,
    &quot;name&quot;: &lt;String (optional), ???&gt;,
    &quot;address&quot;: &lt;String (optional), for physical goods an address should be provided&gt;
    &quot;message&quot;: &quot;&lt;String (optional), message for merchant&gt;,
    &quot;contact&quot;: {
        &quot;nostr&quot;: &lt;32-bytes hex of a pubkey&gt;,
        &quot;phone&quot;: &lt;String (optional), if the customer wants to be contacted by phone&gt;,
        &quot;email&quot;: &lt;String (optional), if the customer wants to be contacted by email&gt;,
    },
    &quot;items&quot;: [
        {
            &quot;product_id&quot;: &lt;String, UUID of the product&gt;,
            &quot;quantity&quot;: &lt;int, how many products the customer is ordering&gt;
        }
    ],
    &quot;shipping_id&quot;: &lt;String, UUID of the shipping zone&gt;
}

</code></pre>
<p><em>Open</em>: is <code>contact.nostr</code> required?</p>
<h3>Step 2: <code>merchant</code> request payment (event)</h3>
<p>Sent back from the merchant for payment. Any payment option is valid that the merchant can check.</p>
<p>The below json goes in <code>content</code> of <a href="https://github.com/nostr-protocol/nips/blob/master/04.md">NIP04</a>.</p>
<p><code>payment_options</code>/<code>type</code> include:</p>
<ul>
<li><code>url</code> URL to a payment page, stripe, paypal, btcpayserver, etc</li>
<li><code>btc</code> onchain bitcoin address</li>
<li><code>ln</code> bitcoin lightning invoice</li>
<li><code>lnurl</code> bitcoin lnurl-pay</li>
</ul>
<pre><code class="language-json">{
    &quot;id&quot;: &lt;String, UUID of the order&gt;,
    &quot;type&quot;: 1,
    &quot;message&quot;: &lt;String, message to customer, optional&gt;,
    &quot;payment_options&quot;: [
        {
            &quot;type&quot;: &lt;String, option type&gt;,
            &quot;link&quot;: &lt;String, url, btc address, ln invoice, etc&gt;
        },
        {
            &quot;type&quot;: &lt;String, option type&gt;,
            &quot;link&quot;: &lt;String, url, btc address, ln invoice, etc&gt;
        },
                {
            &quot;type&quot;: &lt;String, option type&gt;,
            &quot;link&quot;: &lt;String, url, btc address, ln invoice, etc&gt;
        }
    ]
}
</code></pre>
<h3>Step 3: <code>merchant</code> verify payment/shipped (event)</h3>
<p>Once payment has been received and processed.</p>
<p>The below json goes in <code>content</code> of <a href="https://github.com/nostr-protocol/nips/blob/master/04.md">NIP04</a>.</p>
<pre><code class="language-json">{
    &quot;id&quot;: &lt;String, UUID of the order&gt;,
    &quot;type&quot;: 2,
    &quot;message&quot;: &lt;String, message to customer&gt;,
    &quot;paid&quot;: &lt;Bool, true/false has received payment&gt;,
    &quot;shipped&quot;: &lt;Bool, true/false has been shipped&gt;,
}
</code></pre>
<h2>Customize Marketplace</h2>
<p>Create a customized user experience using the <code>naddr</code> from <a href="https://github.com/nostr-protocol/nips/blob/master/19.md#shareable-identifiers-with-extra-metadata">NIP-19</a>. The use of <code>naddr</code> enables easy sharing of marketplace events while incorporating a rich set of metadata. This metadata can include relays, merchant profiles, and more. Subsequently, it allows merchants to be grouped into a market, empowering the market creator to configure the marketplace's user interface and user experience, and share that marketplace. This customization can encompass elements such as market name, description, logo, banner, themes, and even color schemes, offering a tailored and unique marketplace experience.</p>
<h3>Event <code>30019</code>: Create or update marketplace UI/UX</h3>
<p><strong>Event Content</strong>:</p>
<pre><code class="language-json">{
    &quot;name&quot;: &lt;String (optional), market name&gt;,
    &quot;about&quot;: &lt;String (optional), market description&gt;,
    &quot;ui&quot;: {
      &quot;picture&quot;: &lt;String (optional), market logo image URL&gt;,
      &quot;banner&quot;: &lt;String (optional), market logo banner URL&gt;,
      &quot;theme&quot;: &lt;String (optional), market theme&gt;,
      &quot;darkMode&quot;: &lt;Bool, true/false&gt;
    },
    &quot;merchants&quot;: &lt;[String] (optional), array of pubkeys&gt;,
    ...
}
</code></pre>
<p>This event leverages naddr to enable comprehensive customization and sharing of marketplace configurations, fostering a unique and engaging marketplace environment.</p>
<h2>Customer support events</h2>
<p>Customer support is handled over whatever communication method was specified. If communicating via nostr, NIP-04 is used https://github.com/nostr-protocol/nips/blob/master/04.md.</p>
<h2>Additional</h2>
<p>Standard data models can be found <a href="https://raw.githubusercontent.com/lnbits/nostrmarket/main/models.py">here</a></p>

<h1>16</h1><h1>NIP-16</h1>
<h2>Event Treatment</h2>
<p><code>final</code> <code>mandatory</code> <code>author:Semisol</code></p>
<p>Moved to <a href="01.md">NIP-01</a>.</p>

<h1>18</h1><h1>NIP-18</h1>
<h2>Reposts</h2>
<p><code>draft</code> <code>optional</code> <code>author:jb55</code> <code>author:fiatjaf</code> <code>author:arthurfranca</code></p>
<p>A repost is a <code>kind 6</code> event that is used to signal to followers
that a <code>kind 1</code> text note is worth reading.</p>
<p>The <code>content</code> of a repost event is <em>the stringified JSON of the reposted note</em>. It MAY also be empty, but that is not recommended.</p>
<p>The repost event MUST include an <code>e</code> tag with the <code>id</code> of the note that is
being reposted. That tag MUST include a relay URL as its third entry
to indicate where it can be fetched.</p>
<p>The repost SHOULD include a <code>p</code> tag with the <code>pubkey</code> of the event being
reposted.</p>
<h2>Quote Reposts</h2>
<p>Quote reposts are <code>kind 1</code> events with an embedded <code>e</code> tag
(see <a href="08.md">NIP-08</a> and <a href="27.md">NIP-27</a>). Because a quote repost includes
an <code>e</code> tag, it may show up along replies to the reposted note.</p>
<h2>Generic Reposts</h2>
<p>Since <code>kind 6</code> reposts are reserved for <code>kind 1</code> contents, we use <code>kind 16</code>
as a &quot;generic repost&quot;, that can include any kind of event inside other than
<code>kind 1</code>.</p>
<p><code>kind 16</code> reposts SHOULD contain a <code>k</code> tag with the stringified kind number
of the reposted event as its value.</p>

<h1>19</h1><h1>NIP-19</h1>
<h2>bech32-encoded entities</h2>
<p><code>draft</code> <code>optional</code> <code>author:jb55</code> <code>author:fiatjaf</code> <code>author:Semisol</code></p>
<p>This NIP standardizes bech32-formatted strings that can be used to display keys, ids and other information in clients. These formats are not meant to be used anywhere in the core protocol, they are only meant for displaying to users, copy-pasting, sharing, rendering QR codes and inputting data.</p>
<p>It is recommended that ids and keys are stored in either hex or binary format, since these formats are closer to what must actually be used the core protocol.</p>
<h2>Bare keys and ids</h2>
<p>To prevent confusion and mixing between private keys, public keys and event ids, which are all 32 byte strings. bech32-(not-m) encoding with different prefixes can be used for each of these entities.</p>
<p>These are the possible bech32 prefixes:</p>
<ul>
<li><code>npub</code>: public keys</li>
<li><code>nsec</code>: private keys</li>
<li><code>note</code>: note ids</li>
</ul>
<p>Example: the hex public key <code>3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d</code> translates to <code>npub180cvv07tjdrrgpa0j7j7tmnyl2yr6yr7l8j4s3evf6u64th6gkwsyjh6w6</code>.</p>
<p>The bech32 encodings of keys and ids are not meant to be used inside the standard NIP-01 event formats or inside the filters, they're meant for human-friendlier display and input only. Clients should still accept keys in both hex and npub format for now, and convert internally.</p>
<h2>Shareable identifiers with extra metadata</h2>
<p>When sharing a profile or an event, an app may decide to include relay information and other metadata such that other apps can locate and display these entities more easily.</p>
<p>For these events, the contents are a binary-encoded list of <code>TLV</code> (type-length-value), with <code>T</code> and <code>L</code> being 1 byte each (<code>uint8</code>, i.e. a number in the range of 0-255), and <code>V</code> being a sequence of bytes of the size indicated by <code>L</code>.</p>
<p>These are the possible bech32 prefixes with <code>TLV</code>:</p>
<ul>
<li><code>nprofile</code>: a nostr profile</li>
<li><code>nevent</code>: a nostr event</li>
<li><code>nrelay</code>: a nostr relay</li>
<li><code>naddr</code>: a nostr <em>replaceable event</em> coordinate</li>
</ul>
<p>These possible standardized <code>TLV</code> types are indicated here:</p>
<ul>
<li><code>0</code>: <code>special</code>
<ul>
<li>depends on the bech32 prefix:
<ul>
<li>for <code>nprofile</code> it will be the 32 bytes of the profile public key</li>
<li>for <code>nevent</code> it will be the 32 bytes of the event id</li>
<li>for <code>nrelay</code>, this is the relay URL</li>
<li>for <code>naddr</code>, it is the identifier (the <code>&quot;d&quot;</code> tag) of the event being referenced. For non-parameterized replaceable events, use an empty string.</li>
</ul>
</li>
</ul>
</li>
<li><code>1</code>: <code>relay</code>
<ul>
<li>for <code>nprofile</code>, <code>nevent</code> and <code>naddr</code>, <em>optionally</em>, a relay in which the entity (profile or event) is more likely to be found, encoded as ascii</li>
<li>this may be included multiple times</li>
</ul>
</li>
<li><code>2</code>: <code>author</code>
<ul>
<li>for <code>naddr</code>, the 32 bytes of the pubkey of the event</li>
<li>for <code>nevent</code>, <em>optionally</em>, the 32 bytes of the pubkey of the event</li>
</ul>
</li>
<li><code>3</code>: <code>kind</code>
<ul>
<li>for <code>naddr</code>, the 32-bit unsigned integer of the kind, big-endian</li>
<li>for <code>nevent</code>, <em>optionally</em>, the 32-bit unsigned integer of the kind, big-endian</li>
</ul>
</li>
</ul>
<h2>Examples</h2>
<ul>
<li><code>npub10elfcs4fr0l0r8af98jlmgdh9c8tcxjvz9qkw038js35mp4dma8qzvjptg</code> should decode into the public key hex <code>7e7e9c42a91bfef19fa929e5fda1b72e0ebc1a4c1141673e2794234d86addf4e</code> and vice-versa</li>
<li><code>nsec1vl029mgpspedva04g90vltkh6fvh240zqtv9k0t9af8935ke9laqsnlfe5</code> should decode into the private key hex <code>67dea2ed018072d675f5415ecfaed7d2597555e202d85b3d65ea4e58d2d92ffa</code> and vice-versa</li>
<li><code>nprofile1qqsrhuxx8l9ex335q7he0f09aej04zpazpl0ne2cgukyawd24mayt8gpp4mhxue69uhhytnc9e3k7mgpz4mhxue69uhkg6nzv9ejuumpv34kytnrdaksjlyr9p</code> should decode into a profile with the following TLV items:
<ul>
<li>pubkey: <code>3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d</code></li>
<li>relay: <code>wss://r.x.com</code></li>
<li>relay: <code>wss://djbas.sadkb.com</code></li>
</ul>
</li>
</ul>
<h2>Notes</h2>
<ul>
<li><code>npub</code> keys MUST NOT be used in NIP-01 events or in NIP-05 JSON responses, only the hex format is supported there.</li>
<li>When decoding a bech32-formatted string, TLVs that are not recognized or supported should be ignored, rather than causing an error.</li>
</ul>

<h1>20</h1><h1>NIP-20</h1>
<h2>Command Results</h2>
<p><code>final</code> <code>mandatory</code> <code>author:jb55</code></p>
<p>Moved to <a href="01.md">NIP-01</a>.</p>

<h1>21</h1><h1>NIP-21</h1>
<h2><code>nostr:</code> URI scheme</h2>
<p><code>draft</code> <code>optional</code> <code>author:fiatjaf</code></p>
<p>This NIP standardizes the usage of a common URI scheme for maximum interoperability and openness in the network.</p>
<p>The scheme is <code>nostr:</code>.</p>
<p>The identifiers that come after are expected to be the same as those defined in <a href="https://github.com/nostr-protocol/nips/blob/master/19.md">NIP-19</a> (except <code>nsec</code>).</p>
<h2>Examples</h2>
<ul>
<li><code>nostr:npub1sn0wdenkukak0d9dfczzeacvhkrgz92ak56egt7vdgzn8pv2wfqqhrjdv9</code></li>
<li><code>nostr:nprofile1qqsrhuxx8l9ex335q7he0f09aej04zpazpl0ne2cgukyawd24mayt8gpp4mhxue69uhhytnc9e3k7mgpz4mhxue69uhkg6nzv9ejuumpv34kytnrdaksjlyr9p</code></li>
<li><code>nostr:note1fntxtkcy9pjwucqwa9mddn7v03wwwsu9j330jj350nvhpky2tuaspk6nqc</code></li>
<li><code>nostr:nevent1qqstna2yrezu5wghjvswqqculvvwxsrcvu7uc0f78gan4xqhvz49d9spr3mhxue69uhkummnw3ez6un9d3shjtn4de6x2argwghx6egpr4mhxue69uhkummnw3ez6ur4vgh8wetvd3hhyer9wghxuet5nxnepm</code></li>
</ul>

<h1>22</h1><h1>NIP-22</h1>
<h2>Event <code>created_at</code> Limits</h2>
<p><code>draft</code> <code>optional</code> <code>author:jeffthibault</code> <code>author:Giszmo</code></p>
<p>Relays may define both upper and lower limits within which they will consider an event's <code>created_at</code> to be acceptable. Both the upper and lower limits MUST be unix timestamps in seconds as defined in <a href="01.md">NIP-01</a>.</p>
<p>If a relay supports this NIP, the relay SHOULD send the client an <code>OK</code> result saying the event was not stored for the <code>created_at</code> timestamp not being within the permitted limits.</p>
<h2>Client Behavior</h2>
<p>Clients SHOULD use the <a href="11.md">NIP-11</a> <code>supported_nips</code> field to learn if a relay uses event <code>created_at</code> time limits as defined by this NIP.</p>
<h2>Motivation</h2>
<p>This NIP formalizes restrictions on event timestamps as accepted by a relay and allows clients to be aware of relays that have these restrictions.</p>
<p>The event <code>created_at</code> field is just a unix timestamp and can be set to a time in the past or future. Relays accept and share events dated to 20 years ago or 50,000 years in the future. This NIP aims to define a way for relays that do not want to store events with <em>any</em> timestamp to set their own restrictions.</p>
<p><em>Replaceable events</em> can behave rather unexpectedly if the user wrote them - or tried to write them - with a wrong system clock. Persisting an update with a backdated system now would result in the update not getting persisted without a notification and if they did the last update with a forward dated system, they will again fail to do another update with the now correct time.</p>
<p>A wide adoption of this NIP could create a better user experience as it would decrease the amount of events that appear wildly out of order or even from impossible dates in the distant past or future.</p>
<p>Keep in mind that there is a use case where a user migrates their old posts onto a new relay. If a relay rejects events that were not recently created, it cannot serve this use case.</p>
<h2>Python (pseudocode) Example</h2>
<pre><code class="language-python">import time

TIME = int(time.time())
LOWER_LIMIT = TIME - (60 * 60 * 24) # Define lower limit as 1 day into the past
UPPER_LIMIT = TIME + (60 * 15)      # Define upper limit as 15 minutes into the future

if event.created_at not in range(LOWER_LIMIT, UPPER_LIMIT):
  ws.send('[&quot;OK&quot;, event.id, False, &quot;invalid: the event created_at field is out of the acceptable range (-24h, +15min) for this relay&quot;]')
</code></pre>
<p>Note: These are just example limits, the relay operator can choose whatever limits they want.</p>

<h1>23</h1><h1>NIP-23</h1>
<h2>Long-form Content</h2>
<p><code>draft</code> <code>optional</code> <code>author:fiatjaf</code></p>
<p>This NIP defines <code>kind:30023</code> (a <em>parameterized replaceable event</em>) for long-form text content, generally referred to as &quot;articles&quot; or &quot;blog posts&quot;. <code>kind:30024</code> has the same structure as <code>kind:30023</code> and is used to save long form drafts.</p>
<p>&quot;Social&quot; clients that deal primarily with <code>kind:1</code> notes should not be expected to implement this NIP.</p>
<h3>Format</h3>
<p>The <code>.content</code> of these events should be a string text in Markdown syntax. To maximize compatibility and readability between different clients and devices, any client that is creating long form notes:</p>
<ul>
<li>
<p>MUST NOT hard line-break paragraphs of text, such as arbitrary line breaks at 80 column boundaries.</p>
</li>
<li>
<p>MUST NOT support adding HTML to Markdown.</p>
</li>
</ul>
<h3>Metadata</h3>
<p>For the date of the last update the <code>.created_at</code> field should be used, for &quot;tags&quot;/&quot;hashtags&quot; (i.e. topics about which the event might be of relevance) the <code>t</code> tag should be used, as per NIP-12.</p>
<p>Other metadata fields can be added as tags to the event as necessary. Here we standardize 4 that may be useful, although they remain strictly optional:</p>
<ul>
<li><code>&quot;title&quot;</code>, for the article title</li>
<li><code>&quot;image&quot;</code>, for a URL pointing to an image to be shown along with the title</li>
<li><code>&quot;summary&quot;</code>, for the article summary</li>
<li><code>&quot;published_at&quot;</code>, for the timestamp in unix seconds (stringified) of the first time the article was published</li>
</ul>
<h3>Editability</h3>
<p>These articles are meant to be editable, so they should make use of the parameterized replaceability feature and include a <code>d</code> tag with an identifier for the article. Clients should take care to only publish and read these events from relays that implement that. If they don't do that they should also take care to hide old versions of the same article they may receive.</p>
<h3>Linking</h3>
<p>The article may be linked to using the <a href="19.md">NIP-19</a> <code>naddr</code> code along with the <code>a</code> tag.</p>
<h3>References</h3>
<p>References to other Nostr notes, articles or profiles must be made according to <a href="27.md">NIP-27</a>, i.e. by using <a href="21.md">NIP-21</a> <code>nostr:...</code> links and optionally adding tags for these (see example below).</p>
<h2>Example Event</h2>
<pre><code class="language-json">{
  &quot;kind&quot;: 30023,
  &quot;created_at&quot;: 1675642635,
  &quot;content&quot;: &quot;Lorem [ipsum][nostr:nevent1qqst8cujky046negxgwwm5ynqwn53t8aqjr6afd8g59nfqwxpdhylpcpzamhxue69uhhyetvv9ujuetcv9khqmr99e3k7mg8arnc9] dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n\nRead more at nostr:naddr1qqzkjurnw4ksz9thwden5te0wfjkccte9ehx7um5wghx7un8qgs2d90kkcq3nk2jry62dyf50k0h36rhpdtd594my40w9pkal876jxgrqsqqqa28pccpzu.&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;lorem-ipsum&quot;],
    [&quot;title&quot;, &quot;Lorem Ipsum&quot;],
    [&quot;published_at&quot;, &quot;1296962229&quot;],
    [&quot;t&quot;, &quot;placeholder&quot;],
    [&quot;e&quot;, &quot;b3e392b11f5d4f28321cedd09303a748acfd0487aea5a7450b3481c60b6e4f87&quot;, &quot;wss://relay.example.com&quot;],
    [&quot;a&quot;, &quot;30023:a695f6b60119d9521934a691347d9f78e8770b56da16bb255ee286ddf9fda919:ipsum&quot;, &quot;wss://relay.nostr.org&quot;]
  ],
  &quot;pubkey&quot;: &quot;...&quot;,
  &quot;id&quot;: &quot;...&quot;
}
</code></pre>

<h1>24</h1><h1>NIP-24</h1>
<h2>Extra metadata fields and tags</h2>
<p><code>draft</code> <code>optional</code> <code>author:fiatjaf</code></p>
<p>This NIP defines extra optional fields added to events.</p>
<h1>kind 0</h1>
<p>These are extra fields not specified in NIP-01 that may be present in the stringified JSON of metadata events:</p>
<ul>
<li><code>display_name</code>: a bigger name with richer characters than <code>name</code>. Implementations should fallback to <code>name</code> when this is not available.</li>
<li><code>website</code>: a web URL related in any way to the event author.</li>
<li><code>banner</code>: an URL to a wide (~1024x768) picture to be optionally displayed in the background of a profile screen.</li>
</ul>
<h3>Deprecated fields</h3>
<p>These are fields that should be ignored or removed when found in the wild:</p>
<ul>
<li><code>displayName</code>: use <code>display_name</code> instead.</li>
<li><code>username</code>: use <code>name</code> instead.</li>
</ul>
<h1>kind 3</h1>
<p>These are extra fields not specified in NIP-02 that may be present in the stringified JSON of contacts events:</p>
<h3>Deprecated fields</h3>
<ul>
<li><code>{&lt;relay-url&gt;: {&quot;read&quot;: &lt;true|false&gt;, &quot;write&quot;: &lt;true|false&gt;}, ...}</code>: an object of relays used by a user to read/write. <a href="65.md">NIP-65</a> should be used instead.</li>
</ul>
<h1>tags</h1>
<p>These tags may be present in multiple event kinds. Whenever a different meaning is not specified by some more specific NIP, they have the following meanings:</p>
<ul>
<li><code>r</code>: a web URL the event is referring to in some way</li>
</ul>

<h1>25</h1><h1>NIP-25</h1>
<h2>Reactions</h2>
<p><code>draft</code> <code>optional</code> <code>author:jb55</code></p>
<p>A reaction is a <code>kind 7</code> event that is used to react to other events.</p>
<p>The generic reaction, represented by the <code>content</code> set to a <code>+</code> string, SHOULD
be interpreted as a &quot;like&quot; or &quot;upvote&quot;.</p>
<p>A reaction with <code>content</code> set to <code>-</code> SHOULD be interpreted as a &quot;dislike&quot; or
&quot;downvote&quot;. It SHOULD NOT be counted as a &quot;like&quot;, and MAY be displayed as a
downvote or dislike on a post. A client MAY also choose to tally likes against
dislikes in a reddit-like system of upvotes and downvotes, or display them as
separate tallies.</p>
<p>The <code>content</code> MAY be an emoji, or <a href="30.md">NIP-30</a> custom emoji in this case it MAY be interpreted as a &quot;like&quot; or &quot;dislike&quot;,
or the client MAY display this emoji reaction on the post. If the <code>content</code> is an empty string then the client should
consider it a &quot;+&quot;.</p>
<h2>Tags</h2>
<p>The reaction event SHOULD include <code>e</code> and <code>p</code> tags from the note the user is
reacting to. This allows users to be notified of reactions to posts they were
mentioned in. Including the <code>e</code> tags enables clients to pull all the reactions
associated with individual posts or all the posts in a thread.</p>
<p>The last <code>e</code> tag MUST be the <code>id</code> of the note that is being reacted to.</p>
<p>The last <code>p</code> tag MUST be the <code>pubkey</code> of the event being reacted to.</p>
<p>The reaction event MAY include a <code>k</code> tag with the stringified kind number
of the reacted event as its value.</p>
<p>Example code</p>
<pre><code class="language-swift">func make_like_event(pubkey: String, privkey: String, liked: NostrEvent) -&gt; NostrEvent {
    var tags: [[String]] = liked.tags.filter { 
    	tag in tag.count &gt;= 2 &amp;&amp; (tag[0] == &quot;e&quot; || tag[0] == &quot;p&quot;) 
    }
    tags.append([&quot;e&quot;, liked.id])
    tags.append([&quot;p&quot;, liked.pubkey])
    tags.append([&quot;k&quot;, liked.kind])
    let ev = NostrEvent(content: &quot;+&quot;, pubkey: pubkey, kind: 7, tags: tags)
    ev.calculate_id()
    ev.sign(privkey: privkey)
    return ev
}
</code></pre>
<h2>Custom Emoji Reaction</h2>
<p>The client may specify a custom emoji (<a href="30.md">NIP-30</a>) <code>:shortcode:</code> in the
reaction content. The client should refer to the emoji tag and render the
content as an emoji if shortcode is specified.</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 7,
  &quot;content&quot;: &quot;:soapbox:&quot;,
  &quot;tags&quot;: [
    [&quot;emoji&quot;, &quot;soapbox&quot;, &quot;https://gleasonator.com/emoji/Gleasonator/soapbox.png&quot;]
  ],
  &quot;pubkey&quot;: &quot;79c2cae114ea28a981e7559b4fe7854a473521a8d22a66bbab9fa248eb820ff6&quot;,
  &quot;created_at&quot;: 1682790000
}
</code></pre>
<p>The content can be set only one <code>:shortcode:</code>. And emoji tag should be one.</p>

<h1>26</h1><h1>NIP-26</h1>
<h2>Delegated Event Signing</h2>
<p><code>draft</code> <code>optional</code> <code>author:markharding</code> <code>author:minds</code></p>
<p>This NIP defines how events can be delegated so that they can be signed by other keypairs.</p>
<p>Another application of this proposal is to abstract away the use of the 'root' keypairs when interacting with clients. For example, a user could generate new keypairs for each client they wish to use and authorize those keypairs to generate events on behalf of their root pubkey, where the root keypair is stored in cold storage.</p>
<h4>Introducing the 'delegation' tag</h4>
<p>This NIP introduces a new tag: <code>delegation</code> which is formatted as follows:</p>
<pre><code class="language-json">[
  &quot;delegation&quot;,
  &lt;pubkey of the delegator&gt;,
  &lt;conditions query string&gt;,
  &lt;delegation token: 64-byte Schnorr signature of the sha256 hash of the delegation string&gt;
]
</code></pre>
<h5>Delegation Token</h5>
<p>The <strong>delegation token</strong> should be a 64-byte Schnorr signature of the sha256 hash of the following string:</p>
<pre><code>nostr:delegation:&lt;pubkey of publisher (delegatee)&gt;:&lt;conditions query string&gt;
</code></pre>
<h5>Conditions Query String</h5>
<p>The following fields and operators are supported in the above query string:</p>
<p><em>Fields</em>:</p>
<ol>
<li><code>kind</code>
<ul>
<li><em>Operators</em>:
<ul>
<li><code>=${KIND_NUMBER}</code> - delegatee may only sign events of this kind</li>
</ul>
</li>
</ul>
</li>
<li><code>created_at</code>
<ul>
<li><em>Operators</em>:
<ul>
<li><code>&lt;${TIMESTAMP}</code> - delegatee may only sign events created <em><strong>before</strong></em> the specified timestamp</li>
<li><code>&gt;${TIMESTAMP}</code> - delegatee may only sign events created <em><strong>after</strong></em> the specified timestamp</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>In order to create a single condition, you must use a supported field and operator. Multiple conditions can be used in a single query string, including on the same field. Conditions must be combined with <code>&amp;</code>.</p>
<p>For example, the following condition strings are valid:</p>
<ul>
<li><code>kind=1&amp;created_at&lt;1675721813</code></li>
<li><code>kind=0&amp;kind=1&amp;created_at&gt;1675721813</code></li>
<li><code>kind=1&amp;created_at&gt;1674777689&amp;created_at&lt;1675721813</code></li>
</ul>
<p>For the vast majority of use-cases, it is advisable that:</p>
<ol>
<li>Query strings should include a <code>created_at</code> <em><strong>after</strong></em> condition reflecting the current time, to prevent the delegatee from publishing historic notes on the delegator's behalf.</li>
<li>Query strings should include a <code>created_at</code> <em><strong>before</strong></em> condition that is not empty and is not some extremely distant time in the future. If delegations are not limited in time scope, they expose similar security risks to simply using the root key for authentication.</li>
</ol>
<h4>Example</h4>
<pre><code># Delegator:
privkey: ee35e8bb71131c02c1d7e73231daa48e9953d329a4b701f7133c8f46dd21139c
pubkey:  8e0d3d3eb2881ec137a11debe736a9086715a8c8beeeda615780064d68bc25dd

# Delegatee:
privkey: 777e4f60b4aa87937e13acc84f7abcc3c93cc035cb4c1e9f7a9086dd78fffce1
pubkey:  477318cfb5427b9cfc66a9fa376150c1ddbc62115ae27cef72417eb959691396
</code></pre>
<p>Delegation string to grant note publishing authorization to the delegatee (477318cf) from now, for the next 30 days, given the current timestamp is <code>1674834236</code>.</p>
<pre><code class="language-json">nostr:delegation:477318cfb5427b9cfc66a9fa376150c1ddbc62115ae27cef72417eb959691396:kind=1&amp;created_at&gt;1674834236&amp;created_at&lt;1677426236
</code></pre>
<p>The delegator (8e0d3d3e) then signs a SHA256 hash of the above delegation string, the result of which is the delegation token:</p>
<pre><code>6f44d7fe4f1c09f3954640fb58bd12bae8bb8ff4120853c4693106c82e920e2b898f1f9ba9bd65449a987c39c0423426ab7b53910c0c6abfb41b30bc16e5f524
</code></pre>
<p>The delegatee (477318cf) can now construct an event on behalf of the delegator (8e0d3d3e). The delegatee then signs the event with its own private key and publishes.</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;e93c6095c3db1c31d15ac771f8fc5fb672f6e52cd25505099f62cd055523224f&quot;,
  &quot;pubkey&quot;: &quot;477318cfb5427b9cfc66a9fa376150c1ddbc62115ae27cef72417eb959691396&quot;,
  &quot;created_at&quot;: 1677426298,
  &quot;kind&quot;: 1,
  &quot;tags&quot;: [
    [
      &quot;delegation&quot;,
      &quot;8e0d3d3eb2881ec137a11debe736a9086715a8c8beeeda615780064d68bc25dd&quot;,
      &quot;kind=1&amp;created_at&gt;1674834236&amp;created_at&lt;1677426236&quot;,
      &quot;6f44d7fe4f1c09f3954640fb58bd12bae8bb8ff4120853c4693106c82e920e2b898f1f9ba9bd65449a987c39c0423426ab7b53910c0c6abfb41b30bc16e5f524&quot;
    ]
  ],
  &quot;content&quot;: &quot;Hello, world!&quot;,
  &quot;sig&quot;: &quot;633db60e2e7082c13a47a6b19d663d45b2a2ebdeaf0b4c35ef83be2738030c54fc7fd56d139652937cdca875ee61b51904a1d0d0588a6acd6168d7be2909d693&quot;
}
</code></pre>
<p>The event should be considered a valid delegation if the conditions are satisfied (<code>kind=1</code>, <code>created_at&gt;1674834236</code> and <code>created_at&lt;1677426236</code> in this example) and, upon validation of the delegation token, are found to be unchanged from the conditions in the original delegation string.</p>
<p>Clients should display the delegated note as if it was published directly by the delegator (8e0d3d3e).</p>
<h4>Relay &amp; Client Support</h4>
<p>Relays should answer requests such as <code>[&quot;REQ&quot;, &quot;&quot;, {&quot;authors&quot;: [&quot;A&quot;]}]</code> by querying both the <code>pubkey</code> and delegation tags <code>[1]</code> value.</p>
<p>Relays SHOULD allow the delegator (8e0d3d3e) to delete the events published by the delegatee (477318cf).</p>

<h1>27</h1><h1>NIP-27</h1>
<h2>Text Note References</h2>
<p><code>draft</code> <code>optional</code> <code>author:arthurfranca</code> <code>author:hodlbod</code> <code>author:fiatjaf</code></p>
<p>This document standardizes the treatment given by clients of inline references of other events and profiles inside the <code>.content</code> of any event that has readable text in its <code>.content</code> (such as kinds 1 and 30023).</p>
<p>When creating an event, clients should include mentions to other profiles and to other events in the middle of the <code>.content</code> using <a href="21.md">NIP-21</a> codes, such as <code>nostr:nprofile1qqsw3dy8cpu...6x2argwghx6egsqstvg</code>.</p>
<p>Including <a href="10.md">NIP-10</a>-style tags (<code>[&quot;e&quot;, &lt;hex-id&gt;, &lt;relay-url&gt;, &lt;marker&gt;]</code>) for each reference is optional, clients should do it whenever they want the profile being mentioned to be notified of the mention, or when they want the referenced event to recognize their mention as a reply.</p>
<p>A reader client that receives an event with such <code>nostr:...</code> mentions in its <code>.content</code> can do any desired context augmentation (for example, linking to the profile or showing a preview of the mentioned event contents) it wants in the process. If turning such mentions into links, they could become internal links, <a href="21.md">NIP-21</a> links or direct links to web clients that will handle these references.</p>
<hr>
<h2>Example of a profile mention process</h2>
<p>Suppose Bob is writing a note in a client that has search-and-autocomplete functionality for users that is triggered when they write the character <code>@</code>.</p>
<p>As Bob types <code>&quot;hello @mat&quot;</code> the client will prompt him to autocomplete with <a href="https://gateway.nostr.com/p/2c7cc62a697ea3a7826521f3fd34f0cb273693cbe5e9310f35449f43622a5cdc">mattn's profile</a>, showing a picture and name.</p>
<p>Bob presses &quot;enter&quot; and now he sees his typed note as <code>&quot;hello @mattn&quot;</code>, <code>@mattn</code> is highlighted, indicating that it is a mention. Internally, however, the event looks like this:</p>
<pre><code class="language-json">{
  &quot;content&quot;: &quot;hello nostr:nprofile1qqszclxx9f5haga8sfjjrulaxncvkfekj097t6f3pu65f86rvg49ehqj6f9dh&quot;,
  &quot;created_at&quot;: 1679790774,
  &quot;id&quot;: &quot;f39e9b451a73d62abc5016cffdd294b1a904e2f34536a208874fe5e22bbd47cf&quot;,
  &quot;kind&quot;: 1,
  &quot;pubkey&quot;: &quot;79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798&quot;,
  &quot;sig&quot;: &quot;f8c8bab1b90cc3d2ae1ad999e6af8af449ad8bb4edf64807386493163e29162b5852a796a8f474d6b1001cddbaac0de4392838574f5366f03cc94cf5dfb43f4d&quot;,
  &quot;tags&quot;: [
    [
      &quot;p&quot;,
      &quot;2c7cc62a697ea3a7826521f3fd34f0cb273693cbe5e9310f35449f43622a5cdc&quot;
    ]
  ]
}
</code></pre>
<p>(Alternatively, the mention could have been a <code>nostr:npub1...</code> URL.)</p>
<p>After Bob publishes this event and Carol sees it, her client will initially display the <code>.content</code> as it is, but later it will parse the <code>.content</code> and see that there is a <code>nostr:</code> URL in there, decode it, extract the public key from it (and possibly relay hints), fetch that profile from its internal database or relays, then replace the full URL with the name <code>@mattn</code>, with a link to the internal page view for that profile.</p>
<h2>Verbose and probably unnecessary considerations</h2>
<ul>
<li>The example above was very concrete, but it doesn't mean all clients have to implement the same flow. There could be clients that do not support autocomplete at all, so they just allow users to paste raw <a href="19.md">NIP-19</a> codes into the body of text, then prefix these with <code>nostr:</code> before publishing the event.</li>
<li>The flow for referencing other events is similar: a user could paste a <code>note1...</code> or <code>nevent1...</code> code and the client will turn that into a <code>nostr:note1...</code> or <code>nostr:nevent1...</code> URL. Then upon reading such references the client may show the referenced note in a preview box or something like that -- or nothing at all.</li>
<li>Other display procedures can be employed: for example, if a client that is designed for dealing with only <code>kind:1</code> text notes sees, for example, a <a href="23.md"><code>kind:30023</code></a> <code>nostr:naddr1...</code> URL reference in the <code>.content</code>, it can, for example, decide to turn that into a link to some hardcoded webapp capable of displaying such events.</li>
<li>Clients may give the user the option to include or not include tags for mentioned events or profiles. If someone wants to mention <code>mattn</code> without notifying them, but still have a nice augmentable/clickable link to their profile inside their note, they can instruct their client to <em>not</em> create a <code>[&quot;p&quot;, ...]</code> tag for that specific mention.</li>
<li>In the same way, if someone wants to reference another note but their reference is not meant to show up along other replies to that same note, their client can choose to not include a corresponding <code>[&quot;e&quot;, ...]</code> tag for any given <code>nostr:nevent1...</code> URL inside <code>.content</code>. Clients may decide to expose these advanced functionalities to users or be more opinionated about things.</li>
</ul>

<h1>28</h1><h1>NIP-28</h1>
<h2>Public Chat</h2>
<p><code>draft</code> <code>optional</code> <code>author:ChristopherDavid</code> <code>author:fiatjaf</code> <code>author:jb55</code> <code>author:Cameri</code></p>
<p>This NIP defines new event kinds for public chat channels, channel messages, and basic client-side moderation.</p>
<p>It reserves five event kinds (40-44) for immediate use:</p>
<ul>
<li><code>40 - channel create</code></li>
<li><code>41 - channel metadata</code></li>
<li><code>42 - channel message</code></li>
<li><code>43 - hide message</code></li>
<li><code>44 - mute user</code></li>
</ul>
<p>Client-centric moderation gives client developers discretion over what types of content they want included in their apps, while imposing no additional requirements on relays.</p>
<h2>Kind 40: Create channel</h2>
<p>Create a public chat channel.</p>
<p>In the channel creation <code>content</code> field, Client SHOULD include basic channel metadata (<code>name</code>, <code>about</code>, <code>picture</code> as specified in kind 41).</p>
<pre><code class="language-json">{
    &quot;content&quot;: &quot;{\&quot;name\&quot;: \&quot;Demo Channel\&quot;, \&quot;about\&quot;: \&quot;A test channel.\&quot;, \&quot;picture\&quot;: \&quot;https://placekitten.com/200/200\&quot;}&quot;,
    ...
}
</code></pre>
<h2>Kind 41: Set channel metadata</h2>
<p>Update a channel's public metadata.</p>
<p>Clients and relays SHOULD handle kind 41 events similar to kind 33 replaceable events, where the information is used to update the metadata, without modifying the event id for the channel.  Only the most recent kind 41 is needed to be stored.</p>
<p>Clients SHOULD ignore kind 41s from pubkeys other than the kind 40 pubkey.</p>
<p>Clients SHOULD support basic metadata fields:</p>
<ul>
<li><code>name</code> - string - Channel name</li>
<li><code>about</code> - string - Channel description</li>
<li><code>picture</code> - string - URL of channel picture</li>
</ul>
<p>Clients MAY add additional metadata fields.</p>
<p>Clients SHOULD use <a href="10.md">NIP-10</a> marked &quot;e&quot; tags to recommend a relay.</p>
<pre><code class="language-json">{
    &quot;content&quot;: &quot;{\&quot;name\&quot;: \&quot;Updated Demo Channel\&quot;, \&quot;about\&quot;: \&quot;Updating a test channel.\&quot;, \&quot;picture\&quot;: \&quot;https://placekitten.com/201/201\&quot;}&quot;,
    &quot;tags&quot;: [[&quot;e&quot;, &lt;channel_create_event_id&gt;, &lt;relay-url&gt;]],
    ...
}
</code></pre>
<h2>Kind 42: Create channel message</h2>
<p>Send a text message to a channel.</p>
<p>Clients SHOULD use <a href="10.md">NIP-10</a> marked &quot;e&quot; tags to recommend a relay and specify whether it is a reply or root message.</p>
<p>Clients SHOULD append <a href="10.md">NIP-10</a> &quot;p&quot; tags to replies.</p>
<p>Root message:</p>
<pre><code class="language-json">{
    &quot;content&quot;: &lt;string&gt;,
    &quot;tags&quot;: [[&quot;e&quot;, &lt;kind_40_event_id&gt;, &lt;relay-url&gt;, &quot;root&quot;]],
    ...
}
</code></pre>
<p>Reply to another message:</p>
<pre><code class="language-json">{
    &quot;content&quot;: &lt;string&gt;,
    &quot;tags&quot;: [
        [&quot;e&quot;, &lt;kind_40_event_id&gt;, &lt;relay-url&gt;, &quot;root&quot;],
        [&quot;e&quot;, &lt;kind_42_event_id&gt;, &lt;relay-url&gt;, &quot;reply&quot;],
        [&quot;p&quot;, &lt;pubkey&gt;, &lt;relay-url&gt;],
        ...
    ],
    ...
}
</code></pre>
<h2>Kind 43: Hide message</h2>
<p>User no longer wants to see a certain message.</p>
<p>The <code>content</code> may optionally include metadata such as a <code>reason</code>.</p>
<p>Clients SHOULD hide event 42s shown to a given user, if there is an event 43 from that user matching the event 42 <code>id</code>.</p>
<p>Clients MAY hide event 42s for other users other than the user who sent the event 43.</p>
<p>(For example, if three users 'hide' an event giving a reason that includes the word 'pornography', a Nostr client that is an iOS app may choose to hide that message for all iOS clients.)</p>
<pre><code class="language-json">{
    &quot;content&quot;: &quot;{\&quot;reason\&quot;: \&quot;Dick pic\&quot;}&quot;,
    &quot;tags&quot;: [[&quot;e&quot;, &lt;kind_42_event_id&gt;]],
    ...
}
</code></pre>
<h2>Kind 44: Mute user</h2>
<p>User no longer wants to see messages from another user.</p>
<p>The <code>content</code> may optionally include metadata such as a <code>reason</code>.</p>
<p>Clients SHOULD hide event 42s shown to a given user, if there is an event 44 from that user matching the event 42 <code>pubkey</code>.</p>
<p>Clients MAY hide event 42s for users other than the user who sent the event 44.</p>
<pre><code class="language-json">{
    &quot;content&quot;: &quot;{\&quot;reason\&quot;: \&quot;Posting dick pics\&quot;}&quot;,
    &quot;tags&quot;: [[&quot;p&quot;, &lt;pubkey&gt;]],
    ...
}
</code></pre>
<h2>NIP-10 relay recommendations</h2>
<p>For <a href="10.md">NIP-10</a> relay recommendations, clients generally SHOULD use the relay URL of the original (oldest) kind 40 event.</p>
<p>Clients MAY recommend any relay URL. For example, if a relay hosting the original kind 40 event for a channel goes offline, clients could instead fetch channel data from a backup relay, or a relay that clients trust more than the original relay.</p>
<h2>Motivation</h2>
<p>If we're solving censorship-resistant communication for social media, we may as well solve it also for Telegram-style messaging.</p>
<p>We can bring the global conversation out from walled gardens into a true public square open to all.</p>
<h2>Additional info</h2>
<ul>
<li><a href="https://github.com/ArcadeCity/arcade/pull/28">Chat demo PR with fiatjaf+jb55 comments</a></li>
<li><a href="https://t.me/nostr_protocol/29566">Conversation about NIP16</a></li>
</ul>

<h1>30</h1><h1>NIP-30</h1>
<h2>Custom Emoji</h2>
<p><code>draft</code> <code>optional</code> <code>author:alexgleason</code></p>
<p>Custom emoji may be added to <strong>kind 0</strong> and <strong>kind 1</strong> events by including one or more <code>&quot;emoji&quot;</code> tags, in the form:</p>
<pre><code>[&quot;emoji&quot;, &lt;shortcode&gt;, &lt;image-url&gt;]
</code></pre>
<p>Where:</p>
<ul>
<li><code>&lt;shortcode&gt;</code> is a name given for the emoji, which MUST be comprised of only alphanumeric characters and underscores.</li>
<li><code>&lt;image-url&gt;</code> is a URL to the corresponding image file of the emoji.</li>
</ul>
<p>For each emoji tag, clients should parse emoji shortcodes (aka &quot;emojify&quot;) like <code>:shortcode:</code> in the event to display custom emoji.</p>
<p>Clients may allow users to add custom emoji to an event by including <code>:shortcode:</code> identifier in the event, and adding the relevant <code>&quot;emoji&quot;</code> tags.</p>
<h3>Kind 0 events</h3>
<p>In kind 0 events, the <code>name</code> and <code>about</code> fields should be emojified.</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 0,
  &quot;content&quot;: &quot;{\&quot;name\&quot;:\&quot;Alex Gleason :soapbox:\&quot;}&quot;,
  &quot;tags&quot;: [
    [&quot;emoji&quot;, &quot;soapbox&quot;, &quot;https://gleasonator.com/emoji/Gleasonator/soapbox.png&quot;]
  ],
  &quot;pubkey&quot;: &quot;79c2cae114ea28a981e7559b4fe7854a473521a8d22a66bbab9fa248eb820ff6&quot;,
  &quot;created_at&quot;: 1682790000
}
</code></pre>
<h3>Kind 1 events</h3>
<p>In kind 1 events, the <code>content</code> should be emojified.</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 1,
  &quot;content&quot;: &quot;Hello :gleasonator: 😂 :ablobcatrainbow: :disputed: yolo&quot;,
    &quot;tags&quot;: [
    [&quot;emoji&quot;, &quot;ablobcatrainbow&quot;, &quot;https://gleasonator.com/emoji/blobcat/ablobcatrainbow.png&quot;],
    [&quot;emoji&quot;, &quot;disputed&quot;, &quot;https://gleasonator.com/emoji/Fun/disputed.png&quot;],
    [&quot;emoji&quot;, &quot;gleasonator&quot;, &quot;https://gleasonator.com/emoji/Gleasonator/gleasonator.png&quot;]
  ],
  &quot;pubkey&quot;: &quot;79c2cae114ea28a981e7559b4fe7854a473521a8d22a66bbab9fa248eb820ff6&quot;,
  &quot;created_at&quot;: 1682630000
}
</code></pre>

<h1>31</h1><h1>NIP-31</h1>
<h2>Dealing with unknown event kinds</h2>
<p><code>draft</code> <code>optional</code> <code>author:pablof7z</code> <code>author:fiatjaf</code></p>
<p>When creating a new custom event kind that is part of a custom protocol and isn't meant to be read as text (like <code>kind:1</code>), clients should use an <code>alt</code> tag to write a short human-readable plaintext summary of what that event is about.</p>
<p>The intent is that social clients, used to display only <code>kind:1</code> notes, can still show something in case a custom event pops up in their timelines. The content of the <code>alt</code> tag should provide enough context for a user that doesn't know anything about this event kind to understand what it is.</p>
<p>These clients that only know <code>kind:1</code> are not expected to ask relays for events of different kinds, but users could still reference these weird events on their notes, and without proper context these could be nonsensical notes. Having the fallback text makes that situation much better -- even if only for making the user aware that they should try to view that custom event elsewhere.</p>
<p><code>kind:1</code>-centric clients can make interacting with these event kinds more functional by supporting <a href="https://github.com/nostr-protocol/nips/blob/master/89.md">NIP-89</a>.</p>

<h1>32</h1><h1>NIP-32</h1>
<h2>Labeling</h2>
<p><code>draft</code> <code>optional</code> <code>author:staab</code> <code>author:gruruya</code> <code>author:s3x-jay</code></p>
<p>A label is a <code>kind 1985</code> event that is used to label other entities. This supports a number of use cases, from distributed moderation and content recommendations to reviews and ratings.</p>
<h2>Label Target</h2>
<p>The label event MUST include one or more tags representing the object or objects being
labeled: <code>e</code>, <code>p</code>, <code>a</code>, <code>r</code>, or <code>t</code> tags. This allows for labeling of events, people, relays,
or topics respectively. As with NIP-01, a relay hint SHOULD be included when using <code>e</code> and
<code>p</code> tags.</p>
<h2>Label Tag</h2>
<p>This NIP introduces a new tag <code>l</code> which denotes a label, and a new <code>L</code> tag which denotes a label namespace.
A label MUST include a mark matching an <code>L</code> tag. <code>L</code> tags refer to a tag type within nostr, or a nomenclature
external to nostr defined either formally or by convention. Any string can be a namespace, but publishers SHOULD
ensure they are unambiguous by using a well-defined namespace (such as an ISO standard) or reverse domain name notation.</p>
<p>Namespaces starting with <code>#</code> indicate that the label target should be associated with the label's value.
This is a way of attaching standard nostr tags to events, pubkeys, relays, urls, etc.</p>
<p>Some examples:</p>
<ul>
<li><code>[&quot;l&quot;, &quot;footstr&quot;, &quot;#t&quot;]</code> - the publisher thinks the given entity should have the <code>footstr</code> topic applied.</li>
<li><code>[&quot;l&quot;, &quot;&lt;pubkey&gt;&quot;, &quot;#p&quot;]</code> - the publisher thinks the given entity is related to <code>&lt;pubkey&gt;</code></li>
<li><code>[&quot;l&quot;, &quot;IT-MI&quot;, &quot;ISO-3166-2&quot;]</code> - Milano, Italy using ISO 3166-2.</li>
<li><code>[&quot;l&quot;, &quot;VI-hum&quot;, &quot;com.example.ontology&quot;]</code> - Violence toward a human being as defined by ontology.example.com.</li>
</ul>
<p><code>L</code> tags containing the label namespaces MUST be included in order to support searching by
namespace rather than by a specific tag. The special <code>ugc</code> (&quot;user generated content&quot;) namespace
MAY be used when the label content is provided by an end user.</p>
<p><code>l</code> and <code>L</code> tags MAY be added to other event kinds to support self-reporting. For events
with a kind other than 1985, labels refer to the event itself.</p>
<h2>Label Annotations</h2>
<p>A label tag MAY include a 4th positional element detailing extra metadata about the label in question. This string
should be a json-encoded object. Any key MAY be used, but the following are recommended:</p>
<ul>
<li><code>quality</code> may have a value of 0 to 1. This allows for an absolute, granular scale that can be represented in any way (5 stars, color scale, etc).</li>
<li><code>confidence</code> may have a value of 0 to 1. This indicates the certainty which the author has about their rating.</li>
<li><code>context</code> may be an array of urls (including NIP-21 urls) indicating other context that should be considered when interpreting labels.</li>
</ul>
<h2>Content</h2>
<p>Labels should be short, meaningful strings. Longer discussions, such as for a review, or an
explanation of why something was labeled the way it was, should go in the event's <code>content</code> field.</p>
<h2>Example events</h2>
<p>A suggestion that multiple pubkeys be associated with the <code>permies</code> topic.</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 1985,
  &quot;tags&quot;: [
    [&quot;L&quot;, &quot;#t&quot;],
    [&quot;l&quot;, &quot;permies&quot;, &quot;#t&quot;],
    [&quot;p&quot;, &lt;pubkey1&gt;, &lt;relay_url&gt;],
    [&quot;p&quot;, &lt;pubkey2&gt;, &lt;relay_url&gt;]
  ],
  &quot;content&quot;: &quot;&quot;,
  ...
}
</code></pre>
<p>A review of a relay.</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 1985,
  &quot;tags&quot;: [
    [&quot;L&quot;, &quot;com.example.ontology&quot;],
    [&quot;l&quot;, &quot;relay/review&quot;, &quot;com.example.ontology&quot;, &quot;{\&quot;quality\&quot;: 0.1}&quot;],
    [&quot;r&quot;, &lt;relay_url&gt;]
  ],
  &quot;content&quot;: &quot;This relay is full of mean people.&quot;,
  ...
}
</code></pre>
<p>Publishers can self-label by adding <code>l</code> tags to their own non-1985 events.</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 1,
  &quot;tags&quot;: [
    [&quot;L&quot;, &quot;com.example.ontology&quot;],
    [&quot;l&quot;, &quot;IL-frd&quot;, &quot;com.example.ontology&quot;]
  ],
  &quot;content&quot;: &quot;Send me 100 sats and I'll send you 200 back&quot;,
  ...
}
</code></pre>
<h2>Other Notes</h2>
<p>When using this NIP to bulk-label many targets at once, events may be deleted and a replacement
may be published. We have opted not to use parameterizable/replaceable events for this due to the
complexity in coming up with a standard <code>d</code> tag. In order to avoid ambiguity when querying,
publishers SHOULD limit labeling events to a single namespace.</p>
<p>Before creating a vocabulary, explore how your use case may have already been designed and
imitate that design if possible. Reverse domain name notation is encouraged to avoid
namespace clashes, but for the sake of interoperability all namespaces should be
considered open for public use, and not proprietary. In other words, if there is a
namespace that fits your use case, use it even if it points to someone else's domain name.</p>
<p>Vocabularies MAY choose to fully qualify all labels within a namespace (for example,
<code>[&quot;l&quot;, &quot;com.example.vocabulary:my-label&quot;]</code>. This may be preferred when defining more
formal vocabularies that should not be confused with another namespace when querying
without an <code>L</code> tag. For these vocabularies, all labels SHOULD include the namespace
(rather than mixing qualified and unqualified labels).</p>

<h1>33</h1><h1>NIP-33</h1>
<h2>Parameterized Replaceable Events</h2>
<p><code>final</code> <code>mandatory</code> <code>author:Semisol</code> <code>author:Kukks</code> <code>author:Cameri</code> <code>author:Giszmo</code></p>
<p>Moved to <a href="01.md">NIP-01</a>.</p>

<h1>36</h1><h1>NIP-36</h1>
<h2>Sensitive Content / Content Warning</h2>
<p><code>draft</code> <code>optional</code> <code>author:fernandolguevara</code></p>
<p>The <code>content-warning</code> tag enables users to specify if the event's content needs to be approved by readers to be shown.
Clients can hide the content until the user acts on it.</p>
<p><code>l</code> and <code>L</code> tags MAY be also be used as defined in <a href="32.md">NIP-32</a> with the <code>content-warning</code> or other namespace to support
further qualification and querying.</p>
<h4>Spec</h4>
<pre><code>tag: content-warning
options:
 - [reason]: optional
</code></pre>
<h4>Example</h4>
<pre><code class="language-json">{
    &quot;pubkey&quot;: &quot;&lt;pub-key&gt;&quot;,
    &quot;created_at&quot;: 1000000000,
    &quot;kind&quot;: 1,
    &quot;tags&quot;: [
      [&quot;t&quot;, &quot;hastag&quot;],
      [&quot;L&quot;, &quot;content-warning&quot;],
      [&quot;l&quot;, &quot;reason&quot;, &quot;content-warning&quot;],
      [&quot;L&quot;, &quot;social.nos.ontology&quot;],
      [&quot;l&quot;, &quot;NS-nud&quot;, &quot;social.nos.ontology&quot;],
      [&quot;content-warning&quot;, &quot;reason&quot;] /* reason is optional */
    ],
    &quot;content&quot;: &quot;sensitive content with #hastag\n&quot;,
    &quot;id&quot;: &quot;&lt;event-id&gt;&quot;
}
</code></pre>

<h1>38</h1><h1>NIP-38</h1>
<h2>User Statuses</h2>
<p><code>draft</code> <code>optional</code> <code>author:jb55</code></p>
<h2>Abstract</h2>
<p>This NIP enables a way for users to share live statuses such as what music they are listening to, as well as what they are currently doing: work, play, out of office, etc.</p>
<h2>Live Statuses</h2>
<p>A special event with <code>kind:30315</code> &quot;User Status&quot; is defined as an <em>optionally expiring</em> <em>parameterized replaceable event</em>, where the <code>d</code> tag represents the status type:</p>
<p>For example:</p>
<pre><code class="language-js">{
  &quot;kind&quot;: 30315,
  &quot;content&quot;: &quot;Sign up for nostrasia!&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;general&quot;],
    [&quot;r&quot;, &quot;https://nostr.world&quot;]
  ],
}

{
  &quot;kind&quot;: 30315,
  &quot;content&quot;: &quot;Intergalatic - Beastie Boys&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;music&quot;],
    [&quot;r&quot;, &quot;spotify:search:Intergalatic%20-%20Beastie%20Boys&quot;],
    [&quot;expiration&quot;, &quot;1692845589&quot;]
  ],
}
</code></pre>
<p>Two common status types are defined: <code>general</code> and <code>music</code>. <code>general</code> represent general statuses: &quot;Working&quot;, &quot;Hiking&quot;, etc.</p>
<p><code>music</code> status events are for live streaming what you are currently listening to. The expiry of the <code>music</code> status should be when the track will stop playing.</p>
<p>Any other status types can be used but they are not defined by this NIP.</p>
<p>The status MAY include an <code>r</code>, <code>p</code>, <code>e</code> or <code>a</code> tag linking to a URL, profile, note, or parameterized replaceable event.</p>
<h1>Client behavior</h1>
<p>Clients MAY display this next to the username on posts or profiles to provide live user status information.</p>
<h1>Use Cases</h1>
<ul>
<li>Calendar nostr apps that update your general status when you're in a meeting</li>
<li>Nostr Nests that update your general status with a link to the nest when you join</li>
<li>Nostr music streaming services that update your music status when you're listening</li>
<li>Podcasting apps that update your music status when you're listening to a podcast, with a link for others to listen as well</li>
<li>Clients can use the system media player to update playing music status</li>
</ul>
<p>The <code>content</code> MAY include emoji(s), or <a href="30.md">NIP-30</a> custom emoji(s). If the <code>content</code> is an empty string then the client should clear the status.</p>

<h1>39</h1><h1>NIP-39</h1>
<h2>External Identities in Profiles</h2>
<p><code>draft</code> <code>optional</code> <code>author:pseudozach</code> <code>author:Semisol</code></p>
<h2>Abstract</h2>
<p>Nostr protocol users may have other online identities such as usernames, profile pages, keypairs etc. they control and they may want to include this data in their profile metadata so clients can parse, validate and display this information.</p>
<h2><code>i</code> tag on a metadata event</h2>
<p>A new optional <code>i</code> tag is introduced for <code>kind 0</code> metadata event contents in addition to name, about, picture fields as included in <a href="https://github.com/nostr-protocol/nips/blob/master/01.md">NIP-01</a>:</p>
<pre><code class="language-json">{
    &quot;id&quot;: &lt;id&gt;,
    &quot;pubkey&quot;: &lt;pubkey&gt;,
    ...
    &quot;tags&quot;: [
        [&quot;i&quot;, &quot;github:semisol&quot;, &quot;9721ce4ee4fceb91c9711ca2a6c9a5ab&quot;],
        [&quot;i&quot;, &quot;twitter:semisol_public&quot;, &quot;1619358434134196225&quot;],
        [&quot;i&quot;, &quot;mastodon:bitcoinhackers.org/@semisol&quot;, &quot;109775066355589974&quot;]
        [&quot;i&quot;, &quot;telegram:1087295469&quot;, &quot;nostrdirectory/770&quot;]
    ]
}
</code></pre>
<p>An <code>i</code> tag will have two parameters, which are defined as the following:</p>
<ol>
<li><code>platform:identity</code>: This is the platform name (for example <code>github</code>) and the identity on that platform (for example <code>semisol</code>) joined together with <code>:</code>.</li>
<li><code>proof</code>: String or object that points to the proof of owning this identity.</li>
</ol>
<p>Clients SHOULD process any <code>i</code> tags with more than 2 values for future extensibility.<br>
Identity provider names SHOULD only include <code>a-z</code>, <code>0-9</code> and the characters <code>._-/</code> and MUST NOT include <code>:</code>.<br>
Identity names SHOULD be normalized if possible by replacing uppercase letters with lowercase letters, and if there are multiple aliases for an entity the primary one should be used.</p>
<h2>Claim types</h2>
<h3><code>github</code></h3>
<p>Identity: A GitHub username.</p>
<p>Proof: A GitHub Gist ID. This Gist should be created by <code>&lt;identity&gt;</code> with a single file that has the text <code>Verifying that I control the following Nostr public key: &lt;npub encoded public key&gt;</code>.<br>
This can be located at <code>https://gist.github.com/&lt;identity&gt;/&lt;proof&gt;</code>.</p>
<h3><code>twitter</code></h3>
<p>Identity: A Twitter username.</p>
<p>Proof: A Tweet ID. The tweet should be posted by <code>&lt;identity&gt;</code> and have the text <code>Verifying my account on nostr My Public Key: &quot;&lt;npub encoded public key&gt;&quot;</code>.<br>
This can be located at <code>https://twitter.com/&lt;identity&gt;/status/&lt;proof&gt;</code>.</p>
<h3><code>mastodon</code></h3>
<p>Identity: A Mastodon instance and username in the format <code>&lt;instance&gt;/@&lt;username&gt;</code>.</p>
<p>Proof: A Mastodon post ID. This post should be published by <code>&lt;username&gt;@&lt;instance&gt;</code> and have the text <code>Verifying that I control the following Nostr public key: &quot;&lt;npub encoded public key&gt;&quot;</code>.
This can be located at <code>https://&lt;identity&gt;/&lt;proof&gt;</code>.</p>
<h3><code>telegram</code></h3>
<p>Identity: A Telegram user ID.</p>
<p>Proof: A string in the format <code>&lt;ref&gt;/&lt;id&gt;</code> which points to a message published in the public channel or group with name <code>&lt;ref&gt;</code> and message ID <code>&lt;id&gt;</code>. This message should be sent by user ID <code>&lt;identity&gt;</code> and have the text <code>Verifying that I control the following Nostr public key: &quot;&lt;npub encoded public key&gt;&quot;</code>.<br>
This can be located at <code>https://t.me/&lt;proof&gt;</code>.</p>

<h1>40</h1><h1>NIP-40</h1>
<h2>Expiration Timestamp</h2>
<p><code>draft</code> <code>optional</code> <code>author:0xtlt</code></p>
<p>The <code>expiration</code> tag enables users to specify a unix timestamp at which the message SHOULD be considered expired (by relays and clients) and SHOULD be deleted by relays.</p>
<h4>Spec</h4>
<pre><code>tag: expiration
values:
 - [UNIX timestamp in seconds]: required
</code></pre>
<h4>Example</h4>
<pre><code class="language-json">{
    &quot;pubkey&quot;: &quot;&lt;pub-key&gt;&quot;,
    &quot;created_at&quot;: 1000000000,
    &quot;kind&quot;: 1,
    &quot;tags&quot;: [
      [&quot;expiration&quot;, &quot;1600000000&quot;]
    ],
    &quot;content&quot;: &quot;This message will expire at the specified timestamp and be deleted by relays.\n&quot;,
    &quot;id&quot;: &quot;&lt;event-id&gt;&quot;
}
</code></pre>
<p>Note: The timestamp should be in the same format as the created_at timestamp and should be interpreted as the time at which the message should be deleted by relays.</p>
<h2>Client Behavior</h2>
<p>Clients SHOULD use the <code>supported_nips</code> field to learn if a relay supports this NIP. Clients SHOULD NOT send expiration events to relays that do not support this NIP.</p>
<p>Clients SHOULD ignore events that have expired.</p>
<h2>Relay Behavior</h2>
<p>Relays MAY NOT delete expired messages immediately on expiration and MAY persist them indefinitely.<br>
Relays SHOULD NOT send expired events to clients, even if they are stored.<br>
Relays SHOULD drop any events that are published to them if they are expired.<br>
An expiration timestamp does not affect storage of ephemeral events.</p>
<h2>Suggested Use Cases</h2>
<ul>
<li>Temporary announcements - This tag can be used to make temporary announcements. For example, an event organizer could use this tag to post announcements about an upcoming event.</li>
<li>Limited-time offers - This tag can be used by businesses to make limited-time offers that expire after a certain amount of time. For example, a business could use this tag to make a special offer that is only available for a limited time.</li>
</ul>
<h4>Warning</h4>
<p>The events could be downloaded by third parties as they are publicly accessible all the time on the relays.
So don't consider expiring messages as a security feature for your conversations or other uses.</p>

<h1>42</h1><h1>NIP-42</h1>
<h2>Authentication of clients to relays</h2>
<p><code>draft</code> <code>optional</code> <code>author:Semisol</code> <code>author:fiatjaf</code></p>
<p>This NIP defines a way for clients to authenticate to relays by signing an ephemeral event.</p>
<h2>Motivation</h2>
<p>A relay may want to require clients to authenticate to access restricted resources. For example,</p>
<ul>
<li>A relay may request payment or other forms of whitelisting to publish events -- this can naïvely be achieved by limiting publication
to events signed by the whitelisted key, but with this NIP they may choose to accept any events as long as they are published from an
authenticated user;</li>
<li>A relay may limit access to <code>kind: 4</code> DMs to only the parties involved in the chat exchange, and for that it may require authentication
before clients can query for that kind.</li>
<li>A relay may limit subscriptions of any kind to paying users or users whitelisted through any other means, and require authentication.</li>
</ul>
<h2>Definitions</h2>
<p>This NIP defines a new message, <code>AUTH</code>, which relays can send when they support authentication and clients can send to relays when they want
to authenticate. When sent by relays, the message is of the following form:</p>
<pre><code>[&quot;AUTH&quot;, &lt;challenge-string&gt;]
</code></pre>
<p>And, when sent by clients, of the following form:</p>
<pre><code>[&quot;AUTH&quot;, &lt;signed-event-json&gt;]
</code></pre>
<p>The signed event is an ephemeral event not meant to be published or queried, it must be of <code>kind: 22242</code> and it should have at least two tags,
one for the relay URL and one for the challenge string as received from the relay.
Relays MUST exclude <code>kind: 22242</code> events from being broadcasted to any client.
<code>created_at</code> should be the current time. Example:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;...&quot;,
  &quot;pubkey&quot;: &quot;...&quot;,
  &quot;created_at&quot;: 1669695536,
  &quot;kind&quot;: 22242,
  &quot;tags&quot;: [
    [&quot;relay&quot;, &quot;wss://relay.example.com/&quot;],
    [&quot;challenge&quot;, &quot;challengestringhere&quot;]
  ],
  &quot;content&quot;: &quot;&quot;,
  &quot;sig&quot;: &quot;...&quot;
}
</code></pre>
<h2>Protocol flow</h2>
<p>At any moment the relay may send an <code>AUTH</code> message to the client containing a challenge. After receiving that the client may decide to
authenticate itself or not. The challenge is expected to be valid for the duration of the connection or until a next challenge is sent by
the relay.</p>
<p>The client may send an auth message right before performing an action for which it knows authentication will be required -- for example, right
before requesting <code>kind: 4</code> chat messages --, or it may do right on connection start or at some other moment it deems best. The authentication
is expected to last for the duration of the WebSocket connection.</p>
<p>Upon receiving a message from an unauthenticated user it can't fulfill without authentication, a relay may choose to notify the client. For
that it can use a <code>NOTICE</code> or <code>OK</code> message with a standard prefix <code>&quot;restricted: &quot;</code> that is readable both by humans and machines, for example:</p>
<pre><code>[&quot;NOTICE&quot;, &quot;restricted: we can't serve DMs to unauthenticated users, does your client implement NIP-42?&quot;]
</code></pre>
<p>or it can return an <code>OK</code> message noting the reason an event was not written using the same prefix:</p>
<pre><code>[&quot;OK&quot;, &lt;event-id&gt;, false, &quot;restricted: we do not accept events from unauthenticated users, please sign up at https://example.com/&quot;]
</code></pre>
<h2>Signed Event Verification</h2>
<p>To verify <code>AUTH</code> messages, relays must ensure:</p>
<ul>
<li>that the <code>kind</code> is <code>22242</code>;</li>
<li>that the event <code>created_at</code> is close (e.g. within ~10 minutes) of the current time;</li>
<li>that the <code>&quot;challenge&quot;</code> tag matches the challenge sent before;</li>
<li>that the <code>&quot;relay&quot;</code> tag matches the relay URL:
<ul>
<li>URL normalization techniques can be applied. For most cases just checking if the domain name is correct should be enough.</li>
</ul>
</li>
</ul>

<h1>45</h1><h1>NIP-45</h1>
<h2>Event Counts</h2>
<p><code>draft</code> <code>optional</code> <code>author:staab</code></p>
<p>Relays may support the verb <code>COUNT</code>, which provides a mechanism for obtaining event counts.</p>
<h2>Motivation</h2>
<p>Some queries a client may want to execute against connected relays are prohibitively expensive, for example, in order to retrieve follower counts for a given pubkey, a client must query all kind-3 events referring to a given pubkey only to count them. The result may be cached, either by a client or by a separate indexing server as an alternative, but both options erode the decentralization of the network by creating a second-layer protocol on top of Nostr.</p>
<h2>Filters and return values</h2>
<p>This NIP defines the verb <code>COUNT</code>, which accepts a subscription id and filters as specified in <a href="01.md">NIP 01</a> for the verb <code>REQ</code>. Multiple filters are OR'd together and aggregated into a single count result.</p>
<pre><code>[&quot;COUNT&quot;, &lt;subscription_id&gt;, &lt;filters JSON&gt;...]
</code></pre>
<p>Counts are returned using a <code>COUNT</code> response in the form <code>{&quot;count&quot;: &lt;integer&gt;}</code>. Relays may use probabilistic counts to reduce compute requirements.
In case a relay uses probabilistic counts, it MAY indicate it in the response with <code>approximate</code> key i.e. <code>{&quot;count&quot;: &lt;integer&gt;, &quot;approximate&quot;: &lt;true|false&gt;}</code>.</p>
<pre><code>[&quot;COUNT&quot;, &lt;subscription_id&gt;, {&quot;count&quot;: &lt;integer&gt;}]
</code></pre>
<p>Examples:</p>
<pre><code># Followers count
[&quot;COUNT&quot;, &lt;subscription_id&gt;, {&quot;kinds&quot;: [3], &quot;#p&quot;: [&lt;pubkey&gt;]}]
[&quot;COUNT&quot;, &lt;subscription_id&gt;, {&quot;count&quot;: 238}]

# Count posts and reactions
[&quot;COUNT&quot;, &lt;subscription_id&gt;, {&quot;kinds&quot;: [1, 7], &quot;authors&quot;: [&lt;pubkey&gt;]}]
[&quot;COUNT&quot;, &lt;subscription_id&gt;, {&quot;count&quot;: 5}]

# Count posts approximately
[&quot;COUNT&quot;, &lt;subscription_id&gt;, {&quot;kinds&quot;: [1]}]
[&quot;COUNT&quot;, &lt;subscription_id&gt;, {&quot;count&quot;: 93412452, &quot;approximate&quot;: true}]
</code></pre>

<h1>46</h1><h1>NIP-46</h1>
<h2>Nostr Connect</h2>
<p><code>draft</code> <code>optional</code> <code>author:tiero</code> <code>author:giowe</code> <code>author:vforvalerio87</code></p>
<h2>Rationale</h2>
<p>Private keys should be exposed to as few systems - apps, operating systems, devices - as possible as each system adds to the attack surface.</p>
<p>Entering private keys can also be annoying and requires exposing them to even more systems such as the operating system's clipboard that might be monitored by malicious apps.</p>
<h2>Terms</h2>
<ul>
<li><strong>App</strong>: Nostr app on any platform that <em>requires</em> to act on behalf of a nostr account.</li>
<li><strong>Signer</strong>: Nostr app that holds the private key of a nostr account and <em>can sign</em> on its behalf.</li>
</ul>
<h2><code>TL;DR</code></h2>
<p><strong>App</strong> and <strong>Signer</strong> sends ephemeral encrypted messages to each other using kind <code>24133</code>, using a relay of choice.</p>
<p>App prompts the Signer to do things such as fetching the public key or signing events.</p>
<p>The <code>content</code> field must be an encrypted JSONRPC-ish <strong>request</strong> or <strong>response</strong>.</p>
<h2>Signer Protocol</h2>
<h3>Messages</h3>
<h4>Request</h4>
<pre><code class="language-json">{
  &quot;id&quot;: &lt;random_string&gt;,
  &quot;method&quot;: &lt;one_of_the_methods&gt;,
  &quot;params&quot;: [&lt;anything&gt;, &lt;else&gt;]
}
</code></pre>
<h4>Response</h4>
<pre><code class="language-json">{
  &quot;id&quot;: &lt;request_id&gt;,
  &quot;result&quot;: &lt;anything&gt;,
  &quot;error&quot;: &lt;reason&gt;
}
</code></pre>
<h3>Methods</h3>
<h4>Mandatory</h4>
<p>These are mandatory methods the remote signer app MUST implement:</p>
<ul>
<li><strong>describe</strong>
<ul>
<li>params []</li>
<li>result <code>[&quot;describe&quot;, &quot;get_public_key&quot;, &quot;sign_event&quot;, &quot;connect&quot;, &quot;disconnect&quot;, &quot;delegate&quot;, ...]</code></li>
</ul>
</li>
<li><strong>get_public_key</strong>
<ul>
<li>params []</li>
<li>result <code>pubkey</code></li>
</ul>
</li>
<li><strong>sign_event</strong>
<ul>
<li>params [<code>event</code>]</li>
<li>result <code>event_with_signature</code></li>
</ul>
</li>
</ul>
<h4>optional</h4>
<ul>
<li><strong>connect</strong>
<ul>
<li>params [<code>pubkey</code>]</li>
</ul>
</li>
<li><strong>disconnect</strong>
<ul>
<li>params []</li>
</ul>
</li>
<li><strong>delegate</strong>
<ul>
<li>params [<code>delegatee</code>, <code>{ kind: number, since: number, until: number }</code>]</li>
<li>result <code>{ from: string, to: string, cond: string, sig: string }</code></li>
</ul>
</li>
<li><strong>get_relays</strong>
<ul>
<li>params []</li>
<li>result <code>{ [url: string]: {read: boolean, write: boolean} }</code></li>
</ul>
</li>
<li><strong>nip04_encrypt</strong>
<ul>
<li>params [<code>pubkey</code>, <code>plaintext</code>]</li>
<li>result <code>nip4 ciphertext</code></li>
</ul>
</li>
<li><strong>nip04_decrypt</strong>
<ul>
<li>params [<code>pubkey</code>, <code>nip4 ciphertext</code>]</li>
<li>result [<code>plaintext</code>]</li>
</ul>
</li>
</ul>
<p>NOTICE: <code>pubkey</code> and <code>signature</code> are hex-encoded strings.</p>
<h3>Nostr Connect URI</h3>
<p><strong>Signer</strong> discovers <strong>App</strong> by scanning a QR code, clicking on a deep link or copy-pasting an URI.</p>
<p>The <strong>App</strong> generates a special URI with prefix <code>nostrconnect://</code> and base path the hex-encoded <code>pubkey</code> with the following querystring parameters <strong>URL encoded</strong></p>
<ul>
<li><code>relay</code> URL of the relay of choice where the <strong>App</strong> is connected and the <strong>Signer</strong> must send and listen for messages.</li>
<li><code>metadata</code>  metadata JSON of the <strong>App</strong>
<ul>
<li><code>name</code> human-readable name of the <strong>App</strong></li>
<li><code>url</code> (optional) URL of the website requesting the connection</li>
<li><code>description</code> (optional) description of the <strong>App</strong></li>
<li><code>icons</code> (optional) array of URLs for icons of the <strong>App</strong>.</li>
</ul>
</li>
</ul>
<h4>JavaScript</h4>
<pre><code class="language-js">const uri = `nostrconnect://&lt;pubkey&gt;?relay=${encodeURIComponent(&quot;wss://relay.damus.io&quot;)}&amp;metadata=${encodeURIComponent(JSON.stringify({&quot;name&quot;: &quot;Example&quot;}))}`
</code></pre>
<h4>Example</h4>
<pre><code class="language-sh">nostrconnect://b889ff5b1513b641e2a139f661a661364979c5beee91842f8f0ef42ab558e9d4?relay=wss%3A%2F%2Frelay.damus.io&amp;metadata=%7B%22name%22%3A%22Example%22%7D
</code></pre>
<h2>Flows</h2>
<p>The <code>content</code> field contains encrypted message as specified by <a href="https://github.com/nostr-protocol/nips/blob/master/04.md">NIP04</a>. The <code>kind</code> chosen is <code>24133</code>.</p>
<h3>Connect</h3>
<ol>
<li>User clicks on <strong>&quot;Connect&quot;</strong> button on a website or scan it with a QR code</li>
<li>It will show an URI to open a &quot;nostr connect&quot; enabled <strong>Signer</strong></li>
<li>In the URI there is a pubkey of the <strong>App</strong> ie. <code>nostrconnect://&lt;pubkey&gt;&amp;relay=&lt;relay&gt;&amp;metadata=&lt;metadata&gt;</code></li>
<li>The <strong>Signer</strong> will send a message to ACK the <code>connect</code> request, along with his public key</li>
</ol>
<h3>Disconnect (from App)</h3>
<ol>
<li>User clicks on <strong>&quot;Disconnect&quot;</strong> button on the <strong>App</strong></li>
<li>The <strong>App</strong> will send a message to the <strong>Signer</strong> with a <code>disconnect</code> request</li>
<li>The <strong>Signer</strong> will send a message to ACK the <code>disconnect</code> request</li>
</ol>
<h3>Disconnect (from Signer)</h3>
<ol>
<li>User clicks on <strong>&quot;Disconnect&quot;</strong> button on the <strong>Signer</strong></li>
<li>The <strong>Signer</strong> will send a message to the <strong>App</strong> with a <code>disconnect</code> request</li>
</ol>
<h3>Get Public Key</h3>
<ol>
<li>The <strong>App</strong> will send a message to the <strong>Signer</strong> with a <code>get_public_key</code> request</li>
<li>The <strong>Signer</strong> will send back a message with the public key as a response to the <code>get_public_key</code> request</li>
</ol>
<h3>Sign Event</h3>
<ol>
<li>The <strong>App</strong> will send a message to the <strong>Signer</strong> with a <code>sign_event</code> request along with the <strong>event</strong> to be signed</li>
<li>The <strong>Signer</strong> will show a popup to the user to inspect the event and sign it</li>
<li>The <strong>Signer</strong> will send back a message with the event including the <code>id</code> and the schnorr <code>signature</code> as a response to the <code>sign_event</code> request</li>
</ol>
<h3>Delegate</h3>
<ol>
<li>The <strong>App</strong> will send a message with metadata to the <strong>Signer</strong> with a <code>delegate</code> request along with the <strong>conditions</strong> query string and the <strong>pubkey</strong> of the <strong>App</strong> to be delegated.</li>
<li>The <strong>Signer</strong> will show a popup to the user to delegate the <strong>App</strong> to sign on his behalf</li>
<li>The <strong>Signer</strong> will send back a message with the signed <a href="https://github.com/nostr-protocol/nips/blob/master/26.md">NIP-26 delegation token</a> or reject it</li>
</ol>

<h1>47</h1><h1>NIP-47</h1>
<h2>Nostr Wallet Connect</h2>
<p><code>draft</code> <code>optional</code> <code>author:kiwiidb</code> <code>author:bumi</code> <code>author:semisol</code> <code>author:vitorpamplona</code></p>
<h2>Rationale</h2>
<p>This NIP describes a way for clients to access a remote Lightning wallet through a standardized protocol. Custodians may implement this, or the user may run a bridge that bridges their wallet/node and the Nostr Wallet Connect protocol.</p>
<h2>Terms</h2>
<ul>
<li><strong>client</strong>: Nostr app on any platform that wants to pay Lightning invoices.</li>
<li><strong>user</strong>: The person using the <strong>client</strong>, and want's to connect their wallet app to their <strong>client</strong>.</li>
<li><strong>wallet service</strong>: Nostr app that typically runs on an always-on computer (eg. in the cloud or on a Raspberry Pi).  This app has access to the APIs of the wallets it serves.</li>
</ul>
<h2>Theory of Operation</h2>
<ol>
<li>
<p><strong>Users</strong> who which to use this NIP to send lightning payments to other nostr users must first acquire a special &quot;connection&quot; URI from their NIP-47 compliant wallet application.  The wallet application may provide this URI using a QR screen, or a pasteable string, or some other means.</p>
</li>
<li>
<p>The <strong>user</strong> should then copy this URI into their <strong>client(s)</strong> by pasting, or scanning the QR, etc.  The <strong>client(s)</strong> should save this URI and use it later whenever the <strong>user</strong> makes a payment.  The <strong>client</strong> should then request an <code>info</code> (13194) event from the relay(s) specified in the URI.  The <strong>wallet service</strong> will have sent that event to those relays earlier, and the relays will hold it as a replaceable event.</p>
</li>
<li>
<p>When the <strong>user</strong> initiates a payment their nostr <strong>client</strong> create a <code>pay_invoice</code> request, encrypts it using a token from the URI, and sends it (kind 23194) to the relay(s) specified in the connection URI.  The <strong>wallet service</strong> will be listening on those relays and will decrypt the request and then contact the <strong>user's</strong> wallet application to send the payment.  The <strong>wallet service</strong> will know how to talk to the wallet application because the connection URI specified relay(s) that have access to the wallet app API.</p>
</li>
<li>
<p>Once the payment is complete the <strong>wallet service</strong> will send an encrypted <code>response</code> (kind 23195) to the <strong>user</strong> over the relay(s) in the URI.</p>
</li>
</ol>
<h2>Events</h2>
<p>There are three event kinds:</p>
<ul>
<li><code>NIP-47 info event</code>: 13194</li>
<li><code>NIP-47 request</code>: 23194</li>
<li><code>NIP-47 response</code>: 23195</li>
</ul>
<p>The info event should be a replaceable event that is published by the <strong>wallet service</strong> on the relay to indicate which commands it supports. The content should be
a plaintext string with the supported commands, space-separated, eg. <code>pay_invoice get_balance</code>. Only the <code>pay_invoice</code> command is described in this NIP, but other commands might be defined in different NIPs.</p>
<p>Both the request and response events SHOULD contain one <code>p</code> tag, containing the public key of the <strong>wallet service</strong> if this is a request, and the public key of the <strong>user</strong> if this is a response. The response event SHOULD contain an <code>e</code> tag with the id of the request event it is responding to.</p>
<p>The content of requests and responses is encrypted with <a href="https://github.com/nostr-protocol/nips/blob/master/04.md">NIP04</a>, and is a JSON-RPCish object with a semi-fixed structure:</p>
<p>Request:</p>
<pre><code class="language-jsonc">{
    &quot;method&quot;: &quot;pay_invoice&quot;, // method, string
    &quot;params&quot;: { // params, object
        &quot;invoice&quot;: &quot;lnbc50n1...&quot; // command-related data
    }
}
</code></pre>
<p>Response:</p>
<pre><code class="language-jsonc">{
    &quot;result_type&quot;: &quot;pay_invoice&quot;, //indicates the structure of the result field
    &quot;error&quot;: { //object, non-null in case of error
        &quot;code&quot;: &quot;UNAUTHORIZED&quot;, //string error code, see below
        &quot;message&quot;: &quot;human readable error message&quot;
    },
    &quot;result&quot;: { // result, object. null in case of error.
        &quot;preimage&quot;: &quot;0123456789abcdef...&quot; // command-related data
    }
}
</code></pre>
<p>The <code>result_type</code> field MUST contain the name of the method that this event is responding to.
The <code>error</code> field MUST contain a <code>message</code> field with a human readable error message and a <code>code</code> field with the error code if the command was not successful.
If the command was successful, the <code>error</code> field must be null.</p>
<h3>Error codes</h3>
<ul>
<li><code>RATE_LIMITED</code>: The client is sending commands too fast. It should retry in a few seconds.</li>
<li><code>NOT_IMPLEMENTED</code>: The command is not known or is intentionally not implemented.</li>
<li><code>INSUFFICIENT_BALANCE</code>: The wallet does not have enough funds to cover a fee reserve or the payment amount.</li>
<li><code>QUOTA_EXCEEDED</code>: The wallet has exceeded its spending quota.</li>
<li><code>RESTRICTED</code>: This public key is not allowed to do this operation.</li>
<li><code>UNAUTHORIZED</code>: This public key has no wallet connected.</li>
<li><code>INTERNAL</code>: An internal error.</li>
<li><code>OTHER</code>: Other error.</li>
</ul>
<h2>Nostr Wallet Connect URI</h2>
<p><strong>client</strong> discovers <strong>wallet service</strong> by scanning a QR code, handling a deeplink or pasting in a URI.</p>
<p>The <strong>wallet service</strong> generates this connection URI with protocol <code>nostr+walletconnect:</code> and base path it's hex-encoded <code>pubkey</code> with the following query string parameters:</p>
<ul>
<li><code>relay</code> Required. URL of the relay where the <strong>wallet service</strong> is connected and will be listening for events. May be more than one.</li>
<li><code>secret</code> Required. 32-byte randomly generated hex encoded string. The <strong>client</strong> MUST use this to sign events and encrypt payloads when communicating with the <strong>wallet service</strong>.
<ul>
<li>Authorization does not require passing keys back and forth.</li>
<li>The user can have different keys for different applications. Keys can be revoked and created at will and have arbitrary constraints (eg. budgets).</li>
<li>The key is harder to leak since it is not shown to the user and backed up.</li>
<li>It improves privacy because the user's main key would not be linked to their payments.</li>
</ul>
</li>
<li><code>lud16</code> Recommended. A lightning address that clients can use to automatically setup the <code>lud16</code> field on the user's profile if they have none configured.</li>
</ul>
<p>The <strong>client</strong> should then store this connection and use it when the user wants to perform actions like paying an invoice. Due to this NIP using ephemeral events, it is recommended to pick relays that do not close connections on inactivity to not drop events.</p>
<h3>Example connection string</h3>
<pre><code class="language-sh">nostr+walletconnect:b889ff5b1513b641e2a139f661a661364979c5beee91842f8f0ef42ab558e9d4?relay=wss%3A%2F%2Frelay.damus.io&amp;secret=71a8c14c1407c113601079c4302dab36460f0ccd0ad506f1f2dc73b5100e4f3c
</code></pre>
<h2>Commands</h2>
<h3><code>pay_invoice</code></h3>
<p>Description: Requests payment of an invoice.</p>
<p>Request:</p>
<pre><code class="language-jsonc">{
    &quot;method&quot;: &quot;pay_invoice&quot;,
    &quot;params&quot;: {
        &quot;invoice&quot;: &quot;lnbc50n1...&quot; // bolt11 invoice
    }
}
</code></pre>
<p>Response:</p>
<pre><code class="language-jsonc">{
    &quot;result_type&quot;: &quot;pay_invoice&quot;,
    &quot;result&quot;: { 
        &quot;preimage&quot;: &quot;0123456789abcdef...&quot; // preimage of the payment
    }
}
</code></pre>
<p>Errors:</p>
<ul>
<li><code>PAYMENT_FAILED</code>: The payment failed. This may be due to a timeout, exhausting all routes, insufficient capacity or similar.</li>
</ul>
<h2>Example pay invoice flow</h2>
<ol start="0">
<li>The user scans the QR code generated by the <strong>wallet service</strong> with their <strong>client</strong> application, they follow a <code>nostr+walletconnect:</code> deeplink or configure the connection details manually.</li>
<li><strong>client</strong> sends an event to the <strong>wallet service</strong> service with kind <code>23194</code>. The content is a <code>pay_invoice</code> request. The private key is the secret from the connection string above.</li>
<li><strong>wallet service</strong> verifies that the author's key is authorized to perform the payment, decrypts the payload and sends the payment.</li>
<li><strong>wallet service</strong> responds to the event by sending an event with kind <code>23195</code> and content being a response either containing an error message or a preimage.</li>
</ol>
<h2>Using a dedicated relay</h2>
<p>This NIP does not specify any requirements on the type of relays used. However, if the user is using a custodial service it might make sense to use a relay that is hosted by the custodial service. The relay may then enforce authentication to prevent metadata leaks. Not depending on a 3rd party relay would also improve reliability in this case.</p>

<h1>48</h1><h1>NIP-48</h1>
<h2>Proxy Tags</h2>
<p><code>draft</code> <code>optional</code> <code>author:alexgleason</code></p>
<p>Nostr events bridged from other protocols such as ActivityPub can link back to the source object by including a <code>&quot;proxy&quot;</code> tag, in the form:</p>
<pre><code>[&quot;proxy&quot;, &lt;id&gt;, &lt;protocol&gt;]
</code></pre>
<p>Where:</p>
<ul>
<li><code>&lt;id&gt;</code> is the ID of the source object. The ID format varies depending on the protocol. The ID must be universally unique, regardless of the protocol.</li>
<li><code>&lt;protocol&gt;</code> is the name of the protocol, e.g. <code>&quot;activitypub&quot;</code>.</li>
</ul>
<p>Clients may use this information to reconcile duplicated content bridged from other protocols, or to display a link to the source object.</p>
<p>Proxy tags may be added to any event kind, and doing so indicates that the event did not originate on the Nostr protocol, and instead originated elsewhere on the web.</p>
<h3>Supported protocols</h3>
<p>This list may be extended in the future.</p>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>ID format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>activitypub</code></td>
<td>URL</td>
<td><code>https://gleasonator.com/objects/9f524868-c1a0-4ee7-ad51-aaa23d68b526</code></td>
</tr>
<tr>
<td><code>atproto</code></td>
<td>AT URI</td>
<td><code>at://did:plc:zhbjlbmir5dganqhueg7y4i3/app.bsky.feed.post/3jt5hlibeol2i</code></td>
</tr>
<tr>
<td><code>rss</code></td>
<td>URL with guid fragment</td>
<td><code>https://soapbox.pub/rss/feed.xml#https%3A%2F%2Fsoapbox.pub%2Fblog%2Fmostr-fediverse-nostr-bridge</code></td>
</tr>
<tr>
<td><code>web</code></td>
<td>URL</td>
<td><code>https://twitter.com/jack/status/20</code></td>
</tr>
</tbody>
</table>
<h3>Examples</h3>
<p>ActivityPub object:</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 1,
  &quot;content&quot;: &quot;I'm vegan btw&quot;,
  &quot;tags&quot;: [
    [
      &quot;proxy&quot;,
      &quot;https://gleasonator.com/objects/8f6fac53-4f66-4c6e-ac7d-92e5e78c3e79&quot;,
      &quot;activitypub&quot;
    ]
  ],
  &quot;pubkey&quot;: &quot;79c2cae114ea28a981e7559b4fe7854a473521a8d22a66bbab9fa248eb820ff6&quot;,
  &quot;created_at&quot;: 1691091365,
  &quot;id&quot;: &quot;55920b758b9c7b17854b6e3d44e6a02a83d1cb49e1227e75a30426dea94d4cb2&quot;,
  &quot;sig&quot;: &quot;a72f12c08f18e85d98fb92ae89e2fe63e48b8864c5e10fbdd5335f3c9f936397a6b0a7350efe251f8168b1601d7012d4a6d0ee6eec958067cf22a14f5a5ea579&quot;
}
</code></pre>
<h3>See also</h3>
<ul>
<li><a href="https://codeberg.org/fediverse/fep/src/branch/main/fep/fffd/fep-fffd.md">FEP-fffd: Proxy Objects</a></li>
<li><a href="https://mostr.pub/">Mostr bridge</a></li>
</ul>

<h1>50</h1><h1>NIP-50</h1>
<h2>Search Capability</h2>
<p><code>draft</code> <code>optional</code> <code>author:brugeman</code> <code>author:mikedilger</code> <code>author:fiatjaf</code></p>
<h2>Abstract</h2>
<p>Many Nostr use cases require some form of general search feature, in addition to structured queries by tags or ids.
Specifics of the search algorithms will differ between event kinds, this NIP only describes a general
extensible framework for performing such queries.</p>
<h2><code>search</code> filter field</h2>
<p>A new <code>search</code> field is introduced for <code>REQ</code> messages from clients:</p>
<pre><code class="language-json">{
  ...
  &quot;search&quot;: &lt;string&gt;
}
</code></pre>
<p><code>search</code> field is a string describing a query in a human-readable form, i.e. &quot;best nostr apps&quot;.
Relays SHOULD interpret the query to the best of their ability and return events that match it.
Relays SHOULD perform matching against <code>content</code> event field, and MAY perform
matching against other fields if that makes sense in the context of a specific kind.</p>
<p>A query string may contain <code>key:value</code> pairs (two words separated by colon), these are extensions, relays SHOULD ignore
extensions they don't support.</p>
<p>Clients may specify several search filters, i.e. <code>[&quot;REQ&quot;, &quot;&quot;, { &quot;search&quot;: &quot;orange&quot; }, { &quot;kinds&quot;: [1, 2], &quot;search&quot;: &quot;purple&quot; }]</code>. Clients may
include <code>kinds</code>, <code>ids</code> and other filter field to restrict the search results to particular event kinds.</p>
<p>Clients SHOULD use the supported_nips field to learn if a relay supports <code>search</code> filter. Clients MAY send <code>search</code>
filter queries to any relay, if they are prepared to filter out extraneous responses from relays that do not support this NIP.</p>
<p>Clients SHOULD query several relays supporting this NIP to compensate for potentially different
implementation details between relays.</p>
<p>Clients MAY verify that events returned by a relay match the specified query in a way that suits the
client's use case, and MAY stop querying relays that have low precision.</p>
<p>Relays SHOULD exclude spam from search results by default if they supports some form of spam filtering.</p>
<h2>Extensions</h2>
<p>Relay MAY support these extensions:</p>
<ul>
<li><code>include:spam</code> - turn off spam filtering, if it was enabled by default</li>
</ul>

<h1>51</h1><h1>NIP-51</h1>
<h2>Lists</h2>
<p><code>draft</code> <code>optional</code> <code>author:fiatjaf</code> <code>author:arcbtc</code> <code>author:monlovesmango</code> <code>author:eskema</code> <code>author:gzuuus</code></p>
<p>A &quot;list&quot; event is defined as having a list of public and/or private tags. Public tags will be listed in the event <code>tags</code>. Private tags will be encrypted in the event <code>content</code>. Encryption for private tags will use <a href="04.md">NIP-04 - Encrypted Direct Message</a> encryption, using the list author's private and public key for the shared secret. A distinct event kind should be used for each list type created.</p>
<p>If a list should only be defined once per user (like the &quot;mute&quot; list) the list is declared as a <em>replaceable event</em>. These lists may be referred to as &quot;replaceable lists&quot;. Otherwise, the list is a <em>parameterized replaceable event</em> and the list name will be used as the <code>d</code> tag. These lists may be referred to as &quot;parameterized replaceable lists&quot;.</p>
<h2>Replaceable List Event Example</h2>
<p>Lets say a user wants to create a 'Mute' list and has keys:</p>
<pre><code>priv: fb505c65d4df950f5d28c9e4d285ee12ffaf315deef1fc24e3c7cd1e7e35f2b1
pub: b1a5c93edcc8d586566fde53a20bdb50049a97b15483cb763854e57016e0fa3d
</code></pre>
<p>The user wants to publicly include these users:</p>
<pre><code class="language-json">[&quot;p&quot;, &quot;3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d&quot;],
[&quot;p&quot;, &quot;32e1827635450ebb3c5a7d12c1f8e7b2b514439ac10a67eef3d9fd9c5c68e245&quot;]
</code></pre>
<p>and privately include these users (below is the JSON that would be encrypted and placed in the event content):</p>
<pre><code class="language-json">[
    [&quot;p&quot;, &quot;9ec7a778167afb1d30c4833de9322da0c08ba71a69e1911d5578d3144bb56437&quot;],
    [&quot;p&quot;, &quot;8c0da4862130283ff9e67d889df264177a508974e2feb96de139804ea66d6168&quot;]
]
</code></pre>
<p>Then the user would create a 'Mute' list event like below:</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 10000,
  &quot;tags&quot;: [
    [&quot;p&quot;, &quot;3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d&quot;],
    [&quot;p&quot;, &quot;32e1827635450ebb3c5a7d12c1f8e7b2b514439ac10a67eef3d9fd9c5c68e245&quot;],
  ],
  &quot;content&quot;: &quot;VezuSvWak++ASjFMRqBPWS3mK5pZ0vRLL325iuIL4S+r8n9z+DuMau5vMElz1tGC/UqCDmbzE2kwplafaFo/FnIZMdEj4pdxgptyBV1ifZpH3TEF6OMjEtqbYRRqnxgIXsuOSXaerWgpi0pm+raHQPseoELQI/SZ1cvtFqEUCXdXpa5AYaSd+quEuthAEw7V1jP+5TDRCEC8jiLosBVhCtaPpLcrm8HydMYJ2XB6Ixs=?iv=/rtV49RFm0XyFEwG62Eo9A==&quot;,
  ...other fields
}
</code></pre>
<h2>Parameterized Replaceable List Event Example</h2>
<p>Lets say a user wants to create a 'Categorized People' list of <code>nostr</code> people and has keys:</p>
<pre><code>priv: fb505c65d4df950f5d28c9e4d285ee12ffaf315deef1fc24e3c7cd1e7e35f2b1
pub: b1a5c93edcc8d586566fde53a20bdb50049a97b15483cb763854e57016e0fa3d
</code></pre>
<p>The user wants to publicly include these users:</p>
<pre><code class="language-json">[&quot;p&quot;, &quot;3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d&quot;],
[&quot;p&quot;, &quot;32e1827635450ebb3c5a7d12c1f8e7b2b514439ac10a67eef3d9fd9c5c68e245&quot;]
</code></pre>
<p>and privately include these users (below is the JSON that would be encrypted and placed in the event content):</p>
<pre><code class="language-json">[
    [&quot;p&quot;, &quot;9ec7a778167afb1d30c4833de9322da0c08ba71a69e1911d5578d3144bb56437&quot;],
    [&quot;p&quot;, &quot;8c0da4862130283ff9e67d889df264177a508974e2feb96de139804ea66d6168&quot;]
]
</code></pre>
<p>Then the user would create a 'Categorized People' list event like below:</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 30000,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;nostr&quot;],
    [&quot;p&quot;, &quot;3bf0c63fcb93463407af97a5e5ee64fa883d107ef9e558472c4eb9aaaefa459d&quot;],
    [&quot;p&quot;, &quot;32e1827635450ebb3c5a7d12c1f8e7b2b514439ac10a67eef3d9fd9c5c68e245&quot;],
  ],
  &quot;content&quot;: &quot;VezuSvWak++ASjFMRqBPWS3mK5pZ0vRLL325iuIL4S+r8n9z+DuMau5vMElz1tGC/UqCDmbzE2kwplafaFo/FnIZMdEj4pdxgptyBV1ifZpH3TEF6OMjEtqbYRRqnxgIXsuOSXaerWgpi0pm+raHQPseoELQI/SZ1cvtFqEUCXdXpa5AYaSd+quEuthAEw7V1jP+5TDRCEC8jiLosBVhCtaPpLcrm8HydMYJ2XB6Ixs=?iv=/rtV49RFm0XyFEwG62Eo9A==&quot;,
  ...other fields
}
</code></pre>
<p>Lets say a user wants to create a 'Categorized Bookmarks' list of <code>bookmarks</code> and has keys:</p>
<pre><code>priv: fb505c65d4df950f5d28c9e4d285ee12ffaf315deef1fc24e3c7cd1e7e35f2b1
pub: b1a5c93edcc8d586566fde53a20bdb50049a97b15483cb763854e57016e0fa3d
</code></pre>
<p>The user wants to publicly include these bookmarks:</p>
<pre><code class="language-json">[&quot;e&quot;, &quot;5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36&quot;, &quot;wss://nostr.example.com&quot;],
[&quot;a&quot;, &quot;30023:f7234bd4c1394dda46d09f35bd384dd30cc552ad5541990f98844fb06676e9ca:abcd&quot;, &quot;wss://nostr.example.com&quot;],
[&quot;r&quot;, &quot;https://github.com/nostr-protocol/nostr&quot;, &quot;Nostr repository&quot;],
</code></pre>
<p>and privately include these bookmarks (below is the JSON that would be encrypted and placed in the event content):</p>
<pre><code class="language-json">[
    [&quot;r&quot;, &quot;https://my-private.bookmark&quot;, &quot;My private bookmark&quot;],
    [&quot;a&quot;, &quot;30001:f7234bd4c1394dda46d09f35bd384dd30cc552ad5541990f98844fb06676e9ca:abcd&quot;, &quot;wss://nostr.example.com&quot;],
]
</code></pre>
<p>Then the user would create a 'Categorized Bookmarks' list event like below:</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 30001,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;bookmarks&quot;],
    [&quot;e&quot;, &quot;5c83da77af1dec6d7289834998ad7aafbd9e2191396d75ec3cc27f5a77226f36&quot;, &quot;wss://nostr.example.com&quot;],
    [&quot;a&quot;, &quot;30023:f7234bd4c1394dda46d09f35bd384dd30cc552ad5541990f98844fb06676e9ca:abcd&quot;, &quot;wss://nostr.example.com&quot;],
    [&quot;r&quot;, &quot;https://github.com/nostr-protocol/nostr&quot;, &quot;Nostr repository&quot;],
  ],
  &quot;content&quot;: &quot;y3AyaLJfnmYr9x9Od9o4aYrmL9+Ynmsim5y2ONrU0urOTq+V81CyAthQ2mUOWE9xwGgrizhY7ILdQwWhy6FK0sA33GHtC0egUJw1zIdknPe7BZjznD570yk/8RXYgGyDKdexME+RMYykrnYFxq1+y/h00kmJg4u+Gpn+ZjmVhNYxl9b+TiBOAXG9UxnK/H0AmUqDpcldn6+j1/AiStwYZhD1UZ3jzDIk2qcCDy7MlGnYhSP+kNmG+2b0T/D1L0Z7?iv=PGJJfPE84gacAh7T0e6duQ==&quot;,
  ...other fields
}
</code></pre>
<h2>List Event Kinds</h2>
<table>
<thead>
<tr>
<th>kind</th>
<th>list type</th>
</tr>
</thead>
<tbody>
<tr>
<td>10000</td>
<td>Mute</td>
</tr>
<tr>
<td>10001</td>
<td>Pin</td>
</tr>
<tr>
<td>30000</td>
<td>Categorized People</td>
</tr>
<tr>
<td>30001</td>
<td>Categorized Bookmarks</td>
</tr>
</tbody>
</table>
<h3>Mute List</h3>
<p>An event with kind <code>10000</code> is defined as a replaceable list event for listing content a user wants to mute. Any standardized tag can be included in a Mute List.</p>
<h3>Pin List</h3>
<p>An event with kind <code>10001</code> is defined as a replaceable list event for listing content a user wants to pin. Any standardized tag can be included in a Pin List.</p>
<h3>Categorized People List</h3>
<p>An event with kind <code>30000</code> is defined as a parameterized replaceable list event for categorizing people. The 'd' parameter for this event holds the category name of the list. The tags included in these lists MUST follow the format of kind 3 events as defined in <a href="02.md">NIP-02 - Contact List and Petnames</a>.</p>
<h3>Categorized Bookmarks List</h3>
<p>An event of kind <code>30001</code> is defined as a parameterized replaceable list event for categorizing bookmarks. The 'd' parameter for this event holds the category name of the list. The bookmark lists may contain metadata tags such as 'title', 'image', 'summary' as defined in <a href="23.md">NIP-23 - Long-form Content</a>. Any standardized tag can be included in a Categorized Bookmark List.</p>

<h1>52</h1><h1>NIP-52</h1>
<h2>Calendar Events</h2>
<p><code>draft</code> <code>optional</code> <code>author:tyiu</code></p>
<p>This specification defines calendar events representing an occurrence at a specific moment or between moments. These calendar events are <em>parameterized replaceable</em> and deletable per <a href="09.md">NIP-09</a>.</p>
<p>Unlike the term <code>calendar event</code> specific to this NIP, the term <code>event</code> is used broadly in all the NIPs to describe any Nostr event. The distinction is being made here to discern between the two terms.</p>
<h2>Calendar Events</h2>
<p>There are two types of calendar events represented by different kinds: date-based and time-based calendar events. Calendar events are not required to be part of a <a href="#calendar">calendar</a>.</p>
<h3>Date-Based Calendar Event</h3>
<p>This kind of calendar event starts on a date and ends before a different date in the future. Its use is appropriate for all-day or multi-day events where time and time zone hold no significance. e.g., anniversary, public holidays, vacation days.</p>
<h4>Format</h4>
<p>The format uses a parameterized replaceable event kind <code>31922</code>.</p>
<p>The <code>.content</code> of these events is optional and should be a detailed description of the calendar event.</p>
<p>The list of tags are as follows:</p>
<ul>
<li><code>d</code> (required) universally unique identifier (UUID). Generated by the client creating the calendar event.</li>
<li><code>name</code> (required) name of the calendar event</li>
<li><code>start</code> (required) inclusive start date in ISO 8601 format (YYYY-MM-DD). Must be less than <code>end</code>, if it exists.</li>
<li><code>end</code> (optional) exclusive end date in ISO 8601 format (YYYY-MM-DD). If omitted, the calendar event ends on the same date as <code>start</code>.</li>
<li><code>location</code> (optional) location of the calendar event. e.g. address, GPS coordinates, meeting room name, link to video call</li>
<li><code>g</code> (optional) <a href="https://en.wikipedia.org/wiki/Geohash">geohash</a> to associate calendar event with a searchable physical location</li>
<li><code>p</code> (optional, repeated) 32-bytes hex pubkey of a participant, optional recommended relay URL, and participant's role in the meeting</li>
<li><code>t</code> (optional, repeated) hashtag to categorize calendar event</li>
<li><code>r</code> (optional, repeated) references / links to web pages, documents, video calls, recorded videos, etc.</li>
</ul>
<pre><code class="language-json">{
  &quot;id&quot;: &lt;32-bytes lowercase hex-encoded SHA-256 of the the serialized event data&gt;,
  &quot;pubkey&quot;: &lt;32-bytes lowercase hex-encoded public key of the event creator&gt;,
  &quot;created_at&quot;: &lt;Unix timestamp in seconds&gt;,
  &quot;kind&quot;: &quot;31922&quot;,
  &quot;content&quot;: &quot;&lt;description of calendar event&gt;&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;&lt;UUID&gt;&quot;],

    [&quot;name&quot;, &quot;&lt;name of calendar event&gt;&quot;],

    // Dates
    [&quot;start&quot;, &quot;&lt;YYYY-MM-DD&gt;&quot;],
    [&quot;end&quot;, &quot;&lt;YYYY-MM-DD&gt;&quot;],

    // Location
    [&quot;location&quot;, &quot;&lt;location&gt;&quot;],
    [&quot;g&quot;, &quot;&lt;geohash&gt;&quot;],

    // Participants
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;&lt;role&gt;&quot;],
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;&lt;role&gt;&quot;],

    // Hashtags
    [&quot;t&quot;, &quot;&lt;tag&gt;&quot;],
    [&quot;t&quot;, &quot;&lt;tag&gt;&quot;],

    // Reference links
    [&quot;r&quot;, &quot;&lt;url&gt;&quot;],
    [&quot;r&quot;, &quot;&lt;url&gt;&quot;]
  ]
}
</code></pre>
<h3>Time-Based Calendar Event</h3>
<p>This kind of calendar event spans between a start time and end time.</p>
<h4>Format</h4>
<p>The format uses a parameterized replaceable event kind <code>31923</code>.</p>
<p>The <code>.content</code> of these events is optional and should be a detailed description of the calendar event.</p>
<p>The list of tags are as follows:</p>
<ul>
<li><code>d</code> (required) universally unique identifier (UUID). Generated by the client creating the calendar event.</li>
<li><code>name</code> (required) name of the calendar event</li>
<li><code>start</code> (required) inclusive start Unix timestamp in seconds. Must be less than <code>end</code>, if it exists.</li>
<li><code>end</code> (optional) exclusive end Unix timestamp in seconds. If omitted, the calendar event ends instantaneously.</li>
<li><code>start_tzid</code> (optional) time zone of the start timestamp, as defined by the IANA Time Zone Database. e.g., <code>America/Costa_Rica</code></li>
<li><code>end_tzid</code> (optional) time zone of the end timestamp, as defined by the IANA Time Zone Database. e.g., <code>America/Costa_Rica</code>. If omitted and <code>start_tzid</code> is provided, the time zone of the end timestamp is the same as the start timestamp.</li>
<li><code>location</code> (optional) location of the calendar event. e.g. address, GPS coordinates, meeting room name, link to video call</li>
<li><code>g</code> (optional) <a href="https://en.wikipedia.org/wiki/Geohash">geohash</a> to associate calendar event with a searchable physical location</li>
<li><code>p</code> (optional, repeated) 32-bytes hex pubkey of a participant, optional recommended relay URL, and participant's role in the meeting</li>
<li><code>t</code> (optional, repeated) hashtag to categorize calendar event</li>
<li><code>r</code> (optional, repeated) references / links to web pages, documents, video calls, recorded videos, etc.</li>
</ul>
<pre><code class="language-json">{
  &quot;id&quot;: &lt;32-bytes lowercase hex-encoded SHA-256 of the the serialized event data&gt;,
  &quot;pubkey&quot;: &lt;32-bytes lowercase hex-encoded public key of the event creator&gt;,
  &quot;created_at&quot;: &lt;Unix timestamp in seconds&gt;,
  &quot;kind&quot;: &quot;31923&quot;,
  &quot;content&quot;: &quot;&lt;description of calendar event&gt;&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;&lt;UUID&gt;&quot;],

    [&quot;name&quot;, &quot;&lt;name of calendar event&gt;&quot;],

    // Timestamps
    [&quot;start&quot;, &quot;&lt;Unix timestamp in seconds&gt;&quot;],
    [&quot;end&quot;, &quot;&lt;Unix timestamp in seconds&gt;&quot;],

    [&quot;start_tzid&quot;, &quot;&lt;IANA Time Zone Database identifier&gt;&quot;],
    [&quot;end_tzid&quot;, &quot;&lt;IANA Time Zone Database identifier&gt;&quot;],

    // Location
    [&quot;location&quot;, &quot;&lt;location&gt;&quot;],
    [&quot;g&quot;, &quot;&lt;geohash&gt;&quot;],

    // Participants
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;&lt;role&gt;&quot;],
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;&lt;role&gt;&quot;],

    // Hashtags
    [&quot;t&quot;, &quot;&lt;tag&gt;&quot;],
    [&quot;t&quot;, &quot;&lt;tag&gt;&quot;],

    // Reference links
    [&quot;r&quot;, &quot;&lt;url&gt;&quot;],
    [&quot;r&quot;, &quot;&lt;url&gt;&quot;]
  ]
}
</code></pre>
<h2>Calendar</h2>
<p>A calendar is a collection of calendar events, represented as a custom replaceable list event using kind <code>31924</code>. A user can have multiple calendars. One may create a calendar to segment calendar events for specific purposes. e.g., personal, work, travel, meetups, and conferences.</p>
<h3>Format</h3>
<p>The format uses a custom replaceable list of kind <code>31924</code> with a list of tags as described below:</p>
<ul>
<li><code>d</code> (required) calendar name</li>
<li><code>a</code> (repeated) reference tag to kind <code>31922</code> or <code>31923</code> calendar event being responded to</li>
</ul>
<pre><code class="language-json">{
  &quot;kind&quot;: 31924,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;&lt;calendar name&gt;&quot;],
    [&quot;a&quot;, &quot;&lt;31922 or 31923&gt;:&lt;calendar event author pubkey&gt;:&lt;d-identifier of calendar event&gt;&quot;, &quot;&lt;optional relay url&gt;&quot;],
    [&quot;a&quot;, &quot;&lt;31922 or 31923&gt;:&lt;calendar event author pubkey&gt;:&lt;d-identifier of calendar event&gt;&quot;, &quot;&lt;optional relay url&gt;&quot;]
  ]
}
</code></pre>
<h2>Calendar Event RSVP</h2>
<p>A calendar event RSVP is a response to a calendar event to indicate a user's attendance intention.</p>
<p>If a calendar event tags a pubkey, that can be interpreted as the calendar event creator inviting that user to attend. Clients MAY choose to prompt the user to RSVP for the calendar event.</p>
<p>Any user may RSVP, even if they were not tagged on the calendar event. Clients MAY choose to prompt the calendar event creator to invite the user who RSVP'd. Clients also MAY choose to ignore these RSVPs.</p>
<p>This NIP is intentionally not defining who is authorized to attend a calendar event if the user who RSVP'd has not been tagged. It is up to the calendar event creator to determine the semantics.</p>
<p>This NIP is also intentionally not defining what happens if a calendar event changes after an RSVP is submitted.</p>
<h3>Format</h3>
<p>The format uses a parameterized replaceable event kind <code>31925</code>.</p>
<p>The <code>.content</code> of these events is optional and should be a free-form note that adds more context to this calendar event response.</p>
<p>The list of tags are as follows:</p>
<ul>
<li><code>a</code> (required) reference tag to kind <code>31922</code> or <code>31923</code> calendar event being responded to.</li>
<li><code>d</code> (required) universally unique identifier. Generated by the client creating the calendar event RSVP.</li>
<li><code>L</code> (required) label namespace of <code>status</code> per <a href="32.md">NIP-32</a></li>
<li><code>l</code> (required) label of <code>accepted</code>, <code>declined</code>, or <code>tentative</code> under the label namespace of <code>status</code> per <a href="32.md">NIP-32</a>. Determines attendance status to the referenced calendar event.</li>
<li><code>L</code> (optional) label namespace of <code>freebusy</code> per <a href="32.md">NIP-32</a>. Exists if and only if corresponding <code>l</code> tag under the same label namespace exists.</li>
<li><code>l</code> (optional) label of <code>free</code> or <code>busy</code> under the label namespace of <code>freebusy</code> per <a href="32.md">NIP-32</a>. Determines if the user would be free or busy for the duration of the calendar event. This tag must be omitted or ignored if the <code>status</code> label is set to <code>declined</code>. Exists if and only if corresponding <code>l</code> tag under the same label namespace exists.</li>
</ul>
<pre><code class="language-json">{
  &quot;id&quot;: &lt;32-bytes lowercase hex-encoded SHA-256 of the the serialized event data&gt;,
  &quot;pubkey&quot;: &lt;32-bytes lowercase hex-encoded public key of the event creator&gt;,
  &quot;created_at&quot;: &lt;Unix timestamp in seconds&gt;,
  &quot;kind&quot;: &quot;31925&quot;,
  &quot;content&quot;: &quot;&lt;note&gt;&quot;,
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;&lt;31922 or 31923&gt;:&lt;calendar event author pubkey&gt;:&lt;d-identifier of calendar event&gt;&quot;, &quot;&lt;optional relay url&gt;&quot;],
    [&quot;d&quot;, &quot;&lt;UUID&gt;&quot;],
    [&quot;L&quot;, &quot;status&quot;],
    [&quot;l&quot;, &quot;&lt;accepted/declined/tentative&gt;&quot;, &quot;status&quot;],
    [&quot;L&quot;, &quot;freebusy&quot;],
    [&quot;l&quot;, &quot;&lt;free/busy&gt;&quot;, &quot;freebusy&quot;]
  ]
}
</code></pre>
<h2>Unsolved Limitations</h2>
<ul>
<li>No private events</li>
</ul>
<h2>Intentionally Unsupported Scenarios</h2>
<h3>Recurring Calendar Events</h3>
<p>Recurring calendar events come with a lot of complexity, making it difficult for software and humans to deal with. This complexity includes time zone differences between invitees, daylight savings, leap years, multiple calendar systems, one-off changes in schedule or other metadata, etc.</p>
<p>This NIP intentionally omits support for recurring calendar events and pushes that complexity up to clients to manually implement if they desire. i.e., individual calendar events with duplicated metadata represent recurring calendar events.</p>

<h1>53</h1><h1>NIP-53</h1>
<h2>Live Activities</h2>
<p><code>draft</code> <code>optional</code> <code>author:vitorpamplona</code> <code>author:v0l</code></p>
<h2>Abstract</h2>
<p>Service providers want to offer live activities to the Nostr network in such a way that participants can easily logged and queried by clients. This NIP describes a general framework to advertise the involvement of pubkeys in such live activities.</p>
<h1>Live Event</h1>
<p>A special event with <code>kind:30311</code> &quot;Live Event&quot; is defined as a <em>parameterized replaceable event</em> of public <code>p</code> tags. Each <code>p</code> tag SHOULD have a <strong>displayable</strong> marker name for the current role (e.g. <code>Host</code>, <code>Speaker</code>, <code>Participant</code>) of the user in the event and the relay information MAY be empty. This event will be constantly updated as participants join and leave the activity.</p>
<p>For example:</p>
<pre><code class="language-js">{
  &quot;kind&quot;: 30311,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;&lt;unique identifier&gt;&quot;],
    [&quot;title&quot;, &quot;&lt;name of the event&gt;&quot;],
    [&quot;summary&quot;, &quot;&lt;description&gt;&quot;],
    [&quot;image&quot;, &quot;&lt;preview image url&gt;&quot;],
    [&quot;t&quot;, &quot;hashtag&quot;]
    [&quot;streaming&quot;, &quot;&lt;url&gt;&quot;],
    [&quot;recording&quot;, &quot;&lt;url&gt;&quot;], // used to place the edited video once the activity is over
    [&quot;starts&quot;, &quot;&lt;unix timestamp in seconds&gt;&quot;],
    [&quot;ends&quot;, &quot;&lt;unix timestamp in seconds&gt;&quot;],
    [&quot;status&quot;, &quot;&lt;planned, live, ended&gt;&quot;],
    [&quot;current_participants&quot;, &quot;&lt;number&gt;&quot;],
    [&quot;total_participants&quot;, &quot;&lt;number&gt;&quot;],
    [&quot;p&quot;, &quot;91cf9..4e5ca&quot;, &quot;wss://provider1.com/&quot;, &quot;Host&quot;, &quot;&lt;proof&gt;&quot;],
    [&quot;p&quot;, &quot;14aeb..8dad4&quot;, &quot;wss://provider2.com/nostr&quot;, &quot;Speaker&quot;],
    [&quot;p&quot;, &quot;612ae..e610f&quot;, &quot;ws://provider3.com/ws&quot;, &quot;Participant&quot;],
    [&quot;relays&quot;, &quot;wss://one.com&quot;, &quot;wss://two.com&quot;, ...]
  ],
  &quot;content&quot;: &quot;&quot;,
  ...other fields
}
</code></pre>
<p>A distinct <code>d</code> tag should be used for each activity. All other tags are optional.</p>
<p>Providers SHOULD keep the participant list small (e.g. under 1000 users) and, when limits are reached, Providers SHOULD select which participants get named in the event. Clients should not expect a comprehensive list. Once the activity ends, the event can be deleted or updated to summarize the activity and provide async content (e.g. recording of the event).</p>
<p>Clients are expected to subscribe to <code>kind:30311</code> events in general or for given follow lists and statuses. Clients MAY display participants' roles in activities as well as access points to join the activity.</p>
<p>Live Activity management clients are expected to constantly update <code>kind:30311</code> during the event. Clients MAY choose to consider <code>status=live</code> events after 1hr without any update as <code>ended</code>. The <code>starts</code> and <code>ends</code> timestamp SHOULD be updated when the status changes to and from <code>live</code></p>
<p>The activity MUST be linked to using the <a href="19.md">NIP-19</a> <code>naddr</code> code along with the <code>a</code> tag.</p>
<h2>Proof of Agreement to Participate</h2>
<p>Event owners can add proof as the 5th term in each <code>p</code> tag to clarify the participant's agreement in joining the event. The proof is a signed SHA256 of the complete <code>a</code> Tag of the event (<code>kind:pubkey:dTag</code>) by each <code>p</code>'s private key, encoded in hex.</p>
<p>Clients MAY only display participants if the proof is available or MAY display participants as &quot;invited&quot; if the proof is not available.</p>
<p>This feature is important to avoid malicious event owners adding large account holders to the event, without their knowledge, to lure their followers into the malicious owner's trap.</p>
<h1>Live Chat Message</h1>
<p>Event <code>kind:1311</code> is live chat's channel message. Clients MUST include the <code>a</code> tag of the activity with a <code>root</code> marker. Other Kind-1 tags such as <code>reply</code> and <code>mention</code> can also be used.</p>
<pre><code class="language-js">{
  &quot;id&quot;: &quot;&lt;32-bytes lowercase hex-encoded SHA-256 of the the serialized event data&gt;&quot;,
  &quot;pubkey&quot;: &quot;&lt;32-bytes lowercase hex-encoded public key of the event creator&gt;&quot;,
  &quot;created_at&quot;: &quot;&lt;Unix timestamp in seconds&gt;&quot;,
  &quot;kind&quot;: 1311,
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;30311:&lt;Community event author pubkey&gt;:&lt;d-identifier of the community&gt;&quot;, &quot;&lt;Optional relay url&gt;&quot;, &quot;root&quot;],
  ],
  &quot;content&quot;: &quot;Zaps to live streams is beautiful.&quot;
}
</code></pre>
<h1>Use Cases</h1>
<p>Common use cases include meeting rooms/workshops, watch-together activities, or event spaces, such as <a href="https://live.snort.social">live.snort.social</a> and <a href="https://nostrnests.com">nostrnests.com</a>.</p>
<h1>Example</h1>
<p>Live Streaming</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;57f28dbc264990e2c61e80a883862f7c114019804208b14da0bff81371e484d2&quot;,
  &quot;pubkey&quot;: &quot;1597246ac22f7d1375041054f2a4986bd971d8d196d7997e48973263ac9879ec&quot;,
  &quot;created_at&quot;: 1687182672,
  &quot;kind&quot;: 30311,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;demo-cf-stream&quot;],
    [&quot;title&quot;, &quot;Adult Swim Metalocalypse&quot;],
    [&quot;summary&quot;, &quot;Live stream from IPTV-ORG collection&quot;],
    [&quot;streaming&quot;, &quot;https://adultswim-vodlive.cdn.turner.com/live/metalocalypse/stream.m3u8&quot;],
	[&quot;starts&quot;, &quot;1687182672&quot;]
    [&quot;status&quot;, &quot;live&quot;],
    [&quot;t&quot;, &quot;animation&quot;],
    [&quot;t&quot;, &quot;iptv&quot;],
    [&quot;image&quot;, &quot;https://i.imgur.com/CaKq6Mt.png&quot;]
  ],
  &quot;content&quot;: &quot;&quot;,
  &quot;sig&quot;: &quot;5bc7a60f5688effa5287244a24768cbe0dcd854436090abc3bef172f7f5db1410af4277508dbafc4f70a754a891c90ce3b966a7bc47e7c1eb71ff57640f3d389&quot;
}
</code></pre>
<p>Live Streaming chat message</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;97aa81798ee6c5637f7b21a411f89e10244e195aa91cb341bf49f718e36c8188&quot;,
  &quot;pubkey&quot;: &quot;3f770d65d3a764a9c5cb503ae123e62ec7598ad035d836e2a810f3877a745b24&quot;,
  &quot;created_at&quot;: 1687286726,
  &quot;kind&quot;: 1311,
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;30311:1597246ac22f7d1375041054f2a4986bd971d8d196d7997e48973263ac9879ec:demo-cf-stream&quot;, &quot;&quot;, &quot;root&quot;]
  ],
  &quot;content&quot;: &quot;Zaps to live streams is beautiful.&quot;,
  &quot;sig&quot;: &quot;997f62ddfc0827c121043074d50cfce7a528e978c575722748629a4137c45b75bdbc84170bedc723ef0a5a4c3daebf1fef2e93f5e2ddb98e5d685d022c30b622&quot;
}
</code></pre>

<h1>56</h1><h1>NIP-56</h1>
<h2>Reporting</h2>
<p><code>draft</code> <code>optional</code> <code>author:jb55</code></p>
<p>A report is a <code>kind 1984</code> note that is used to report other notes for spam,
illegal and explicit content.</p>
<p>The <code>content</code> MAY contain additional information submitted by the entity
reporting the content.</p>
<h2>Tags</h2>
<p>The report event MUST include a <code>p</code> tag referencing the pubkey of the user you
are reporting.</p>
<p>If reporting a note, an <code>e</code> tag MUST also be included referencing the note id.</p>
<p>A <code>report type</code> string MUST be included as the 3rd entry to the <code>e</code> or <code>p</code> tag
being reported, which consists of the following report types:</p>
<ul>
<li><code>nudity</code> - depictions of nudity, porn, etc.</li>
<li><code>profanity</code> - profanity, hateful speech, etc.</li>
<li><code>illegal</code> - something which may be illegal in some jurisdiction</li>
<li><code>spam</code> - spam</li>
<li><code>impersonation</code> - someone pretending to be someone else</li>
</ul>
<p>Some report tags only make sense for profile reports, such as <code>impersonation</code></p>
<p><code>l</code> and <code>L</code> tags MAY be also be used as defined in <a href="32.md">NIP-32</a> to support
further qualification and querying.</p>
<h2>Example events</h2>
<pre><code class="language-json">{
  &quot;kind&quot;: 1984,
  &quot;tags&quot;: [
    [&quot;p&quot;, &lt;pubkey&gt;, &quot;nudity&quot;],
    [&quot;L&quot;, &quot;social.nos.ontology&quot;],
    [&quot;l&quot;, &quot;NS-nud&quot;, &quot;social.nos.ontology&quot;]
  ],
  &quot;content&quot;: &quot;&quot;,
  ...
}

{
  &quot;kind&quot;: 1984,
  &quot;tags&quot;: [
    [&quot;e&quot;, &lt;eventId&gt;, &quot;illegal&quot;],
    [&quot;p&quot;, &lt;pubkey&gt;]
  ],
  &quot;content&quot;: &quot;He's insulting the king!&quot;,
  ...
}

{
  &quot;kind&quot;: 1984,
  &quot;tags&quot;: [
    [&quot;p&quot;, &lt;impersonator pubkey&gt;, &quot;impersonation&quot;]
  ],
  &quot;content&quot;: &quot;Profile is impersonating nostr:&lt;victim bech32 pubkey&gt;&quot;,
  ...
}
</code></pre>
<h2>Client behavior</h2>
<p>Clients can use reports from friends to make moderation decisions if they
choose to. For instance, if 3+ of your friends report a profile for <code>nudity</code>,
clients can have an option to automatically blur photos from said account.</p>
<h2>Relay behavior</h2>
<p>It is not recommended that relays perform automatic moderation using reports,
as they can be easily gamed. Admins could use reports from trusted moderators to
takedown illegal or explicit content if the relay does not allow such things.</p>

<h1>57</h1><h1>NIP-57</h1>
<h2>Lightning Zaps</h2>
<p><code>draft</code> <code>optional</code> <code>author:jb55</code> <code>author:kieran</code></p>
<p>This NIP defines two new event types for recording lightning payments between users. <code>9734</code> is a <code>zap request</code>, representing a payer's request to a recipient's lightning wallet for an invoice. <code>9735</code> is a <code>zap receipt</code>, representing the confirmation by the recipient's lightning wallet that the invoice issued in response to a <code>zap request</code> has been paid.</p>
<p>Having lightning receipts on nostr allows clients to display lightning payments from entities on the network. These can be used for fun or for spam deterrence.</p>
<h2>Protocol flow</h2>
<ol>
<li>Client calculates a recipient's lnurl pay request url from the <code>zap</code> tag on the event being zapped (see Appendix G), or by decoding their lud06 or lud16 field on their profile according to the <a href="https://github.com/lnurl/luds">lnurl specifications</a>. The client MUST send a GET request to this url and parse the response. If <code>allowsNostr</code> exists and it is <code>true</code>, and if <code>nostrPubkey</code> exists and is a valid BIP 340 public key in hex, the client should associate this information with the user, along with the response's <code>callback</code>, <code>minSendable</code>, and <code>maxSendable</code> values.</li>
<li>Clients may choose to display a lightning zap button on each post or on a user's profile. If the user's lnurl pay request endpoint supports nostr, the client SHOULD use this NIP to request a <code>zap receipt</code> rather than a normal lnurl invoice.</li>
<li>When a user (the &quot;sender&quot;) indicates they want to send a zap to another user (the &quot;recipient&quot;), the client should create a <code>zap request</code> event as described in Appendix A of this NIP and sign it.</li>
<li>Instead of publishing the <code>zap request</code>, the <code>9734</code> event should instead be sent to the <code>callback</code> url received from the lnurl pay endpoint for the recipient using a GET request. See Appendix B for details and an example.</li>
<li>The recipient's lnurl server will receive this <code>zap request</code> and validate it. See Appendix C for details on how to properly configure an lnurl server to support zaps, and Appendix D for details on how to validate the <code>nostr</code> query parameter.</li>
<li>If the <code>zap request</code> is valid, the server should fetch a description hash invoice where the description is this <code>zap request</code> note and this note only. No additional lnurl metadata is included in the description. This will be returned in the response according to <a href="https://github.com/lnurl/luds/blob/luds/06.md">LUD06</a>.</li>
<li>On receiving the invoice, the client MAY pay it or pass it to an app that can pay the invoice.</li>
<li>Once the invoice is paid, the recipient's lnurl server MUST generate a <code>zap receipt</code> as described in Appendix E, and publish it to the <code>relays</code> specified in the <code>zap request</code>.</li>
<li>Clients MAY fetch <code>zap receipt</code>s on posts and profiles, but MUST authorize their validity as described in Appendix F. If the <code>zap request</code> note contains a non-empty <code>content</code>, it may display a zap comment. Generally clients should show users the <code>zap request</code> note, and use the <code>zap receipt</code> to show &quot;zap authorized by ...&quot; but this is optional.</li>
</ol>
<h2>Reference and examples</h2>
<h3>Appendix A: Zap Request Event</h3>
<p>A <code>zap request</code> is an event of kind <code>9734</code> that is <em>not</em> published to relays, but is instead sent to a recipient's lnurl pay <code>callback</code> url. This event's <code>content</code> MAY be an optional message to send along with the payment. The event MUST include the following tags:</p>
<ul>
<li><code>relays</code> is a list of relays the recipient's wallet should publish its <code>zap receipt</code> to. Note that relays should not be nested in an additional list, but should be included as shown in the example below.</li>
<li><code>amount</code> is the amount in <em>millisats</em> the sender intends to pay, formatted as a string. This is recommended, but optional.</li>
<li><code>lnurl</code> is the lnurl pay url of the recipient, encoded using bech32 with the prefix <code>lnurl</code>. This is recommended, but optional.</li>
<li><code>p</code> is the hex-encoded pubkey of the recipient.</li>
</ul>
<p>In addition, the event MAY include the following tags:</p>
<ul>
<li><code>e</code> is an optional hex-encoded event id. Clients MUST include this if zapping an event rather than a person.</li>
<li><code>a</code> is an optional NIP-33 event coordinate that allows tipping parameterized replaceable events such as NIP-23 long-form notes.</li>
</ul>
<p>Example:</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 9734,
  &quot;content&quot;: &quot;Zap!&quot;,
  &quot;tags&quot;: [
    [&quot;relays&quot;, &quot;wss://nostr-pub.wellorder.com&quot;, &quot;wss://anotherrelay.example.com&quot;],
    [&quot;amount&quot;, &quot;21000&quot;],
    [&quot;lnurl&quot;, &quot;lnurl1dp68gurn8ghj7um5v93kketj9ehx2amn9uh8wetvdskkkmn0wahz7mrww4excup0dajx2mrv92x9xp&quot;],
    [&quot;p&quot;, &quot;04c915daefee38317fa734444acee390a8269fe5810b2241e5e6dd343dfbecc9&quot;],
    [&quot;e&quot;, &quot;9ae37aa68f48645127299e9453eb5d908a0cbb6058ff340d528ed4d37c8994fb&quot;]
  ],
  &quot;pubkey&quot;: &quot;97c70a44366a6535c145b333f973ea86dfdc2d7a99da618c40c64705ad98e322&quot;,
  &quot;created_at&quot;: 1679673265,
  &quot;id&quot;: &quot;30efed56a035b2549fcaeec0bf2c1595f9a9b3bb4b1a38abaf8ee9041c4b7d93&quot;,
  &quot;sig&quot;: &quot;f2cb581a84ed10e4dc84937bd98e27acac71ab057255f6aa8dfa561808c981fe8870f4a03c1e3666784d82a9c802d3704e174371aa13d63e2aeaf24ff5374d9d&quot;
}
</code></pre>
<h3>Appendix B: Zap Request HTTP Request</h3>
<p>A signed <code>zap request</code> event is not published, but is instead sent using a HTTP GET request to the recipient's <code>callback</code> url, which was provided by the recipient's lnurl pay endpoint. This request should have the following query parameters defined:</p>
<ul>
<li><code>amount</code> is the amount in <em>millisats</em> the sender intends to pay</li>
<li><code>nostr</code> is the <code>9734</code> <code>zap request</code> event, JSON encoded then URI encoded</li>
<li><code>lnurl</code> is the lnurl pay url of the recipient, encoded using bech32 with the prefix <code>lnurl</code></li>
</ul>
<p>This request should return a JSON response with a <code>pr</code> key, which is the invoice the sender must pay to finalize his zap. Here is an example flow in javascript:</p>
<pre><code class="language-javascript">const senderPubkey // The sender's pubkey
const recipientPubkey = // The recipient's pubkey
const callback = // The callback received from the recipients lnurl pay endpoint
const lnurl = // The recipient's lightning address, encoded as a lnurl
const sats = 21

const amount = sats * 1000
const relays = ['wss://nostr-pub.wellorder.net']
const event = encodeURI(JSON.stringify(await signEvent({
  kind: 9734,
  content: &quot;&quot;,
  pubkey: senderPubkey,
  created_at: Math.round(Date.now() / 1000),
  tags: [
    [&quot;relays&quot;, ...relays],
    [&quot;amount&quot;, amount.toString()],
    [&quot;lnurl&quot;, lnurl],
    [&quot;p&quot;, recipientPubkey],
  ],
})))

const {pr: invoice} = await fetchJson(`${callback}?amount=${amount}&amp;nostr=${event}&amp;lnurl=${lnurl}`)
</code></pre>
<h3>Appendix C: LNURL Server Configuration</h3>
<p>The lnurl server will need some additional pieces of information so that clients can know that zap invoices are supported:</p>
<ol>
<li>Add a <code>nostrPubkey</code> to the lnurl-pay static endpoint <code>/.well-known/lnurlp/&lt;user&gt;</code>, where <code>nostrPubkey</code> is the nostr pubkey your server will use to sign <code>zap receipt</code> events. Clients will use this to validate <code>zap receipt</code>s.</li>
<li>Add an <code>allowsNostr</code> field and set it to true.</li>
</ol>
<h3>Appendix D: LNURL Server Zap Request Validation</h3>
<p>When a client sends a <code>zap request</code> event to a server's lnurl-pay callback URL, there will be a <code>nostr</code> query parameter whose value is that event which is URI- and JSON-encoded. If present, the <code>zap request</code> event must be validated in the following ways:</p>
<ol>
<li>It MUST have a valid nostr signature</li>
<li>It MUST have tags</li>
<li>It MUST have only one <code>p</code> tag</li>
<li>It MUST have 0 or 1 <code>e</code> tags</li>
<li>There should be a <code>relays</code> tag with the relays to send the <code>zap receipt</code> to.</li>
<li>If there is an <code>amount</code> tag, it MUST be equal to the <code>amount</code> query parameter.</li>
<li>If there is an <code>a</code> tag, it MUST be a valid NIP-33 event coordinate</li>
</ol>
<p>The event MUST then be stored for use later, when the invoice is paid.</p>
<h3>Appendix E: Zap Receipt Event</h3>
<p>A <code>zap receipt</code> is created by a lightning node when an invoice generated by a <code>zap request</code> is paid. <code>Zap receipt</code>s are only created when the invoice description (committed to the description hash) contains a <code>zap request</code> note.</p>
<p>When receiving a payment, the following steps are executed:</p>
<ol>
<li>Get the description for the invoice. This needs to be saved somewhere during the generation of the description hash invoice. It is saved automatically for you with CLN, which is the reference implementation used here.</li>
<li>Parse the bolt11 description as a JSON nostr event. This SHOULD be validated based on the requirements in Appendix D, either when it is received, or before the invoice is paid.</li>
<li>Create a nostr event of kind <code>9735</code> as described below, and publish it to the <code>relays</code> declared in the <code>zap request</code>.</li>
</ol>
<p>The following should be true of the <code>zap receipt</code> event:</p>
<ul>
<li>The <code>content</code> SHOULD be empty.</li>
<li>The <code>created_at</code> date SHOULD be set to the invoice <code>paid_at</code> date for idempotency.</li>
<li><code>tags</code> MUST include the <code>p</code> tag AND optional <code>e</code> tag from the <code>zap request</code> AND optional <code>a</code> tag from the <code>zap request</code>.</li>
<li>The <code>zap receipt</code> MUST have a <code>bolt11</code> tag containing the description hash bolt11 invoice.</li>
<li>The <code>zap receipt</code> MUST contain a <code>description</code> tag which is the JSON-encoded invoice description.</li>
<li><code>SHA256(description)</code> MUST match the description hash in the bolt11 invoice.</li>
<li>The <code>zap receipt</code> MAY contain a <code>preimage</code> tag to match against the payment hash of the bolt11 invoice. This isn't really a payment proof, there is no real way to prove that the invoice is real or has been paid. You are trusting the author of the <code>zap receipt</code> for the legitimacy of the payment.</li>
</ul>
<p>The <code>zap receipt</code> is not a proof of payment, all it proves is that some nostr user fetched an invoice. The existence of the <code>zap receipt</code> implies the invoice as paid, but it could be a lie given a rogue implementation.</p>
<p>A reference implementation for a zap-enabled lnurl server can be found <a href="https://github.com/jb55/cln-nostr-zapper">here</a>.</p>
<p>Example <code>zap receipt</code>:</p>
<pre><code class="language-json">{
    &quot;id&quot;: &quot;67b48a14fb66c60c8f9070bdeb37afdfcc3d08ad01989460448e4081eddda446&quot;,
    &quot;pubkey&quot;: &quot;9630f464cca6a5147aa8a35f0bcdd3ce485324e732fd39e09233b1d848238f31&quot;,
    &quot;created_at&quot;: 1674164545,
    &quot;kind&quot;: 9735,
    &quot;tags&quot;: [
      [&quot;p&quot;, &quot;32e1827635450ebb3c5a7d12c1f8e7b2b514439ac10a67eef3d9fd9c5c68e245&quot;],
      [&quot;e&quot;, &quot;3624762a1274dd9636e0c552b53086d70bc88c165bc4dc0f9e836a1eaf86c3b8&quot;],
      [&quot;bolt11&quot;, &quot;lnbc10u1p3unwfusp5t9r3yymhpfqculx78u027lxspgxcr2n2987mx2j55nnfs95nxnzqpp5jmrh92pfld78spqs78v9euf2385t83uvpwk9ldrlvf6ch7tpascqhp5zvkrmemgth3tufcvflmzjzfvjt023nazlhljz2n9hattj4f8jq8qxqyjw5qcqpjrzjqtc4fc44feggv7065fqe5m4ytjarg3repr5j9el35xhmtfexc42yczarjuqqfzqqqqqqqqlgqqqqqqgq9q9qxpqysgq079nkq507a5tw7xgttmj4u990j7wfggtrasah5gd4ywfr2pjcn29383tphp4t48gquelz9z78p4cq7ml3nrrphw5w6eckhjwmhezhnqpy6gyf0&quot;],
      [&quot;description&quot;, &quot;{\&quot;pubkey\&quot;:\&quot;32e1827635450ebb3c5a7d12c1f8e7b2b514439ac10a67eef3d9fd9c5c68e245\&quot;,\&quot;content\&quot;:\&quot;\&quot;,\&quot;id\&quot;:\&quot;d9cc14d50fcb8c27539aacf776882942c1a11ea4472f8cdec1dea82fab66279d\&quot;,\&quot;created_at\&quot;:1674164539,\&quot;sig\&quot;:\&quot;77127f636577e9029276be060332ea565deaf89ff215a494ccff16ae3f757065e2bc59b2e8c113dd407917a010b3abd36c8d7ad84c0e3ab7dab3a0b0caa9835d\&quot;,\&quot;kind\&quot;:9734,\&quot;tags\&quot;:[[\&quot;e\&quot;,\&quot;3624762a1274dd9636e0c552b53086d70bc88c165bc4dc0f9e836a1eaf86c3b8\&quot;],[\&quot;p\&quot;,\&quot;32e1827635450ebb3c5a7d12c1f8e7b2b514439ac10a67eef3d9fd9c5c68e245\&quot;],[\&quot;relays\&quot;,\&quot;wss://relay.damus.io\&quot;,\&quot;wss://nostr-relay.wlvs.space\&quot;,\&quot;wss://nostr.fmt.wiz.biz\&quot;,\&quot;wss://relay.nostr.bg\&quot;,\&quot;wss://nostr.oxtr.dev\&quot;,\&quot;wss://nostr.v0l.io\&quot;,\&quot;wss://brb.io\&quot;,\&quot;wss://nostr.bitcoiner.social\&quot;,\&quot;ws://monad.jb55.com:8080\&quot;,\&quot;wss://relay.snort.social\&quot;]]}&quot;],
      [&quot;preimage&quot;, &quot;5d006d2cf1e73c7148e7519a4c68adc81642ce0e25a432b2434c99f97344c15f&quot;]
    ],
    &quot;content&quot;: &quot;&quot;,
    &quot;sig&quot;: &quot;b0a3c5c984ceb777ac455b2f659505df51585d5fd97a0ec1fdb5f3347d392080d4b420240434a3afd909207195dac1e2f7e3df26ba862a45afd8bfe101c2b1cc&quot;
  }
</code></pre>
<h3>Appendix F: Validating Zap Receipts</h3>
<p>A client can retrieve <code>zap receipt</code>s on events and pubkeys using a NIP-01 filter, for example <code>{&quot;kinds&quot;: [9735], &quot;#e&quot;: [...]}</code>. Zaps MUST be validated using the following steps:</p>
<ul>
<li>The <code>zap receipt</code> event's <code>pubkey</code> MUST be the same as the recipient's lnurl provider's <code>nostrPubkey</code> (retrieved in step 1 of the protocol flow).</li>
<li>The <code>invoiceAmount</code> contained in the <code>bolt11</code> tag of the <code>zap receipt</code> MUST equal the <code>amount</code> tag of the <code>zap request</code> (if present).</li>
<li>The <code>lnurl</code> tag of the <code>zap request</code> (if present) SHOULD equal the recipient's <code>lnurl</code>.</li>
</ul>
<h3>Appendix G: <code>zap</code> tag on other events</h3>
<p>When an event includes one or more <code>zap</code> tags, clients wishing to zap it SHOULD calculate the lnurl pay request based on the tags value instead of the event author's profile field. The tag's second argument is the <code>hex</code> string of the receiver's pub key and the third argument is the relay to download the receiver's metadata (Kind-0). An optional fourth parameter specifies the weight (a generalization of a percentage) assigned to the respective receiver. Clients should parse all weights, calculate a sum, and then a percentage to each receiver. If weights are not present, CLIENTS should equally divide the zap amount to all receivers. If weights are only partially present, receivers without a weight should not be zapped (<code>weight = 0</code>).</p>
<pre><code class="language-js">{
    &quot;tags&quot;: [
        [ &quot;zap&quot;, &quot;82341f882b6eabcd2ba7f1ef90aad961cf074af15b9ef44a09f9d2a8fbfbe6a2&quot;, &quot;wss://nostr.oxtr.dev&quot;, &quot;1&quot; ],  // 25%
        [ &quot;zap&quot;, &quot;fa984bd7dbb282f07e16e7ae87b26a2a7b9b90b7246a44771f0cf5ae58018f52&quot;, &quot;wss://nostr.wine/&quot;,    &quot;1&quot; ],  // 25%
        [ &quot;zap&quot;, &quot;460c25e682fda7832b52d1f22d3d22b3176d972f60dcdc3212ed8c92ef85065c&quot;, &quot;wss://nos.lol/&quot;,       &quot;2&quot; ]   // 50%
    ]
}
</code></pre>
<p>Clients MAY display the zap split configuration in the note.</p>
<h2>Future Work</h2>
<p>Zaps can be extended to be more private by encrypting <code>zap request</code> notes to the target user, but for simplicity it has been left out of this initial draft.</p>

<h1>58</h1><h1>NIP-58</h1>
<h2>Badges</h2>
<p><code>draft</code> <code>optional</code> <code>author:cameri</code></p>
<p>Three special events are used to define, award and display badges in
user profiles:</p>
<ol>
<li>
<p>A &quot;Badge Definition&quot; event is defined as a parameterized replaceable event with kind <code>30009</code> having a <code>d</code> tag with a value that uniquely identifies the badge (e.g. <code>bravery</code>) published by the badge issuer. Badge definitions can be updated.</p>
</li>
<li>
<p>A &quot;Badge Award&quot; event is a kind <code>8</code> event with a single <code>a</code> tag referencing a &quot;Badge Definition&quot; event and one or more <code>p</code> tags, one for each pubkey the badge issuer wishes to award. Awarded badges are immutable and non-transferrable.</p>
</li>
<li>
<p>A &quot;Profile Badges&quot; event is defined as a parameterized replaceable event
with kind <code>30008</code> with a <code>d</code> tag with the value <code>profile_badges</code>.
Profile badges contain an ordered list of pairs of <code>a</code> and <code>e</code> tags referencing a <code>Badge Definition</code> and a <code>Badge Award</code> for each badge to be displayed.</p>
</li>
</ol>
<h3>Badge Definition event</h3>
<p>The following tags MUST be present:</p>
<ul>
<li><code>d</code> tag with the unique name of the badge.</li>
</ul>
<p>The following tags MAY be present:</p>
<ul>
<li>A <code>name</code> tag with a short name for the badge.</li>
<li><code>image</code> tag whose value is the URL of a high-resolution image representing the badge. The second value optionally specifies the dimensions of the image as  <code>width</code>x<code>height</code> in pixels. Badge recommended dimensions is 1024x1024 pixels.</li>
<li>A <code>description</code> tag whose value MAY contain a textual representation of the
image, the meaning behind the badge, or the reason of it's issuance.</li>
<li>One or more <code>thumb</code> tags whose first value is an URL pointing to a thumbnail version of the image referenced in the <code>image</code> tag. The second value optionally specifies the dimensions of the thumbnail as <code>width</code>x<code>height</code> in pixels.</li>
</ul>
<h3>Badge Award event</h3>
<p>The following tags MUST be present:</p>
<ul>
<li>An <code>a</code> tag referencing a kind <code>30009</code> Badge Definition event.</li>
<li>One or more <code>p</code> tags referencing each pubkey awarded.</li>
</ul>
<h3>Profile Badges Event</h3>
<p>The number of badges a pubkey can be awarded is unbounded. The Profile Badge
event allows individual users to accept or reject awarded badges, as well
as choose the display order of badges on their profiles.</p>
<p>The following tags MUST be present:</p>
<ul>
<li>A <code>d</code> tag with the unique identifier <code>profile_badges</code></li>
</ul>
<p>The following tags MAY be present:</p>
<ul>
<li>Zero or more ordered consecutive pairs of <code>a</code> and <code>e</code> tags referencing a kind <code>30009</code> Badge Definition and kind <code>8</code> Badge Award, respectively. Clients SHOULD
ignore <code>a</code> without corresponding <code>e</code> tag and viceversa. Badge Awards referenced
by the <code>e</code> tags should contain the same <code>a</code> tag.</li>
</ul>
<h3>Motivation</h3>
<p>Users MAY be awarded badges (but not limited to) in recognition, in gratitude, for participation, or in appreciation of a certain goal, task or cause.</p>
<p>Users MAY choose to decorate their profiles with badges for fame, notoriety, recognition, support, etc., from badge issuers they deem reputable.</p>
<h3>Recommendations</h3>
<p>Badge issuers MAY include some Proof of Work as per <a href="13.md">NIP-13</a> when minting Badge Definitions or Badge Awards to embed them with a combined energy cost, arguably making them more special and valuable for users that wish to collect them.</p>
<p>Clients MAY whitelist badge issuers (pubkeys) for the purpose of ensuring they retain a valuable/special factor for their users.</p>
<p>Badge image recommended aspect ratio is 1:1 with a high-res size of 1024x1024 pixels.</p>
<p>Badge thumbnail image recommended dimensions are: 512x512 (xl), 256x256 (l), 64x64 (m), 32x32 (s) and 16x16 (xs).</p>
<p>Clients MAY choose to render less badges than those specified by users in the Profile Badges event or replace the badge image and thumbnails with ones that fits the theme of the client.</p>
<p>Clients SHOULD attempt to render the most appropriate badge thumbnail according to the number of badges chosen by the user and space available. Clients SHOULD attempt render the high-res version on user action (click, tap, hover).</p>
<h3>Example of a Badge Definition event</h3>
<pre><code class="language-json">{
  &quot;pubkey&quot;: &quot;alice&quot;,
  &quot;kind&quot;: 30009,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;bravery&quot;],
    [&quot;name&quot;, &quot;Medal of Bravery&quot;],
    [&quot;description&quot;, &quot;Awarded to users demonstrating bravery&quot;],
    [&quot;image&quot;, &quot;https://nostr.academy/awards/bravery.png&quot;, &quot;1024x1024&quot;],
    [&quot;thumb&quot;, &quot;https://nostr.academy/awards/bravery_256x256.png&quot;, &quot;256x256&quot;],
  ],
  ...
}
</code></pre>
<h3>Example of Badge Award event</h3>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;&lt;badge award event id&gt;&quot;,
  &quot;kind&quot;: 8,
  &quot;pubkey&quot;: &quot;alice&quot;,
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;30009:alice:bravery&quot;],
    [&quot;p&quot;, &quot;bob&quot;, &quot;wss://relay&quot;],
    [&quot;p&quot;, &quot;charlie&quot;, &quot;wss://relay&quot;],
  ],
  ...
}
</code></pre>
<h3>Example of a Profile Badges event</h3>
<p>Honorable Bob The Brave:</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 30008,
  &quot;pubkey&quot;: &quot;bob&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;profile_badges&quot;],
    [&quot;a&quot;, &quot;30009:alice:bravery&quot;],
    [&quot;e&quot;, &quot;&lt;bravery badge award event id&gt;&quot;, &quot;wss://nostr.academy&quot;],
    [&quot;a&quot;, &quot;30009:alice:honor&quot;],
    [&quot;e&quot;, &quot;&lt;honor badge award event id&gt;&quot;, &quot;wss://nostr.academy&quot;],
  ],
  ...
}
</code></pre>

<h1>65</h1><h1>NIP-65</h1>
<h2>Relay List Metadata</h2>
<p><code>draft</code> <code>optional</code> <code>author:mikedilger</code> <code>author:vitorpamplona</code></p>
<p>Defines a replaceable event using <code>kind:10002</code> to advertise preferred relays for discovering a user's content and receiving fresh content from others.</p>
<p>The event MUST include a list of <code>r</code> tags with relay URIs and a <code>read</code> or <code>write</code> marker. If the marker is omitted, the relay is used for both purposes.</p>
<p>The <code>.content</code> is not used.</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 10002,
  &quot;tags&quot;: [
    [&quot;r&quot;, &quot;wss://alicerelay.example.com&quot;],
    [&quot;r&quot;, &quot;wss://brando-relay.com&quot;],
    [&quot;r&quot;, &quot;wss://expensive-relay.example2.com&quot;, &quot;write&quot;],
    [&quot;r&quot;, &quot;wss://nostr-relay.example.com&quot;, &quot;read&quot;],
  ],
  &quot;content&quot;: &quot;&quot;,
  ...other fields
</code></pre>
<p>This NIP doesn't fully replace relay lists that are designed to configure a client's usage of relays (such as <code>kind:3</code> style relay lists). Clients MAY use other relay lists in situations where a <code>kind:10002</code> relay list cannot be found.</p>
<h2>When to Use Read and Write</h2>
<p>When seeking events <strong>from</strong> a user, Clients SHOULD use the WRITE relays of the user's <code>kind:10002</code></p>
<p>When seeking events <strong>about</strong> a user, where the user was tagged, Clients SHOULD use the READ relays of the user's <code>kind:10002</code></p>
<p>When broadcasting an event, Clients SHOULD:</p>
<ul>
<li>Broadcast the event to the WRITE relays of the author</li>
<li>Broadcast the event all READ relays of each tagged user.</li>
</ul>
<h2>Motivation</h2>
<p>The old model of using a fixed relay list per user centralizes in large relay operators:</p>
<ul>
<li>Most users submit their posts to the same highly popular relays, aiming to achieve greater visibility among a broader audience.</li>
<li>Many users are pulling events from a large number of relays in order to get more data at the expense of duplication</li>
<li>Events are being copied between relays, oftentimes to many different relays</li>
</ul>
<p>This NIP allows Clients to connect directly with the most up-to-date relay set from each individual user, eliminating the need of broadcasting events to popular relays.</p>
<h2>Final Considerations</h2>
<ol>
<li>
<p>Clients SHOULD guide users to keep <code>kind:10002</code> lists small (2-4 relays).</p>
</li>
<li>
<p>Clients SHOULD spread an author's <code>kind:10002</code> events to as many relays as viable.</p>
</li>
<li>
<p><code>kind:10002</code> events should primarily be used to advertise the user's preferred relays to others. A user's own client may use other heuristics for selecting relays for fetching data.</p>
</li>
<li>
<p>DMs SHOULD only be broadcasted to the author's WRITE relays and to the receiver's READ relays to keep maximum privacy.</p>
</li>
<li>
<p>If a relay signals support for this NIP in their <a href="11.md">NIP-11</a> document that means they're willing to accept kind 10002 events from a broad range of users, not only their paying customers or whitelisted group.</p>
</li>
<li>
<p>Clients SHOULD deduplicate connections by normalizing relay URIs according to <a href="https://datatracker.ietf.org/doc/html/rfc3986#section-6">RFC 3986</a>.</p>
</li>
</ol>

<h1>72</h1><h1>NIP-72</h1>
<h2>Moderated Communities (Reddit Style)</h2>
<p><code>draft</code> <code>optional</code> <code>author:vitorpamplona</code> <code>author:arthurfranca</code></p>
<p>The goal of this NIP is to create moderator-approved public communities around a topic. It defines the replaceable event <code>kind:34550</code> to define the community and the current list of moderators/administrators. Users that want to post into the community, simply tag any Nostr event with the community's <code>a</code> tag. Moderators issue an approval event <code>kind:4550</code> that links the community with the new post.</p>
<h1>Community Definition</h1>
<p><code>Kind:34550</code> SHOULD include any field that helps define the community and the set of moderators. <code>relay</code> tags MAY be used to describe the preferred relay to download requests and approvals.</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;&lt;32-bytes lowercase hex-encoded SHA-256 of the the serialized event data&gt;&quot;,
  &quot;pubkey&quot;: &quot;&lt;32-bytes lowercase hex-encoded public key of the event creator&gt;&quot;,
  &quot;created_at&quot;: &lt;Unix timestamp in seconds&gt;,
  &quot;kind&quot;: 34550,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;&lt;Community name&gt;&quot;],
    [&quot;description&quot;, &quot;&lt;Community description&gt;&quot;],
    [&quot;image&quot;, &quot;&lt;Community image url&gt;&quot;, &quot;&lt;Width&gt;x&lt;Height&gt;&quot;],

    //.. other tags relevant to defining the community

    // moderators
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey1&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;moderator&quot;],
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey2&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;moderator&quot;],
    [&quot;p&quot;, &quot;&lt;32-bytes hex of a pubkey3&gt;&quot;, &quot;&lt;optional recommended relay URL&gt;&quot;, &quot;moderator&quot;],

    // relays used by the community (w/optional marker)
    [&quot;relay&quot;, &quot;&lt;relay hosting author kind 0&gt;&quot;, &quot;author&quot;],
    [&quot;relay&quot;, &quot;&lt;relay where to send and receive requests&gt;&quot;, &quot;requests&quot;],
    [&quot;relay&quot;, &quot;&lt;relay where to send and receive approvals&gt;&quot;, &quot;approvals&quot;],
    [&quot;relay&quot;, &quot;&lt;relay where to post requests to and fetch approvals from&gt;&quot;]
  ]
}
</code></pre>
<h1>New Post Request</h1>
<p>Any Nostr event can be a post request. Clients MUST add the community's <code>a</code> tag to the new post event in order to be presented for the moderator's approval.</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;&lt;32-bytes lowercase hex-encoded SHA-256 of the the serialized event data&gt;&quot;,
  &quot;pubkey&quot;: &quot;&lt;32-bytes lowercase hex-encoded public key of the event creator&gt;&quot;,
  &quot;created_at&quot;: &lt;Unix timestamp in seconds&gt;,
  &quot;kind&quot;: 1,
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;34550:&lt;Community event author pubkey&gt;:&lt;d-identifier of the community&gt;&quot;, &quot;&lt;Optional relay url&gt;&quot;],
  ],
  &quot;content&quot;: &quot;&lt;My content&gt;&quot;
}
</code></pre>
<p>Community management clients MAY filter all mentions to a given <code>kind:34550</code> event and request moderators to approve each submission. Moderators MAY delete his/her approval of a post at any time using event deletions (See <a href="09.md">NIP-09</a>).</p>
<h1>Post Approval by moderators</h1>
<p>The post-approval event MUST include <code>a</code> tags of the communities the moderator is posting into (one or more), the <code>e</code> tag of the post and <code>p</code> tag of the author of the post (for approval notifications). The event SHOULD also include the stringified <code>post request</code> event inside the <code>.content</code> (<a href="18.md">NIP-18-style</a>) and a <code>k</code> tag with the original post's event kind to allow filtering of approved posts by kind.</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;&lt;32-bytes lowercase hex-encoded SHA-256 of the the serialized event data&gt;&quot;,
  &quot;pubkey&quot;: &quot;&lt;32-bytes lowercase hex-encoded public key of the event creator&gt;&quot;,
  &quot;created_at&quot;: &lt;Unix timestamp in seconds&gt;,
  &quot;kind&quot;: 4550,
  &quot;tags&quot;: [
    [&quot;a&quot;, &quot;34550:&lt;Community event author pubkey&gt;:&lt;d-identifier of the community&gt;&quot;, &quot;&lt;Optional relay url&gt;&quot;],
    [&quot;e&quot;, &quot;&lt;Post Request ID&gt;&quot;, &quot;&lt;Optional relay url&gt;&quot;],
    [&quot;p&quot;, &quot;&lt;Post Request Author ID&gt;&quot;, &quot;&lt;Optional relay url&gt;&quot;],
    [&quot;k&quot;, &quot;&lt;New Post Request kind&gt;&quot;],
  ],
  &quot;content&quot;: &quot;&lt;New Post Request JSON&gt;&quot;
}
</code></pre>
<p>It's recommended that multiple moderators approve posts to avoid deleting them from the community when a moderator is removed from the owner's list. In case the full list of moderators must be rotated, the new moderator set must sign new approvals for posts in the past or the community will restart. The owner can also periodically copy and re-sign of each moderator's approval events to make sure posts don't disappear with moderators.</p>
<p>Post Approvals of replaceable events can be created in three ways: (i) by tagging the replaceable event as an <code>e</code> tag if moderators want to approve each individual change to the repleceable event; (ii) by tagging the replaceable event as an <code>a</code> tag if the moderator authorizes the replaceable event author to make changes without additional approvals and (iii) by tagging the replaceable event with both its <code>e</code> and <code>a</code> tag which empowers clients to display the original and updated versions of the event, with appropriate remarks in the UI. Since relays are instructed to delete old versions of a replaceable event, the <code>.content</code> of an <code>e</code>-approval MUST have the specific version of the event or Clients might not be able to find that version of the content anywhere.</p>
<p>Clients SHOULD evaluate any non-<code>34550:*</code> <code>a</code> tag as posts to be included in all <code>34550:*</code> <code>a</code> tags.</p>
<h1>Displaying</h1>
<p>Community clients SHOULD display posts that have been approved by at least 1 moderator or by the community owner.</p>
<p>The following filter displays the approved posts.</p>
<pre><code class="language-js">{
  &quot;authors&quot;: [&quot;&lt;Author pubkey&gt;&quot;, &quot;&lt;Moderator1 pubkey&gt;&quot;, &quot;&lt;Moderator2 pubkey&gt;&quot;, &quot;&lt;Moderator3 pubkey&gt;&quot;, ...],
  &quot;kinds&quot;: [4550],
  &quot;#a&quot;: [&quot;34550:&lt;Community event author pubkey&gt;:&lt;d-identifier of the community&gt;&quot;],
}
</code></pre>
<p>Clients MAY hide approvals by blocked moderators at the user's request.</p>

<h1>75</h1><h1>NIP-75</h1>
<h2>Zap Goals</h2>
<p><code>draft</code> <code>optional</code> <code>author:verbiricha</code></p>
<p>This NIP defines an event for creating fundraising goals. Users can contribute funds towards the goal by zapping the goal event.</p>
<h2>Nostr Event</h2>
<p>A <code>kind:9041</code> event is used.</p>
<p>The <code>.content</code> contains a human-readable description of the goal.</p>
<p>The following tags are defined as REQUIRED.</p>
<ul>
<li><code>amount</code> - target amount in milisats.</li>
<li><code>relays</code> - a list of relays the zaps to this goal will be sent to and tallied from.</li>
</ul>
<p>Example event:</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 9041,
  &quot;tags&quot;: [
    [&quot;relays&quot;, &quot;wss://alicerelay.example.com&quot;, &quot;wss://bobrelay.example.com&quot;, ...],
    [&quot;amount&quot;, &quot;210000&quot;],
  ],
  &quot;content&quot;: &quot;Nostrasia travel expenses&quot;,
  ...other fields
</code></pre>
<p>The following tags are OPTIONAL.</p>
<ul>
<li><code>closed_at</code> - timestamp for determining which zaps are included in the tally. Zap receipts published after the <code>closed_at</code> timestamp SHOULD NOT count towards the goal progress.</li>
</ul>
<pre><code class="language-json">{
  &quot;kind&quot;: 9041,
  &quot;tags&quot;: [
    [&quot;relays&quot;, &quot;wss://alicerelay.example.com&quot;, &quot;wss://bobrelay.example.com&quot;, ...],
    [&quot;amount&quot;, &quot;210000&quot;],
    [&quot;closed_at&quot;, &quot;&lt;unix timestamp in seconds&gt;&quot;],
  ],
  &quot;content&quot;: &quot;Nostrasia travel expenses&quot;,
  ...other fields
</code></pre>
<p>The goal MAY include an <code>r</code> or <code>a</code> tag linking to a URL or parameterized replaceable event.</p>
<p>The goal MAY include multiple beneficiary pubkeys by specifying <a href="57.md#appendix-g-zap-tag-on-other-events"><code>zap</code> tags</a>.</p>
<p>Parameterized replaceable events can link to a goal by using a <code>goal</code> tag specifying the event id and an optional relay hint.</p>
<pre><code class="language-json">{
  &quot;kind&quot;: 3XXXX,
  &quot;tags&quot;: [
    ...
    [&quot;goal&quot;, &quot;&lt;event id&gt;&quot;, &quot;&lt;Relay URL (optional)&gt;&quot;],
  ],
  ...other fields
</code></pre>
<h2>Client behavior</h2>
<p>Clients MAY display funding goals on user profiles.</p>
<p>When zapping a goal event, clients MUST include the relays in the <code>relays</code> tag of the goal event in the zap request <code>relays</code> tag.</p>
<p>When zapping a parameterized replaceable event with a <code>goal</code> tag, clients SHOULD tag the goal event id in the <code>e</code> tag of the zap request.</p>
<h2>Use cases</h2>
<ul>
<li>Fundraising clients</li>
<li>Adding funding goals to events such as long form posts, badges or live streams</li>
</ul>

<h1>78</h1><h1>NIP-78</h1>
<h2>Arbitrary custom app data</h2>
<p><code>draft</code> <code>optional</code> <code>author:sandwich</code> <code>author:fiatjaf</code></p>
<p>The goal of this NIP is to enable <a href="https://remotestorage.io/">remoteStorage</a>-like capabilities for custom applications that do not care about interoperability.</p>
<p>Even though interoperability is great, some apps do not want or do not need interoperability, and it wouldn't make sense for them. Yet Nostr can still serve as a generalized data storage for these apps in a &quot;bring your own database&quot; way, for example: a user would open an app and somehow input their preferred relay for storage, which would then enable these apps to store application-specific data there.</p>
<h2>Nostr event</h2>
<p>This NIP specifies the use of event kind <code>30078</code> (parameterized replaceable event) with a <code>d</code> tag containing some reference to the app name and context -- or any other arbitrary string. <code>content</code> and other <code>tags</code> can be anything or in any format.</p>
<h2>Some use cases</h2>
<ul>
<li>User personal settings on Nostr clients (and other apps unrelated to Nostr)</li>
<li>A way for client developers to propagate dynamic parameters to users without these having to update</li>
<li>Personal private data generated by apps that have nothing to do with Nostr, but allow users to use Nostr relays as their personal database</li>
</ul>

<h1>89</h1><h1>NIP-89</h1>
<h2>Recommended Application Handlers</h2>
<p><code>draft</code> <code>optional</code> <code>author:pablof7z</code></p>
<p>This NIP describes <code>kind:31989</code> and <code>kind:31990</code>: a way to discover applications that can handle unknown event-kinds.</p>
<h2>Rationale</h2>
<p>Nostr's discoverability and transparent event interaction is one of its most interesting/novel mechanics.
This NIP provides a simple way for clients to discover applications that handle events of a specific kind to ensure smooth cross-client and cross-kind interactions.</p>
<h3>Parties involved</h3>
<p>There are three actors to this workflow:</p>
<ul>
<li>application that handles a specific event kind (note that an application doesn't necessarily need to be a distinct entity and it could just be the same pubkey as user A)
<ul>
<li>Publishes <code>kind:31990</code>, detailing how apps should redirect to it</li>
</ul>
</li>
<li>user A, who recommends an app that handles a specific event kind
<ul>
<li>Publishes <code>kind:31989</code></li>
</ul>
</li>
<li>user B, who seeks a recommendation for an app that handles a specific event kind
<ul>
<li>Queries for <code>kind:31989</code> and, based on results, queries for <code>kind:31990</code></li>
</ul>
</li>
</ul>
<h1>Events</h1>
<h2>Recommendation event</h2>
<pre><code class="language-json">{
    &quot;kind&quot;: 31989,
    &quot;pubkey&quot;: &lt;recommender-user-pubkey&gt;,
    &quot;tags&quot;: [
        [ &quot;d&quot;, &lt;supported-event-kind&gt; ],
        [ &quot;a&quot;, &quot;31990:app1-pubkey:&lt;d-identifier&gt;&quot;, &quot;wss://relay1&quot;, &quot;ios&quot; ],
        [ &quot;a&quot;, &quot;31990:app2-pubkey:&lt;d-identifier&gt;&quot;, &quot;wss://relay2&quot;, &quot;web&quot; ]
    ]
}
</code></pre>
<p>The <code>d</code> tag in <code>kind:31989</code> is the supported event kind this event is recommending.</p>
<p>Multiple <code>a</code> tags can appear on the same <code>kind:31989</code>.</p>
<p>The second value of the tag SHOULD be a relay hint.
The third value of the tag SHOULD be the platform where this recommendation might apply.</p>
<h2>Handler information</h2>
<pre><code class="language-json">{
    &quot;kind&quot;: 31990,
    &quot;pubkey&quot;: &lt;pubkey&gt;,
    &quot;content&quot;: &quot;&lt;optional-kind:0-style-metadata&gt;&quot;,
    &quot;tags&quot;: [
        [ &quot;d&quot;, &lt;random-id&gt; ],
        [ &quot;k&quot;, &lt;supported-event-kind&gt; ],
        [ &quot;web&quot;, &quot;https://..../a/&lt;bech32&gt;&quot;, &quot;nevent&quot; ],
        [ &quot;web&quot;, &quot;https://..../p/&lt;bech32&gt;&quot;, &quot;nprofile&quot; ],
        [ &quot;web&quot;, &quot;https://..../e/&lt;bech32&gt;&quot; ],
        [ &quot;ios&quot;, &quot;.../&lt;bech32&gt;&quot; ]
    ]
}
</code></pre>
<ul>
<li>
<p><code>content</code> is an optional <code>metadata</code>-like stringified JSON object, as described in NIP-01. This content is useful when the pubkey creating the <code>kind:31990</code> is not an application. If <code>content</code> is empty, the <code>kind:0</code> of the pubkey should be used to display application information (e.g. name, picture, web, LUD16, etc.)</p>
</li>
<li>
<p><code>k</code> tags' value is the event kind that is supported by this <code>kind:31990</code>.
Using a <code>k</code> tag(s) (instead of having the kind onf the NIP-33 <code>d</code> tag) provides:</p>
<ul>
<li>Multiple <code>k</code> tags can exist in the same event if the application supports more than one event kind and their handler URLs are the same.</li>
<li>The same pubkey can have multiple events with different apps that handle the same event kind.</li>
</ul>
</li>
<li>
<p><code>bech32</code> in a URL MUST be replaced by clients with the NIP-19-encoded entity that should be loaded by the application.</p>
</li>
</ul>
<p>Multiple tags might be registered by the app, following NIP-19 nomenclature as the second value of the array.</p>
<p>A tag without a second value in the array SHOULD be considered a generic handler for any NIP-19 entity that is not handled by a different tag.</p>
<h1>User flow</h1>
<p>A user A who uses a non-<code>kind:1</code>-centric nostr app could choose to announce/recommend a certain kind-handler application.</p>
<p>When user B sees an unknown event kind, e.g. in a social-media centric nostr client, the client would allow user B to interact with the unknown-kind event (e.g. tapping on it).</p>
<p>The client MIGHT query for the user's and the user's follows handler.</p>
<h1>Example</h1>
<h2>User A recommends a <code>kind:31337</code>-handler</h2>
<p>User A might be a user of Zapstr, a <code>kind:31337</code>-centric client (tracks). Using Zapstr, user A publishes an event recommending Zapstr as a <code>kind:31337</code>-handler.</p>
<pre><code class="language-json">{
    &quot;kind&quot;: 31989,
    &quot;tags&quot;: [
        [ &quot;d&quot;, &quot;31337&quot; ],
        [ &quot;a&quot;, &quot;31990:1743058db7078661b94aaf4286429d97ee5257d14a86d6bfa54cb0482b876fb0:abcd&quot;, &lt;relay-url&gt;, &quot;web&quot; ]
    ]
}
</code></pre>
<h2>User B interacts with a <code>kind:31337</code>-handler</h2>
<p>User B might see in their timeline an event referring to a <code>kind:31337</code> event
(e.g. a <code>kind:1</code> tagging a <code>kind:31337</code>).</p>
<p>User B's client, not knowing how to handle a <code>kind:31337</code> might display the event
using its <code>alt</code> tag (as described in NIP-31). When the user clicks on the event,
the application queries for a handler for this <code>kind</code>:</p>
<p><code>[&quot;REQ&quot;, &lt;id&gt;, '[{ &quot;kinds&quot;: [31989], &quot;#d&quot;: [&quot;31337&quot;], 'authors': [&lt;user&gt;, &lt;users-contact-list&gt;] }]']</code></p>
<p>User B, who follows User A, sees that <code>kind:31989</code> event and fetches the <code>a</code>-tagged event for the app and handler information.</p>
<p>User B's client sees the application's <code>kind:31990</code> which includes the information to redirect the user to the relevant URL with the desired entity replaced in the URL.</p>
<h2>Alternative query bypassing <code>kind:31989</code></h2>
<p>Alternatively, users might choose to query directly for <code>kind:31990</code> for an event kind. Clients SHOULD be careful doing this and use spam-prevention mechanisms to avoid directing users to malicious handlers.</p>
<p><code>[&quot;REQ&quot;, &lt;id&gt;, '[{ &quot;kinds&quot;: [31990], &quot;#k&quot;: [&lt;desired-event-kind&gt;], 'authors': [...] }]']</code></p>

<h1>94</h1><h1>NIP-94</h1>
<h2>File Metadata</h2>
<p><code>draft</code> <code>optional</code> <code>author:frbitten</code> <code>author:kieran</code> <code>author:lovvtide</code> <code>author:fiatjaf</code> <code>author:staab</code></p>
<p>The purpose of this NIP is to allow an organization and classification of shared files. So that relays can filter and organize in any way that is of interest. With that, multiple types of filesharing clients can be created. NIP-94 support is not expected to be implemented by &quot;social&quot; clients that deal with kind:1 notes or by longform clients that deal with kind:30023 articles.</p>
<h2>Event format</h2>
<p>This NIP specifies the use of the <code>1063</code> event type, having in <code>content</code> a description of the file content, and a list of tags described below:</p>
<ul>
<li><code>url</code> the url to download the file</li>
<li><code>m</code> a string indicating the data type of the file. The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types">MIME types</a> format must be used, and they should be lowercase.</li>
<li><code>&quot;aes-256-gcm&quot;</code> (optional)  key and nonce for AES-GCM encryption with tagSize always 128bits</li>
<li><code>x</code> containing the SHA-256 hexencoded string of the file.</li>
<li><code>size</code> (optional) size of file in bytes</li>
<li><code>dim</code> (optional) size of file in pixels in the form <code>&lt;width&gt;x&lt;height&gt;</code></li>
<li><code>magnet</code> (optional) URI to magnet file</li>
<li><code>i</code> (optional) torrent infohash</li>
<li><code>blurhash</code>(optional) the <a href="https://github.com/woltapp/blurhash">blurhash</a> to show while the file is being loaded by the client</li>
<li><code>thumb</code> (optional) url of thumbnail with same aspect ratio</li>
<li><code>image</code> (optional) url of preview image with same dimensions</li>
<li><code>summary</code> (optional) text excerpt</li>
<li><code>alt</code> (optional) description for accessibility</li>
</ul>
<pre><code class="language-json">{
  &quot;id&quot;: &lt;32-bytes lowercase hex-encoded sha256 of the the serialized event data&gt;,
  &quot;pubkey&quot;: &lt;32-bytes lowercase hex-encoded public key of the event creator&gt;,
  &quot;created_at&quot;: &lt;unix timestamp in seconds&gt;,
  &quot;kind&quot;: 1063,
  &quot;tags&quot;: [
    [&quot;url&quot;,&lt;string with URI of file&gt;],
    [&quot;aes-256-gcm&quot;,&lt;key&gt;, &lt;iv&gt;],
    [&quot;m&quot;, &lt;MIME type&gt;],
    [&quot;x&quot;,&lt;Hash SHA-256&gt;],
    [&quot;size&quot;, &lt;size of file in bytes&gt;],
    [&quot;dim&quot;, &lt;size of file in pixels&gt;],
    [&quot;magnet&quot;,&lt;magnet URI&gt; ],
    [&quot;i&quot;,&lt;torrent infohash&gt;],
    [&quot;blurhash&quot;, &lt;value&gt;],
    [&quot;thumb&quot;, &lt;string with thumbnail URI&gt;],
    [&quot;image&quot;, &lt;string with preview URI&gt;],
    [&quot;summary&quot;, &lt;excerpt&gt;],
    [&quot;alt&quot;, &lt;description&gt;]
  ],
  &quot;content&quot;: &lt;caption&gt;,
  &quot;sig&quot;: &lt;64-bytes hex of the signature of the sha256 hash of the serialized event data, which is the same as the &quot;id&quot; field&gt;
}
</code></pre>
<h2>Suggested use cases</h2>
<ul>
<li>A relay for indexing shared files. For example, to promote torrents.</li>
<li>A pinterest-like client where people can share their portfolio and inspire others.</li>
<li>A simple way to distribute configurations and software updates.</li>
</ul>

<h1>98</h1><h1>NIP-98</h1>
<h2>HTTP Auth</h2>
<p><code>draft</code> <code>optional</code> <code>author:kieran</code> <code>author:melvincarvalho</code></p>
<p>This NIP defines an ephemeral event used to authorize requests to HTTP servers using nostr events.</p>
<p>This is useful for HTTP services which are built for Nostr and deal with Nostr user accounts.</p>
<h2>Nostr event</h2>
<p>A <code>kind 27235</code> (In reference to <a href="https://www.rfc-editor.org/rfc/rfc7235">RFC 7235</a>) event is used.</p>
<p>The <code>content</code> SHOULD be empty.</p>
<p>The following tags MUST be included.</p>
<ul>
<li><code>u</code> - absolute URL</li>
<li><code>method</code> - HTTP Request Method</li>
</ul>
<p>Example event:</p>
<pre><code class="language-json">{
    &quot;id&quot;: &quot;fe964e758903360f28d8424d092da8494ed207cba823110be3a57dfe4b578734&quot;,
    &quot;pubkey&quot;: &quot;63fe6318dc58583cfe16810f86dd09e18bfd76aabc24a0081ce2856f330504ed&quot;,
    &quot;content&quot;: &quot;&quot;,
    &quot;kind&quot;: 27235,
    &quot;created_at&quot;: 1682327852,
    &quot;tags&quot;: [
        [
            &quot;u&quot;,
            &quot;https://api.snort.social/api/v1/n5sp/list&quot;
        ],
        [
            &quot;method&quot;,
            &quot;GET&quot;
        ]
    ],
    &quot;sig&quot;: &quot;5ed9d8ec958bc854f997bdc24ac337d005af372324747efe4a00e24f4c30437ff4dd8308684bed467d9d6be3e5a517bb43b1732cc7d33949a3aaf86705c22184&quot;
}
</code></pre>
<p>Servers MUST perform the following checks in order to validate the event:</p>
<ol>
<li>The <code>kind</code> MUST be <code>27235</code>.</li>
<li>The <code>created_at</code> timestamp MUST be within a reasonable time window (suggestion 60 seconds).</li>
<li>The <code>u</code> tag MUST be exactly the same as the absolute request URL (including query parameters).</li>
<li>The <code>method</code> tag MUST be the same HTTP method used for the requested resource.</li>
</ol>
<p>When the request contains a body (as in POST/PUT/PATCH methods) clients SHOULD include a SHA256 hash of the request body in a <code>payload</code> tag as hex (<code>[&quot;payload&quot;, &quot;&lt;sha256-hex&gt;&quot;]</code>), servers MAY check this to validate that the requested payload is authorized.</p>
<p>If one of the checks was to fail the server SHOULD respond with a 401 Unauthorized response code.</p>
<p>Servers MAY perform additional implementation-specific validation checks.</p>
<h2>Request Flow</h2>
<p>Using the <code>Authorization</code> HTTP header, the <code>kind 27235</code> event MUST be <code>base64</code> encoded and use the Authorization scheme <code>Nostr</code></p>
<p>Example HTTP Authorization header:</p>
<pre><code>Authorization: Nostr eyJpZCI6ImZlOTY0ZTc1ODkwMzM2MGYyOGQ4NDI0ZDA5MmRhODQ5NGVkMjA3Y2JhODIzMTEwYmUzYTU3ZGZlNGI1Nzg3MzQiLCJwdWJrZXkiOiI2M2ZlNjMxOGRjNTg1ODNjZmUxNjgxMGY4NmRkMDllMThiZmQ3NmFhYmMyNGEwMDgxY2UyODU2ZjMzMDUwNGVkIiwiY29udGVudCI6IiIsImtpbmQiOjI3MjM1LCJjcmVhdGVkX2F0IjoxNjgyMzI3ODUyLCJ0YWdzIjpbWyJ1cmwiLCJodHRwczovL2FwaS5zbm9ydC5zb2NpYWwvYXBpL3YxL241c3AvbGlzdCJdLFsibWV0aG9kIiwiR0VUIl1dLCJzaWciOiI1ZWQ5ZDhlYzk1OGJjODU0Zjk5N2JkYzI0YWMzMzdkMDA1YWYzNzIzMjQ3NDdlZmU0YTAwZTI0ZjRjMzA0MzdmZjRkZDgzMDg2ODRiZWQ0NjdkOWQ2YmUzZTVhNTE3YmI0M2IxNzMyY2M3ZDMzOTQ5YTNhYWY4NjcwNWMyMjE4NCJ9
</code></pre>
<h2>Reference Implementations</h2>
<ul>
<li>C# ASP.NET <code>AuthenticationHandler</code> <a href="https://gist.github.com/v0l/74346ae530896115bfe2504c8cd018d3">NostrAuth.cs</a></li>
</ul>

<h1>99</h1><h1>NIP-99</h1>
<h2>Classified Listings</h2>
<p><code>draft</code> <code>optional</code> <code>author:erskingardner</code></p>
<p>This NIP defines <code>kind:30402</code>: a parameterized replaceable event to describe classified listings that list any arbitrary product, service, or other thing for sale or offer and includes enough structured metadata to make them useful.</p>
<p>The category of classifieds includes a very broad range of physical goods, services, work opportunities, rentals, free giveaways, personals, etc. and is distinct from the more strictly structured marketplaces defined in <a href="https://github.com/nostr-protocol/nips/blob/master/15.md">NIP-15</a> that often sell many units of specific products through very specific channels.</p>
<p>The structure of these events is very similar to <a href="https://github.com/nostr-protocol/nips/blob/master/23.md">NIP-23</a> long-form content events.</p>
<h3>Draft / Inactive Listings</h3>
<p><code>kind:30403</code> has the same structure as <code>kind:30402</code> and is used to save draft or inactive classified listings.</p>
<h3>Content</h3>
<p>The <code>.content</code> field should be a description of what is being offered and by whom. These events should be a string in Markdown syntax.</p>
<h3>Author</h3>
<p>The <code>.pubkey</code> field of these events are treated as the party creating the listing.</p>
<h3>Metadata</h3>
<ul>
<li>For &quot;tags&quot;/&quot;hashtags&quot; (i.e. categories or keywords of relevance for the listing) the <code>&quot;t&quot;</code> event tag should be used, as per <a href="https://github.com/nostr-protocol/nips/blob/master/12.md">NIP-12</a>.</li>
<li>For images, whether included in the markdown content or not, clients SHOULD use <code>image</code> tags as described in <a href="https://github.com/nostr-protocol/nips/blob/master/58.md">NIP-58</a>. This allows clients to display images in carousel format more easily.</li>
</ul>
<p>The following tags, used for structured metadata, are standardized and SHOULD be included. Other tags may be added as necessary.</p>
<ul>
<li><code>&quot;title&quot;</code>, a title for the listing</li>
<li><code>&quot;summary&quot;</code>, for short tagline or summary for the listing</li>
<li><code>&quot;published_at&quot;</code>, for the timestamp (in unix seconds – converted to string) of the first time the listing was published.</li>
<li><code>&quot;location&quot;</code>, for the location.</li>
<li><code>&quot;price&quot;</code>, for the price of the thing being listed. This is an array in the format <code>[ &quot;price&quot;, &quot;&lt;number&gt;&quot;, &quot;&lt;currency&gt;&quot;, &quot;&lt;frequency&gt;&quot; ]</code>.
<ul>
<li><code>&quot;price&quot;</code> is the name of the tag</li>
<li><code>&quot;&lt;number&gt;&quot;</code> is the amount in numeric format (but included in the tag as a string)</li>
<li><code>&quot;&lt;currency&gt;&quot;</code> is the currency unit in 3-character ISO 4217 format or ISO 4217-like currency code (e.g. <code>&quot;btc&quot;</code>, <code>&quot;eth&quot;</code>).</li>
<li><code>&quot;&lt;frequency&gt;&quot;</code> is optional and can be used to describe recurring payments. SHOULD be in noun format (hour, day, week, month, year, etc.)</li>
</ul>
</li>
</ul>
<h4><code>price</code> examples</h4>
<ul>
<li>$50 one-time payment <code>[&quot;price&quot;, &quot;50&quot;, &quot;USD&quot;]</code></li>
<li>€15 per month <code>[&quot;price&quot;, &quot;15&quot;, &quot;EUR&quot;, &quot;month&quot;]</code></li>
<li>£50,000 per year <code>[&quot;price&quot;, &quot;50000&quot;, &quot;GBP&quot;, &quot;year&quot;]</code></li>
</ul>
<p>Other standard tags that might be useful.</p>
<ul>
<li><code>&quot;g&quot;</code>, a geohash for more precise location</li>
</ul>
<h2>Example Event</h2>
<pre><code class="language-json">{
  &quot;kind&quot;: 30402,
  &quot;created_at&quot;: 1675642635,
  // Markdown content
  &quot;content&quot;: &quot;Lorem [ipsum][nostr:nevent1qqst8cujky046negxgwwm5ynqwn53t8aqjr6afd8g59nfqwxpdhylpcpzamhxue69uhhyetvv9ujuetcv9khqmr99e3k7mg8arnc9] dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n\nRead more at nostr:naddr1qqzkjurnw4ksz9thwden5te0wfjkccte9ehx7um5wghx7un8qgs2d90kkcq3nk2jry62dyf50k0h36rhpdtd594my40w9pkal876jxgrqsqqqa28pccpzu.&quot;,
  &quot;tags&quot;: [
    [&quot;d&quot;, &quot;lorem-ipsum&quot;],
    [&quot;title&quot;, &quot;Lorem Ipsum&quot;],
    [&quot;published_at&quot;, &quot;1296962229&quot;],
    [&quot;t&quot;, &quot;electronics&quot;],
    [&quot;image&quot;, &quot;https://url.to.img&quot;, &quot;256x256&quot;],
    [&quot;summary&quot;, &quot;More lorem ipsum that is a little more than the title&quot;],
    [&quot;location&quot;, &quot;NYC&quot;],
    [&quot;price&quot;, &quot;100&quot;, &quot;USD&quot;],
    [
      &quot;e&quot;,
      &quot;b3e392b11f5d4f28321cedd09303a748acfd0487aea5a7450b3481c60b6e4f87&quot;,
      &quot;wss://relay.example.com&quot;
    ],
    [
      &quot;a&quot;,
      &quot;30023:a695f6b60119d9521934a691347d9f78e8770b56da16bb255ee286ddf9fda919:ipsum&quot;,
      &quot;wss://relay.nostr.org&quot;
    ]
  ],
  &quot;pubkey&quot;: &quot;...&quot;,
  &quot;id&quot;: &quot;...&quot;
}
</code></pre>
